/* (c) Mathigon */
var App=function(t){"use strict";
function e(t,e,s,i){var n,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,i);else for(var h=t.length-1;h>=0;h--)(n=t[h])&&(o=(r<3?n(o):r>3?n(e,s,o):n(e,s))||o);return r>3&&o&&Object.defineProperty(e,s,o),o}function s(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{a(i.next(t))}catch(t){r(t)}}function h(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,h)}a((i=i.apply(t,e||[])).next())}))}function i(t,...e){return e.includes(t)}function n(t,e=0){return e?+setTimeout(t,e):(t(),0)}function r(t){return new Promise(e=>setTimeout(e,t))}function o(){let t=()=>{},e=()=>{};const s=new Promise((s,i)=>{t=s,e=i});return s.catch(t=>t),{promise:s,resolve:t,reject:e}}function h(t,e=0,s=!1){let i=!1,n=!1;return(...r)=>{i?n=!0:(s?n=!0:t(...r),i=!0,setTimeout(()=>{n&&t(...r),i=n=!1},e))}}function a(t,e){return new Array(e).fill(t)}function c(t,e){const s=[];for(let i=0;i<e;++i)s.push(t(i));return s}function l(t,e,s=1){const i=[];if(void 0===e&&t>=0)for(let e=0;e<t;e+=s)i.push(e);else if(void 0===e)for(let e=0;e>t;e-=s)i.push(e);else if(t<=e)for(let n=t;n<=e;n+=s)i.push(n);else for(let n=t;n>=e;n-=s)i.push(n);return i}function d(t,e=0){return t[t.length-1-e]}function u(t){return t.reduce((t,e)=>t+e,0)}function p(t,e,s=!1){return t.slice(0).sort((t,i)=>{const n=e(t),r=e(i);return n<r?s?1:-1:n>r?s?-1:1:0})}function f(t){let e=0;return()=>t[e++%t.length]}function g(t,e=/\s+/){return t?t.trim().split(e):[]}function m(t,e,s=!1){const i=function(t,e,s){const i=[];for(let n=0;n<e;++n)i.push(a(t,s));return i}(0,t.length+1,e.length+1);for(let e=0;e<=t.length;e++)i[e][0]=e;for(let t=0;t<=e.length;t++)i[0][t]=t;for(let s=1;s<=t.length;s++)for(let n=1;n<=e.length;n++)i[s][n]=Math.min(i[s-1][n-1]+(t.charAt(s-1)===e.charAt(n-1)?0:1),i[s-1][n]+1,i[s][n-1]+1);return s?Math.min(...i[t.length]):i[t.length][e.length]}class v{constructor(){this.events=new Map}on(t,e){for(const s of g(t))this.events.has(s)||this.events.set(s,[]),this.events.get(s).push(e)}one(t,e){const s=i=>{this.off(t,s),e(i)};this.on(t,s)}off(t,e){for(const s of g(t))this.events.has(s)&&this.events.set(s,this.events.get(s).filter(t=>t!==e))}trigger(t,e){for(const s of g(t))if(this.events.has(s))for(const t of this.events.get(s))t(e)}}const w=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,y=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,x=/rgba?\(([0-9,]+), ?([0-9,]+), ?([0-9,]+)(, ?([0-9,]+))?\)/,$=["#22ab24","#0f82f2","#cd0e66","#fd8c00"];function b(t,e){if(e<=0)return M.from(t[0]);if(e>=1)return M.from(d(t));const s=Math.floor(e*(t.length-1)),i=e*(t.length-1)-s;return M.mix(t[s+1],t[s],i)}class M{constructor(t,e,s,i=1){this.r=t,this.g=e,this.b=s,this.a=i}get hex(){return"#"+[this.r,this.g,this.b].map(t=>{return 1===(e=Math.round(t).toString(16)).length?"0"+e:e;var e}).join("")}get rgb(){return"rgba("+[this.r,this.g,this.b].map(t=>Math.round(t)).join(",")+","+this.a+")"}get hsl(){const t=this.r/255,e=this.g/255,s=this.b/255,i=Math.max(t,e,s),n=Math.min(t,e,s);let r,o;const h=(i+n)/2;if(i===n)r=o=0;else{const a=i-n;switch(o=h>.5?a/(2-i-n):a/(i+n),i){case t:r=(e-s)/a+(e<s?6:0);break;case e:r=(s-t)/a+2;break;default:r=(t-e)/a+4}r/=6}return"hsl("+[r,o,h].join(",")+")"}toString(){return this.rgb}copy(){return new M(this.r,this.g,this.b,this.a)}static from(t){return"string"!=typeof t?t:t.startsWith("#")?M.fromHex(t):M.fromRgb(t)}static fromRgb(t){const e=t.match(x);if(!e)return new M(0,0,0);const s=e[4]?+e[5]||0:1;return new M(+e[1],+e[2],+e[3],s)}static fromHex(t){t=t.replace(w,(function(t,e,s,i){return e+e+s+s+i+i}));const e=y.exec(t);return e?new M(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)):new M(0,0,0)}static rainbow(t){return c(e=>b($,e/(t-1)),t)}static gradient(t,e,s){return c(i=>b([t,e],i/(s-1)),s)}static mix(t,e,s=.5){return t=M.from(t),e=M.from(e),new M(s*t.r+(1-s)*e.r,s*t.g+(1-s)*e.g,s*t.b+(1-s)*e.b,s*t.a+(1-s)*e.a)}}function C(t,...e){return e.includes(t)}function k(t,e){for(const s of Object.keys(e))Object.prototype.hasOwnProperty.call(t,s)||(t[s]=e[s]);return t}const P=(t,e)=>t.concat(e);function A(t,e=0){return e?+setTimeout(t,e):(t(),0)}function T(){let t=()=>{},e=()=>{};const s=new Promise((s,i)=>{t=s,e=i});return s.catch(t=>t),{promise:s,resolve:t,reject:e}}function S(t,e=0,s=!1){let i=!1,n=!1;return(...r)=>{i?n=!0:(s?n=!0:t(...r),i=!0,setTimeout(()=>{n&&t(...r),i=n=!1},e))}}function _(t,e={}){if(!t)return e;try{return JSON.parse(t)||e}catch(t){return e}}function I(t,e=0){return t[t.length-1-e]}function E(t,e=/\s+/){return t?t.trim().split(e):[]}class L{constructor(){this.events=new Map}on(t,e){for(const s of E(t))this.events.has(s)||this.events.set(s,[]),this.events.get(s).push(e)}one(t,e){const s=i=>{this.off(t,s),e(i)};this.on(t,s)}off(t,e){for(const s of E(t))this.events.has(s)&&this.events.set(s,this.events.get(s).filter(t=>t!==e))}trigger(t,e){for(const s of E(t))if(this.events.has(s))for(const t of this.events.get(s))t(e)}}function q(t,...e){return e.includes(t)}function O(t){return t.reduce((t,e)=>t+e,0)}function R(t){const e=t.map(t=>({val:t,next:void 0})),s=e.length;for(let t=0;t<s-1;++t)e[t].next=e[t+1];return e[s-1].next=e[0],e}function N(t,e,s=1e-6){return!isNaN(t)&&!isNaN(e)&&Math.abs(t-e)<s}function j(t,e,s,i=1e-6){return e>s&&([e,s]=[s,e]),t>e+i&&t<s-i}function V(t,e=1){return Math.round(t/e)*e}function B(t,e=-1/0,s=1/0){return Math.min(s,Math.max(e,t))}function D(t,e,s=.5){return t+(e-t)*s}function z(t){return t*t}function H(t,e=0){const s=function t(e){if(1===e.length)return[[],e];const s=e.pop(),i=t(e),n=[];for(const t of i)n.push(t,[...t,s]);return n}(t.slice(0));return e?s.filter(t=>t.length===e):s}class W{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return N(this.length,0)?new W(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new W(-this.x,-this.y)}get flip(){return new W(this.y,this.x)}get perpendicular(){return new W(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return W.distance(this,t.project(this))}clamp(t,e=0){const s=B(this.x,t.xMin+e,t.xMax-e),i=B(this.y,t.yMin+e,t.yMax-e);return new W(s,i)}transform(t){const e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],s=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new W(e,s)}rotate(t,e=F){const s=this.x-e.x,i=this.y-e.y,n=Math.cos(t),r=Math.sin(t),o=s*n-i*r+e.x,h=s*r+i*n+e.y;return new W(o,h)}reflect(t){const e=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,i=this.x-t.p1.x,n=(e*(this.y-t.p1.y)-s*i)/(e*e+s*s),r=this.x+2*n*s,o=this.y-2*n*e;return new W(r,o)}scale(t,e=t){return new W(this.x*t,this.y*e)}shift(t,e=t){return new W(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}changeCoordinates(t,e){const s=e.xMin+(this.x-t.xMin)/t.dx*e.dx,i=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new W(s,i)}add(t){return W.sum(this,t)}subtract(t){return W.difference(this,t)}equals(t){return N(this.x,t.x)&&N(this.y,t.y)}round(t=1){return new W(V(this.x,t),V(this.y,t))}floor(){return new W(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new W(this.x%t,this.y%e)}angle(t=F){return G(this,t)}static average(...t){const e=O(t.map(t=>t.x))/t.length,s=O(t.map(t=>t.y))/t.length;return new W(e,s)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new W(t.x+e.x,t.y+e.y)}static difference(t,e){return new W(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(z(t.x-e.x)+z(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,s=.5){return new W(D(t.x,e.x,s),D(t.y,e.y,s))}static interpolateList(t,e=.5){const s=t.length-1,i=Math.floor(B(e,0,1)*s);return W.interpolate(t[i],t[i+1],s*e-i)}static fromPolar(t,e=1){return new W(e*Math.cos(t),e*Math.sin(t))}}const F=new W(0,0);class U{constructor(t,e,s,i){this.xMin=t,this.xMax=e,this.yMin=s,this.yMax=i}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new J(new W(this.xMin,this.xMin),this.dx,this.dy)}}const K=2*Math.PI;function G(t,e=F){return(Math.atan2(t.y-e.y,t.x-e.x)+K)%K}class X{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}make(t,e){return new X(t,e)}get length(){return W.distance(this.p1,this.p2)}get midpoint(){return W.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return G(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new W(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){const e=W.sum(t,W.difference(this.p2,this.p1));return new X(t,e)}perpendicular(t){return new X(t,W.sum(t,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}project(t){const e=W.difference(this.p2,this.p1),s=W.difference(t,this.p1),i=e.scale(W.dot(e,s)/this.length**2);return W.sum(this.p1,i)}contains(t){return N(t.x*(this.p1.y-this.p2.y)+this.p1.x*(this.p2.y-t.y)+this.p2.x*(t.y-this.p1.y),0)}at(t){return W.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=F){return new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return this.make(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return this.make(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t){return this.contains(t.p1)&&this.contains(t.p2)}}class Y extends X{constructor(){super(...arguments),this.type="segment"}contains(t){return!!X.prototype.contains.call(this,t)&&(N(this.p1.x,this.p2.x)?j(t.y,this.p1.y,this.p2.y):j(t.x,this.p1.x,this.p2.x))}make(t,e){return new Y(t,e)}project(t){const e=W.difference(this.p2,this.p1),s=W.difference(t,this.p1),i=B(W.dot(e,s)/z(this.length),0,1);return W.sum(this.p1,e.scale(i))}contract(t){return new Y(this.at(t),this.at(1-t))}equals(t,e=!1){return"segment"===t.type&&(this.p1.equals(t.p1)&&this.p2.equals(t.p2)||!e&&this.p1.equals(t.p2)&&this.p2.equals(t.p1))}static intersect(t,e){return nt(t,e)[0]||void 0}}class Z{constructor(...t){this.type="polygon",this.points=t}get circumference(){let t=0;for(let e=1;e<this.points.length;++e)t+=W.distance(this.points[e-1],this.points[e]);return t}get signedArea(){const t=this.points,e=t.length;let s=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let i=1;i<e;++i)s+=t[i-1].x*t[i].y-t[i].x*t[i-1].y;return s/2}get area(){return Math.abs(this.signedArea)}get centroid(){const t=this.points,e=t.length;let s=0;for(let i=0;i<e;++i)s+=t[i].x;let i=0;for(let s=0;s<e;++s)i+=t[s].y;return new W(s/e,i/e)}get edges(){const t=this.points,e=t.length,s=[];for(let i=0;i<e;++i)s.push(new Y(t[i],t[(i+1)%e]));return s}get radius(){const t=this.centroid,e=this.points.map(e=>W.distance(e,t));return Math.max(...e)}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=F){const s=this.points.map(s=>s.rotate(t,e));return new this.constructor(...s)}reflect(t){const e=this.points.map(e=>e.reflect(t));return new this.constructor(...e)}scale(t,e=t){const s=this.points.map(s=>s.scale(t,e));return new this.constructor(...s)}shift(t,e=t){const s=this.points.map(s=>s.shift(t,e));return new this.constructor(...s)}translate(t){return this.shift(t.x,t.y)}contains(t){let e=!1;for(const s of this.edges){if(s.p1.equals(t)||s.contains(t))return!1;if(s.p1.y>t.y==s.p2.y>t.y)continue;const i=(s.p2.x-s.p1.x)/(s.p2.y-s.p1.y);t.x<i*(t.y-s.p1.y)+s.p1.x&&(e=!e)}return e}equals(t){return!1}project(t){let e=void 0,s=1/0;for(const i of this.edges){const n=i.project(t),r=W.distance(t,n);r<s&&(e=n,s=r)}return e||this.points[0]}at(t){return W.interpolateList([...this.points,this.points[0]],t)}get oriented(){if(this.signedArea>=0)return this;const t=[...this.points].reverse();return new this.constructor(...t)}intersect(t){const e=[R(this.oriented.points),R(t.oriented.points)],s=this.points.length+t.points.length,i=[];let n=0,r=e[n].find(e=>t.contains(e.val));if(r){for(;r.val!==i[0]&&i.length<s;){i.push(r.val);const t=new Y(r.val,r.next.val);r=r.next;for(const s of e[1-n]){const e=it(t,new Y(s.val,s.next.val))[0];if(e){n=1-n,r={val:e,next:s.next};break}}}return new Z(...i)}}static collision(t,e){for(const s of t.edges)for(const t of e.edges)if(Y.intersect(s,t))return!0;return e.contains(t.points[0])||t.contains(e.points[0])}static regular(t,e=1){const s=2*Math.PI/t,i=Math.PI/2-s/2,n=function(t,e){const s=[];for(let i=0;i<e;++i)s.push(t(i));return s}(t=>W.fromPolar(i+s*t,e),t);return new Z(...n)}static interpolate(t,e,s=.5){const i=t.points.map((t,i)=>W.interpolate(t,e.points[i],s));return new Z(...i)}}class J{constructor(t,e=1,s=e){this.p=t,this.w=e,this.h=s,this.type="rectangle"}static aroundPoints(...t){const e=t.map(t=>t.x),s=t.map(t=>t.y),i=Math.min(...e),n=Math.max(...e)-i,r=Math.min(...s),o=Math.max(...s)-r;return new J(new W(i,r),n,o)}get center(){return new W(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){const t=new W(this.p.x+this.w,this.p.y),e=new W(this.p.x+this.w,this.p.y+this.h),s=new W(this.p.x,this.p.y+this.h);return new Z(this.p,t,e,s)}transform(t){return this.polygon.transform(t)}rotate(t,e=F){return this.polygon.rotate(t,e)}reflect(t){return this.polygon.reflect(t)}scale(t,e=t){return new J(this.p.scale(t,e),this.w*t,this.h*e)}shift(t,e=t){return new J(this.p.shift(t,e),this.w,this.h)}translate(t){return this.shift(t.x,t.y)}contains(t){return j(t.x,this.p.x,this.p.x+this.w)&&j(t.y,this.p.y,this.p.y+this.h)}equals(t){return!1}project(t){const e={x:this.p.x+this.w,y:this.p.y+this.h},s=this.p.x+this.w/2,i=this.p.y+this.h/2,n=(i-t.y)/(s-t.x);if(t.x<=s){const s=n*(this.p.x-t.x)+t.y;if(this.p.y<s&&s<e.y)return new W(this.p.x,s)}if(t.x>=s){const s=n*(e.x-t.x)+t.y;if(this.p.y<s&&s<e.y)return new W(e.x,s)}if(t.y<=i){const s=(this.p.y-t.y)/n+t.x;if(this.p.x<s&&s<e.x)return new W(s,this.p.y)}if(t.y>=i){const s=(e.y-t.y)/n+t.x;if(this.p.x<s&&s<e.x)return new W(s,e.y)}return this.p}at(t){}}function Q(t){return q(t.type,"polygon","polyline","rectangle")}function tt(t){return q(t.type,"line","ray","segment")}function et(t){return"circle"===t.type}function st(t,e){const s=t.p2.x-t.p1.x,i=t.p2.y-t.p1.y,n=z(s)+z(i),r=e.c.x,o=e.c.y,h=(t.p1.x-r)*(t.p2.y-o)-(t.p2.x-r)*(t.p1.y-o),a=z(e.r)*n-z(h);if(a<0)return[];const c=h*i/n,l=-h*s/n;if(N(a,0))return[e.c.shift(c,l)];const d=s*(i<0?-1:1)*Math.sqrt(a)/n,u=Math.abs(i)*Math.sqrt(a)/n;return[e.c.shift(c+d,l+u),e.c.shift(c-d,l-u)]}function it(...t){if(t.length<2)return[];if(t.length>2)return function t(e){return e.reduce((e,s)=>e.concat(Array.isArray(s)?t(s):s),[])}(H(t,2).map(t=>it(...t)));let[e,s]=t;if(Q(s)&&([e,s]=[s,e]),Q(e)){return[...tt(s)?e.points.filter(t=>s.contains(t)):[],...it(s,...e.edges)]}return nt(e,s)}function nt(t,e){let s=[];tt(t)&&tt(e)?s=function(t,e){const s=t.p1.x-t.p2.x,i=t.p1.y-t.p2.y,n=e.p1.x-e.p2.x,r=e.p1.y-e.p2.y,o=s*r-i*n;if(N(o,0))return[];const h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,a=e.p1.x*e.p2.y-e.p1.y*e.p2.x;return[new W((h*n-s*a)/o,(h*r-i*a)/o)]}(t,e):tt(t)&&et(e)?s=st(t,e):et(t)&&tt(e)?s=st(e,t):et(t)&&et(e)&&(s=function(t,e){const s=W.distance(t.c,e.c);if(s>t.r+e.r)return[];if(s<Math.abs(t.r-e.r))return[];if(N(s,0)&&N(t.r,e.r))return[];if(N(s,t.r+e.r))return[new X(t.c,e.c).midpoint];const i=(z(t.r)-z(e.r)+z(s))/(2*s),n=Math.sqrt(z(t.r)-z(i)),r=(e.c.x-t.c.x)*i/s+(e.c.y-t.c.y)*n/s+t.c.x,o=(e.c.y-t.c.y)*i/s-(e.c.x-t.c.x)*n/s+t.c.y,h=(e.c.x-t.c.x)*i/s-(e.c.y-t.c.y)*n/s+t.c.x,a=(e.c.y-t.c.y)*i/s+(e.c.x-t.c.x)*n/s+t.c.y;return[new W(r,o),new W(h,a)]}(t,e));for(const i of[t,e])"segment"===i.type&&(s=s.filter(t=>{return s=t,N((e=i).p1.x,e.p2.x)?j(s.y,e.p1.y,e.p2.y):j(s.x,e.p1.x,e.p2.x);var e,s})),"ray"===i.type&&(s=s.filter(t=>{return s=t,N((e=i).p1.x,e.p2.x)?(s.y-e.p1.y)/(e.p2.y-e.p1.y)>0:(s.x-e.p1.x)/(e.p2.x-e.p1.x)>0;var e,s}));return s}function rt(t){const e=[];for(let s of Object.keys(t)){let i=t[s];s=encodeURIComponent(s),null!=i?(i=Array.isArray(i)?i.join(","):""+i,i=i.replace(/(\r)?\n/g,"\r\n"),i=encodeURIComponent(i),i=i.replace(/%20/g,"+"),e.push(s+"="+i)):e.push(s)}return e.join("&")}function ot(t,e){const s={method:"POST",body:e?"string"==typeof e?e:rt(e):void 0,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":window.csrfToken||""}},i=t.includes("?")?"&xhr=1":"?xhr=1";return fetch(t+i,s).then(t=>t.text())}const ht=new Map;function at(t,e){ht.has(t)?function t(e,s,i=P){for(const n of Object.keys(s))n in e&&Array.isArray(e[n])&&Array.isArray(s[n])?e[n]=i(e[n],s[n]):n in e&&e[n]instanceof Object&&s[n]instanceof Object?t(e[n],s[n]):e[n]=s[n]}(ht.get(t),e,(t,e)=>{return(s=t.concat(e)).filter((t,e)=>s.indexOf(t)===e);var s}):ht.set(t,e)}function ct(){if(window.navigator.onLine)for(const[t,e]of ht)ht.delete(t),ot(t,{data:JSON.stringify(e)}).catch(s=>{console.error("Failed to send POST request:",s),at(t,e)})}const lt=S(ct,5e3);

function dt(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{a(i.next(t))}catch(t){r(t)}}function h(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,h)}a((i=i.apply(t,e||[])).next())}))}var ut;window.addEventListener("online",lt),window.onbeforeunload=ct,function(t){t[t.Array=0]="Array",t[t.BinaryOp=1]="BinaryOp",t[t.Call=2]="Call",t[t.Conditional=3]="Conditional",t[t.Identifier=4]="Identifier",t[t.Literal=5]="Literal",t[t.Member=6]="Member",t[t.UnaryOp=7]="UnaryOp"}(ut||(ut={}));const pt={"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"**":(t,e)=>Math.pow(t,e),"<":(t,e)=>t<e,">":(t,e)=>t>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},ft={"-":t=>-t,"+":t=>+t,"!":t=>!t},gt={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},mt={true:!0,false:!1,undefined:void 0},vt=/\s/,wt=/[0-9]/,yt=/[a-zA-Zα-ωΑ-Ω$_]/,xt=/[0-9a-zA-Zα-ωΑ-Ω$_]/;function $t(t){const e=t.length;let s=0;function i(e){throw new Error(`${e} at character ${s} of "${t}"`)}function n(){for(;vt.test(t[s]);)s+=1}function r(){let n=t[s];for(yt.test(t[s])||i("Unexpected "+n),s+=1;s<e&&xt.test(t[s]);)n+=t[s++];return n in mt?{type:ut.Literal,value:mt[n]}:{type:ut.Identifier,name:n}}function o(n){const r=[];let o=!1,h=void 0;for(;s<e;){if(t[s]===n){h&&r.push(h),o=!0,s+=1;break}","===t[s]?(r.push(h||{type:ut.Literal,value:void 0}),s+=1):h=c()}return o||i("Expected "+n),r}function h(){n();for(const e of[3,2,1]){const i=t.substr(s,e);if(i in pt)return s+=e,i}}function a(){n();const h=t[s];return wt.test(h)||"."===h?function(){let e="";for(;wt.test(t[s]);)e+=t[s++];if("."===t[s])for(e+=t[s++];wt.test(t[s]);)e+=t[s++];const n=t[s];n&&yt.test(n)?i(`Variable names cannot start with a number (${e+t[s]})`):"."===n&&i("Unexpected period");return{type:ut.Literal,value:parseFloat(e)}}():"'"===h||'"'===h?function(){const n=t[s];s+=1;let r=!1,o="";for(;s<e;){const e=t[s++];if(e===n){r=!0;break}o+=e}return r||i(`Unclosed quote after "${o}"`),{type:ut.Literal,value:o}}():"["===h?(s+=1,{type:ut.Array,elements:o("]")}):h in ft?(s+=1,{type:ut.UnaryOp,operator:h,argument:a()}):yt.test(h)||"("===h?function(){let e;if("("===t[s]){if(s+=1,e=c(),n(),")"===t[s])return s+=1,e;i("Unclosed (")}else e=r();for(n();".[(".includes(t[s]);)"."===t[s]?(s++,n(),e={type:ut.Member,object:e,computed:!1,property:r()}):"["===t[s]?(s++,e={type:ut.Member,object:e,computed:!0,property:c()},n(),"]"!==t[s]&&i("Unclosed ["),s++):"("===t[s]&&(s++,e={type:ut.Call,args:o(")"),callee:e}),n();return e}():void i("Expression parsing error")}function c(){const e=function(){let t=a(),e=h();if(!e)return t;let s,n=a();n||i("Expected expression after "+e);const r=[t,e,n];for(;e=h();){const o=gt[e],h=e;for(;r.length>2&&o<=gt[r[r.length-2]];)n=r.pop(),e=r.pop(),t=r.pop(),s={type:ut.BinaryOp,operator:e,left:t,right:n},r.push(s);s=a(),s||i("Expected expression after "+h),r.push(h,s)}let o=r.length-1;for(s=r[o];o>1;)s={type:ut.BinaryOp,operator:r[o-1],left:r[o-2],right:s},o-=2;return s}();if(n(),!e||"?"!==t[s])return e;{s+=1;const r=c();if(r||i("Expected expression"),n(),":"===t[s]){s++;const t=c();return t||i("Expected expression"),{type:ut.Conditional,test:e,consequent:r,alternate:t}}i("Expected :")}}const l=c();return s<t.length&&i(`Unexpected "${t[s]}"`),l}const bt=[void 0,void 0];function Mt(t){const e=$t(t);return e?(t={})=>function t(e,s){switch(e.type){case ut.Array:const i=e.elements.map(e=>t(e,s)[0]);return i.some(t=>void 0===t)?bt:[i,void 0];case ut.BinaryOp:const n=t(e.left,s)[0],r=t(e.right,s)[0];return!"+-**/%".includes(e.operator)||void 0!==n&&void 0!==r?[pt[e.operator](n,r),void 0]:bt;case ut.Call:const[o,h]=t(e.callee,s),a=e.args.map(e=>t(e,s)[0]);return a.some(t=>void 0===t)||"function"!=typeof o?bt:[o.apply(h,a),void 0];case ut.Conditional:const c=t(e.consequent,s),l=t(e.alternate,s);return t(e.test,s)[0]?c:l;case ut.Identifier:return[s[e.name],void 0];case ut.Literal:return[e.value,void 0];case ut.Member:const d=t(e.object,s)[0],u=e.computed?t(e.property,s)[0]:e.property.name;return d?[d[u],d]:[void 0,void 0];case ut.UnaryOp:const p=t(e.argument,s)[0];return void 0===p?bt:[ft[e.operator](p),void 0]}}(e,t)[0]:(t={})=>{}}const Ct=/\${([^}]+)}/g;function kt(t){const e=(t=t.replace(/×/g,"*")).split(Ct),s=e.map((t,e)=>e%2?Mt(t):void 0);return t=>e.map((e,i)=>{if(!(i%2))return e;const n=s[i](t);return"number"==typeof n&&n<0?"–"+-n:n}).join("")}const Pt="ontouchstart"in window,At="onpointerdown"in window;function Tt(t){if(t.touches){const e=t.targetTouches.length?t.targetTouches:t.changedTouches;return new W(e[0].clientX,e[0].clientY)}return new W(t.clientX||0,t.clientY||0)}function St(t,e){return Tt(t).transform(e.inverseTransformMatrix)}function _t(t,e){const s=Tt(t),i=e.bounds,n=(s.x-i.left)*e.canvasWidth/i.width,r=(s.y-i.top)*e.canvasHeight/i.height;return new W(n,r)}function It(t){if(t instanceof PointerEvent&&"mouse"===t.pointerType)return ae(t.target);const e=Tt(t);return ae(document.elementFromPoint(e.x,e.y)||void 0)}function Et(t,e){const s=e.$box||t;let i=Tt;"svg"===s.type?i=t=>St(t,s.$ownerSVG):"canvas"===s.type&&(i=t=>_t(t,s));const n=e.justInside?t:de;let r=void 0,o=void 0,h=!1,a=0;function c(t){if(a&&t.pointerId!==a)return;t.preventDefault();const s=i(t);W.distance(s,o)<.5||(!h&&e.start&&e.start(r),e.move&&e.move(s,r,o),o=s,h=!0)}function l(t){a&&t.pointerId!==a||(t.preventDefault(),n.off("pointermove",c),n.off("pointerstop",l),e.up&&e.up(o,r),h&&e.end&&e.end(o,r),!h&&e.click&&e.click(r))}"auto"===t.css("touch-action")&&t.css("touch-action","none"),t.addClass("noselect"),t.on("pointerdown",(function(t){t.handled||function(t){return t.touches||[]}(t).length>1||(t.preventDefault(),h=!1,a=t.pointerId||0,n.on("pointermove",c),n.on("pointerstop",l),r=o=i(t),e.down&&e.down(r))})),e.justInside&&t.on("mouseleave",l),e.accessible&&(t.setAttr("tabindex","0"),document.addEventListener("keydown",s=>{if(![37,38,39,40].includes(s.keyCode))return;if(t!==fe.getActiveInput())return;const n=t.boxCenter,r=i({clientX:n.x,clientY:n.y}),o=37===s.keyCode?-25:39===s.keyCode?25:0,h=38===s.keyCode?-25:40===s.keyCode?25:0,a=r.shift(o,h);e.down&&e.down(r),e.start&&e.start(r),e.move&&e.move(a,r,r),e.end&&e.end(a,r)}))}function Lt(t,e){const s=e.$clickTarget||t;let i=0,n=!1,r=!1,o=!1;function h(){n||(e.enter&&e.enter(),n=!0)}function a(){n&&(clearTimeout(i),e.exit&&e.exit(),n=!1)}t.on("mouseover",()=>{e.preventMouseover&&e.preventMouseover()||(clearTimeout(i),i=A(()=>{h(),r=!0},e.delay))}),t.on("mouseout",()=>{r&&(clearTimeout(i),i=A(a,e.exitDelay||e.delay))}),s.on("focus",()=>{n||e.preventMouseover&&e.preventMouseover()||(clearTimeout(i),h(),o=!0)});const c=()=>{o&&(e.canFocusWithin?setTimeout(()=>{const e=fe.getActiveInput();e&&e.hasParent(t)?e.one("blur",c):a()}):a())};s.on("blur",c),s.on("click",()=>{n&&!r?a():n||(h(),r=!1)}),t.on("clickOutside",a)}let qt;function Ot(t){for(const e of t){const t=e.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>ae(e.target).trigger(t))}}function Rt(t){if(!t._data.intersectionEvents)if(t._data.intersectionEvents=!0,window.IntersectionObserver)qt||(qt=new IntersectionObserver(Ot)),qt.observe(t._el);else{let e=!1;de.on("scroll",()=>{const s=t.isInViewport;e&&!s?(t.trigger("exitViewport"),e=!1):s&&!e&&(t.trigger("enterViewport"),e=!0)})}}function Nt(t){if(t._data.pointerPositionEvents)return;t._data.pointerPositionEvents=!0;const e=t.parent;let s=void 0;e.on("pointerend",()=>s=void 0),e.on("pointermove",e=>{const i=s,n=It(e);s=n.equals(t)||n.hasParent(t),null!=i&&s&&!i&&t.trigger("pointerenter",e),!s&&i&&t.trigger("pointerleave",e)})}function jt(t,e){e._data["_"+t]||(e._data["_"+t]=!0,At?e.on(t.replace("mouse","pointer"),s=>{"mouse"===s.pointerType&&e.trigger(t,s)}):Pt||e._el.addEventListener(t,s=>e.trigger(t,s)))}const Vt={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:At?"pointerdown":Pt?"touchstart":"mousedown",pointermove:At?"pointermove":Pt?"touchmove":"mousemove",pointerup:At?"pointerup":Pt?"touchend":"mouseup",pointercancel:At?"pointercancel":"touchcancel",pointerstop:At?"pointerup pointercancel":Pt?"touchend touchcancel":"mouseup"},Bt={scroll:function(t){if(t._data.scrollEvents)return;t._data.scrollEvents=!0;let e=!1,s=void 0;function i(){const n=t.scrollTop;n!==s?(s=n,t.trigger("scroll",{top:s}),window.requestAnimationFrame(i)):e=!1}function n(){e||window.requestAnimationFrame(i),e=!0}function r(){window.removeEventListener("touchmove",n),window.removeEventListener("touchend",r)}("window"===t.type?window:t._el).addEventListener("scroll",n),t._el.addEventListener("touchstart",(function(t){t.handled||(window.addEventListener("touchmove",n),window.addEventListener("touchend",r))}))},tap:function(t){if(t._data.tapEvent)return;t._data.tapEvent=!0;let e=void 0;t.on("pointerdown",t=>e=Tt(t)),t.on("pointerup",s=>{if(!e)return;const i=Tt(s);W.distance(e,i)<6&&t.trigger("tap",s),e=void 0}),t.on("pointercancel",()=>e=void 0)},clickOutside:function(t){t._data.clickOutsideEvent||(t._data.clickOutsideEvent=!0,de.on("pointerdown",e=>{const s=ae(e.target);s&&(s.equals(t)||s.hasParent(t))||t.trigger("clickOutside",e)}))},key:function(t){t.on("keydown",e=>{if(e.metaKey||e.ctrlKey)return;if(fe.isAndroid&&229===e.keyCode)return;const s=(e.key||String.fromCharCode(e.which)).toLowerCase();t.trigger("key",{code:e.keyCode,key:s})}),fe.isAndroid&&"input"===t.type&&t.on("input",e=>{const s=e.data[e.data.length-1].toLowerCase();t.trigger("key",{code:void 0,key:s}),t.value=""})},mousedown:jt.bind(void 0,"mousedown"),mousemove:jt.bind(void 0,"mousemove"),mouseup:jt.bind(void 0,"mouseup"),pointerenter:Nt,pointerleave:Nt,enterViewport:Rt,exitViewport:Rt,resize:function(t,e=!1){if(e&&(t._data.resizeObserver&&t._data.resizeObserver.disconnect(),t._data.resizeObserver=void 0),!t._data.resizeObserver)if(window.ResizeObserver){const e=new window.ResizeObserver(()=>t.trigger("resize"));e.observe(t._el),t._data.resizeObserver=e}else if(window.MutationObserver){const e=new MutationObserver(()=>t.trigger("resize"));e.observe(t._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),t._data.resizeObserver=e}}};function Dt(t,e,s,i){if(e in Bt)Bt[e](t,!1);else if(e in Vt){const n=E(Vt[e]);for(const e of n)t._el.addEventListener(e,s,i)}else t._el.addEventListener(e,s,i)}function zt(t,e,s){if(e in Bt)t._events[e]&&t._events[e].length||Bt[e](t,!0);else if(s&&e in Vt){const i=E(Vt[e]);for(const e of i)t._el.removeEventListener(e,s)}else s&&t._el.removeEventListener(e,s)}function Ht(t,e,s){const i=e.x*(s.y-t.y)+t.x*(e.y-s.y)+s.x*(t.y-e.y)>0?1:0,n=W.distance(e,t);return[t.x,t.y+"A"+n,n,0,i,1,s.x,s.y].join(",")}function Wt(t,e={}){return t.isRight&&!e.round?20:24+20*(1-B(t.rad,0,Math.PI)/Math.PI)}function Ft(...t){return"M"+t.map(t=>t.x+","+t.y).join("L")}function Ut(t,e){const s=t.perpendicularVector.scale(6),i=t.unitVector.scale(3),n=t.midpoint;switch(e){case"bar":return Ft(n.add(s),n.add(s.inverse));case"bar2":return Ft(n.add(i).add(s),n.add(i).add(s.inverse))+Ft(n.add(i.inverse).add(s),n.add(i.inverse).add(s.inverse));case"arrow":return Ft(n.add(i.inverse).add(s),n.add(i),n.add(i.inverse).add(s.inverse));case"arrow2":return Ft(n.add(i.scale(-2)).add(s),n,n.add(i.scale(-2)).add(s.inverse))+Ft(n.add(s),n.add(i.scale(2)),n.add(s.inverse));default:return""}}function Kt(t,e){if(!t||!e)return"";const s=e.perpendicular,i=t.add(e.scale(9)).add(s.scale(9)),n=t.add(e.scale(9)).add(s.scale(-9));return Ft(i,t,n)}function Gt(t,e={}){if("angle"===t.type)return function(t,e={}){let s=t.a;const i=t.b;let n=t.c;const r=e.size||Wt(t,e),o=W.difference(s,i).unitVector,h=W.difference(n,i).unitVector;s=W.sum(i,o.scale(r)),n=W.sum(i,h.scale(r));let a=e.fill?`M${i.x},${i.y}L`:"M";if(t.isRight&&!e.round){const t=W.sum(s,h.scale(r));a+=`${s.x},${s.y}L${t.x},${t.y}L${n.x},${n.y}`}else a+=Ht(s,i,n);return e.fill&&(a+="Z"),a}(t=t,e);if("segment"===t.type){if((t=t).p1.equals(t.p2))return"";let s=Ft(t.p1,t.p2);return e.mark&&(s+=Ut(t,e.mark)),e.arrows&&(s+=function(t,e){let s="";return C(e,"start","both")&&(s+=Kt(t.p1,t.unitVector)),C(e,"end","both")&&(s+=Kt(t.p2,t.unitVector.inverse)),s}(t,e.arrows)),s}if("ray"===t.type){if(t=t,!e.box)return"";const s=it(t,e.box)[0];return s?Ft(t.p1,s):""}if("line"===t.type){if(t=t,!e.box)return"";const s=it(t,e.box);if(s.length<2)return"";let i=Ft(s[0],s[1]);return e.mark&&(i+=Ut(t,e.mark)),i}if("circle"===t.type)return`M ${(t=t).c.x-t.r} ${t.c.y} a ${t.r},${t.r} 0 1 0 ${2*t.r} 0 a ${t.r} ${t.r} 0 1 0 ${-2*t.r} 0`;if("arc"===t.type){let s="M"+Ht((t=t).start,t.c,t.end);return e.arrows&&(s+=function(t,e){let s="";if(C(e,"start","both")){const e=new X(t.c,t.start).perpendicularVector.inverse;s+=Kt(t.start,e)}if(C(e,"end","both")){const e=new X(t.c,t.end).perpendicularVector;s+=Kt(t.end,e)}return s}(t,e.arrows)),s}return"sector"===t.type?`M ${(t=t).c.x} ${t.c.y} L ${Ht(t.start,t.c,t.end)} Z`:"polyline"===t.type?Ft(...(t=t).points):"polygon"===t.type||"triangle"===t.type?Ft(...(t=t).points)+"Z":"rectangle"===t.type?Ft(...(t=t).polygon.points)+"Z":""}const Xt={C:6,S:4,Q:4,A:7},Yt=/[MmLlCcSsQqTtAa][0-9,.\-\s]+/g,Zt=/-?([0-9]*\.)?[0-9]+/g;class Jt{constructor(t){this._el=t,this._data={},this._events={},this.type="default",t._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(t){return this._el===t._el}addClass(t){for(const e of E(t))this._el.classList.add(e)}removeClass(t){for(const e of E(t))this._el.classList.remove(e)}hasClass(t){return this._el.classList.contains(t)}toggleClass(t){return this._el.classList.toggle(t)}setClass(t,e){e?this.addClass(t):this.removeClass(t)}attr(t){return this._el.getAttribute(t)||""}hasAttr(t){return this._el.hasAttribute(t)}setAttr(t,e){void 0===e?this.removeAttr(t):this._el.setAttribute(t,e.toString())}removeAttr(t){this._el.removeAttribute(t)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(t){this._el.innerHTML=t}get text(){return this._el.textContent||""}set text(t){this._el.textContent=t}set textStr(t){this._el.textContent=""+t}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){const t=this.parent;return t?t.model||t.getParentModel():void 0}bindModel(t,e=!0){var s;if(!this.model){this.model=t;for(const{name:e,value:s}of this.attributes)if(e.startsWith("@")){const i=e.slice(1),n=Mt(s);this.removeAttr(e),this.on(i,()=>n(t))}else if(":show"===e){const i=Mt(s);this.removeAttr(e),t.watch(()=>this.toggle(!!i(t)))}else if(":html"===e){const i=Mt(s);this.removeAttr(e),t.watch(()=>this.html=i(t)||"")}else if(":draw"===e){const e=Mt(s);t.watch(()=>this.draw(e(t)))}else if(":bind"===e)this.bindVariable(t,s);else if(e.startsWith(":")){const i=Mt(s),n=e.slice(1);this.removeAttr(e),t.watch(()=>this.setAttr(n,i(t)))}else if(s.includes("${")){const i=kt(s);t.watch(()=>this.setAttr(e,i(t)||""))}for(const i of this.childNodes)if(i instanceof Text){if(null===(s=i.textContent)||void 0===s?void 0:s.includes("${")){const e=kt(i.textContent);t.watch(()=>i.textContent=e(t)||"")}}else e&&i.bindModel(t)}}bindVariable(t,e){}get bounds(){return this._el.getBoundingClientRect()}get isInViewport(){if(0===this.height)return!1;const t=this.bounds;return j(t.top,-t.height,fe.height)}get topLeftPosition(){const t=this.bounds;return new W(t.left,t.top)}get boxCenter(){const t=this.bounds;return new W(t.left+t.width/2,t.top+t.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(t){this._el.scrollTop=t,this.trigger("scroll",{top:t,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(t){this._el.scrollLeft=t,this.trigger("scroll",{top:this.scrollTop,left:t})}scrollTo(t,e=1e3,s="cubic"){t<0&&(t=0);const i=this.scrollTop,n=t-i;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=xe(t=>{const e=i+n*be(s,t);this.scrollTop=e,this.trigger("scroll",{top:e})},e)}scrollBy(t,e=1e3,s="cubic"){t&&this.scrollTo(this.scrollTop+t,e,s)}css(t,e){if(void 0===e){if("string"==typeof t)return window.getComputedStyle(this._el).getPropertyValue(t);{const e=Object.keys(t);for(const s of e)this._el.style.setProperty(s,""+t[s])}}else"string"==typeof t&&this._el.style.setProperty(t,""+e)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){const t=this.transform;if(!t)return[[1,0,0],[0,1,0]];const e=t.match(/matrix\(([0-9,.\s-]*)\)/);if(!e||!e[1])return[[1,0,0],[0,1,0]];const s=e[1].split(",");return[[+s[0],+s[2],+s[4]],[+s[1],+s[3],+s[5]]]}get scale(){const t=this.transformMatrix;return[t[0][0],t[1][1]]}setTransform(t,e=0,s=1){let i="";t&&(i+=`translate(${V(t.x,.1)}px,${V(t.y,.1)}px)`),e&&(i+=` rotate(${e}rad)`),s&&(i+=` scale(${s})`),this._el.style.transform=i}translate(t,e){this.setTransform(new W(t,e))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),"visibility"===this.data.display?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){"visibility"===this.data.display?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(t){t?this.show():this.hide()}is(t){return this._el.matches?this._el.matches(t):Array.from(document.querySelectorAll(t)).includes(this._el)}index(){let t=0,e=this._el;for(;void 0!==(e=e.previousSibling||void 0);)++t;return t}prepend(t){const e=this._el.childNodes;e.length?this._el.insertBefore(t._el,e[0]):this._el.appendChild(t._el)}append(t){this._el.appendChild(t instanceof Text?t:t._el)}insertBefore(t){this.parent._el.insertBefore(t._el,this._el)}insertAfter(t){const e=this._el.nextSibling;e?this.parent._el.insertBefore(t._el,e):this.parent._el.appendChild(t._el)}get next(){return ae(this._el.nextSibling)}get prev(){return ae(this._el.previousSibling)}$(t){return ae(t,this)}$$(t){return ce(t,this)}get parent(){return ae(this._el.parentElement||void 0)}parents(t){const e=[];let s=this.parent;for(;s;)t&&!s.is(t)||e.push(s),s=s.parent;return e}hasParent(...t){const e=t.map(t=>t._el);let s=this._el.parentNode;for(;s;){if(C(s,...e))return!0;s=s.parentNode}return!1}get children(){return Array.from(this._el.children||[],t=>ae(t))}get childNodes(){return Array.from(this._el.childNodes,t=>t instanceof Text?t:ae(t))}remove(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}on(t,e,s){for(const i of E(t))i in this._events?this._events[i].includes(e)||this._events[i].push(e):this._events[i]=[e],Dt(this,i,e,s)}one(t,e,s){const i=s=>{this.off(t,i),e(s)};this.on(t,i,s)}off(t,e){for(const s of E(t))s in this._events&&(this._events[s]=e?this._events[s].filter(t=>t!==e):[]),zt(this,s,e)}trigger(t,e={}){for(const s of E(t)){if(!this._events[s])return;for(const t of this._events[s])t.call(this,e)}}onKeyDown(t,e){const s=E(t).map(t=>pe[t]||t);this._el.addEventListener("keydown",t=>{s.indexOf(t.keyCode)>=0&&e(t)})}onPromise(t,e=!1){return e?Promise.resolve():new Promise(t=>this.one("solve",()=>t()))}animate(t,e=400,s=0,i="ease-in-out"){return Me(this,t,e,s,i)}enter(t="fade",e=500,s=0){return ke(this,t,e,s)}exit(t="fade",e=500,s=0,i=!1){return Pe(this,t,e,s,i)}effect(t){this.one("animationend",()=>this.removeClass("effects-"+t)),this.addClass("effects-"+t)}copy(t=!0,e=!0){const s=ae(this._el.cloneNode(t));return e&&s.copyInlineStyles(this,t),s}copyInlineStyles(t,e=!0){const s=window.getComputedStyle(t._el);for(const t of Array.from(s))this.css(t,s.getPropertyValue(t));if(e){const e=this.children,s=t.children;for(let t=0;t<e.length;++t)e[t].copyInlineStyles(s[t],!0)}}}class Qt extends Jt{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return ae(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){const t=parseFloat(this.css("padding-left")),e=parseFloat(this.css("padding-right"));return this._el.clientWidth-t-e}get innerHeight(){const t=parseFloat(this.css("padding-bottom")),e=parseFloat(this.css("padding-top"));return this._el.clientHeight-t-e}get outerWidth(){const t=parseFloat(this.css("margin-left")),e=parseFloat(this.css("margin-right"));return this.width+t+e||0}get outerHeight(){const t=parseFloat(this.css("margin-bottom")),e=parseFloat(this.css("margin-top"));return this.height+t+e||0}get positionTop(){let t=this._el,e=0;for(;t;)e+=t.offsetTop,t=t.offsetParent;return e}get positionLeft(){let t=this._el,e=0;for(;t;)e+=t.offsetLeft,t=t.offsetParent;return e}offset(t){if(t._el===this._el.offsetParent){const e=this.offsetTop+t._el.clientTop,s=this.offsetLeft+t._el.clientLeft;return{top:e,left:s,bottom:e+this.height,right:s+this.width}}{const e=t._el.getBoundingClientRect(),s=this._el.getBoundingClientRect();return{top:s.top-e.top,left:s.left-e.left,bottom:s.bottom-e.top,right:s.right-e.left}}}}class te extends Jt{constructor(){super(...arguments),this.type="svg"}get $ownerSVG(){return ae(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){const t=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+t}get positionTop(){const t=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+t}get inverseTransformMatrix(){const t=this._el.getScreenCTM().inverse(),e=[[t.a,t.c,t.e],[t.b,t.d,t.f]];if(fe.isFirefox){const t=this.transformMatrix;e[0][2]-=t[0][2],e[1][2]-=t[1][2]}return e}setTransform(t,e=0,s=1){const i=t?`translate(${V(t.x,.1)} ${V(t.y,.1)})`:"",n=N(e,0)?"":`rotate(${180*e/Math.PI})`,r=N(s,1)?"":`scale(${s})`;this.setAttr("transform",[i,n,r].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{const t=this.bounds;return 2*t.height+2*t.width}}getPointAtLength(t){if(this._el instanceof SVGGeometryElement){const e=this._el.getPointAtLength(t);return new W(e.x,e.y)}return new W(0,0)}getPointAt(t){return this.getPointAtLength(t*this.strokeLength)}get points(){return function(t){if(!t)return[];const e=t.match(Yt)||[],s=[];for(const t of e){const e=(t.slice(1).match(Zt)||[]).map(t=>+t),i=t[0].toUpperCase(),n=i!==t[0],r=Xt[i]||2;for(let t=0;t<e.length;t+=r){const i=e[t+r-2],o=e[t+r-1];s.push(n?I(s).shift(i,o):new W(i,o))}}return s}(this.attr("d"))}set points(t){const e=t.length?"M"+t.map(t=>t.x+","+t.y).join("L"):"";this.setAttr("d",e)}addPoint(t){const e=this.attr("d")+" L "+t.x+","+t.y;this.setAttr("d",e)}get center(){const t=+this.attr("TEXT"===this.tagName?"x":"cx"),e=+this.attr("TEXT"===this.tagName?"y":"cy");return new W(t,e)}setCenter(t){this.setAttr("TEXT"===this.tagName?"x":"cx",t.x),this.setAttr("TEXT"===this.tagName?"y":"cy",t.y)}setLine(t,e){this.setAttr("x1",t.x),this.setAttr("y1",t.y),this.setAttr("x2",e.x),this.setAttr("y2",e.y)}setRect(t){this.setAttr("x",t.p.x),this.setAttr("y",t.p.y),this.setAttr("width",t.w),this.setAttr("height",t.h)}draw(t,e={}){if(!t)return this.setAttr("d","");const s={mark:this.attr("mark"),arrows:this.attr("arrows"),size:+this.attr("size")||void 0,fill:this.hasClass("fill"),round:this.hasAttr("round")};this.setAttr("d",Gt(t,k(e,s)))}}class ee extends te{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}pngImage(t){return dt(this,void 0,void 0,(function*(){const e=this.copy(!0,!0),s=t||this.svgWidth,i=t||this.svgHeight;e.setAttr("width",s),e.setAttr("height",i);const n=(new XMLSerializer).serializeToString(e._el);let r="data:image/svg+xml;utf8,"+encodeURIComponent(n);r=r.replace("svg ",'svg xmlns="http://www.w3.org/2000/svg" ');const o=le("canvas",{width:s,height:i});o.ctx.fillStyle="#fff",o.ctx.fillRect(0,0,s,i);const h=yield function(t){return new Promise(e=>{const s=new Image;s.onload=()=>e(s),s.src=t})}(r);return o.ctx.drawImage(h,0,0,s,i),o.pngImage}))}downloadImage(t,e){const s=fe.isIOS?window.open("","_blank"):void 0;this.pngImage(e).then(e=>{if(s)return s.location.href=e;le("a",{download:t,href:e,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))})}}class se extends Qt{constructor(){super(...arguments),this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(t){document.body.scrollTop=document.documentElement.scrollTop=t,this.trigger("scroll",{top:t,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(t){document.body.scrollLeft=document.documentElement.scrollLeft=t,this.trigger("scroll",{top:this.scrollTop,left:t})}}class ie extends Qt{constructor(){super(...arguments),this.type="form"}get action(){return this._el.action}get formData(){const t={};for(const e of Array.from(this._el.elements)){const s=e.name||e.id;s&&(t[s]=e.value)}return t}get isValid(){return this._el.checkValidity()}}class ne extends Qt{constructor(){super(...arguments),this.type="input"}get checked(){return this._el instanceof HTMLInputElement&&this._el.checked}get value(){return this._el.value}set value(t){this._el.value=t}bindVariable(t,e){t[e]=this.value,this.change(s=>t[e]=s),t.watch(()=>this.value=t[e])}change(t){let e=this.value||"";this.on("change keyup input paste",()=>{this.value!==e&&(e=this.value.trim(),t(e))})}validate(t){this.change(e=>this.setValidity(t(e)))}setValidity(t){this._el.setCustomValidity(t)}get isValid(){return this._el.checkValidity()}}class re extends Qt{constructor(){super(...arguments),this.type="canvas"}getContext(t="2d",e={}){return this._el.getContext(t,e)}get pngImage(){return this._el.toDataURL("image/png")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(t,e={}){this.ctx.save(),function(t,e,s={}){if(s.fill&&(t.fillStyle=s.fill),s.opacity&&(t.globalAlpha=s.opacity),s.stroke&&(t.strokeStyle=s.stroke,t.lineWidth=s.strokeWidth||1,s.lineCap&&(t.lineCap=s.lineCap),s.lineJoin&&(t.lineJoin=s.lineJoin)),t.beginPath(),"segment"===e.type)e=e,t.moveTo(e.p1.x,e.p1.y),t.lineTo(e.p2.x,e.p2.y);else if("circle"===e.type)e=e,t.arc(e.c.x,e.c.y,e.r,0,2*Math.PI);else if("polygon"===e.type||"triangle"===e.type){e=e,t.moveTo(e.points[0].x,e.points[0].y);for(const s of e.points.slice(1))t.lineTo(s.x,s.y);t.closePath()}else if("polyline"===e.type){e=e,t.moveTo(e.points[0].x,e.points[0].y);for(const s of e.points.slice(1))t.lineTo(s.x,s.y)}s.fill&&t.fill(),s.stroke&&t.stroke()}(this.ctx,t,e),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(t){this.ctx.save(),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(t,e){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,e,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(t){le("a",{download:t,href:this.pngImage,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}}class oe extends Qt{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}}const he=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","pattern","mask","svg","foreignObject"];function ae(t,e){if(!t)return;const s=e?e._el:document.documentElement,i="string"==typeof t?s.querySelector(t):t;if(!i)return;if(i._view)return i._view;const n=(i.tagName||"").toLowerCase();return"svg"===n?new ee(i):"canvas"===n?new re(i):"form"===n?new ie(i):"input"===n||"select"===n||"textarea"===n?new ne(i):"video"===n||"audio"===n?new oe(i):he.includes(n)?new te(i):new Qt(i)}function ce(t,e){const s=e?e._el:document.documentElement,i=t?s.querySelectorAll(t):[];return Array.from(i,t=>ae(t))}function le(t,e={},s){const i=he.includes(t)?document.createElementNS("http://www.w3.org/2000/svg",t):document.createElement(t);for(const[t,s]of Object.entries(e))void 0!==s&&("id"===t?i.id=s:"html"===t?i.innerHTML=s:"text"===t?i.textContent=s:"path"===t?i.setAttribute("d",Gt(s)):i.setAttribute(t,s));const n=ae(i);return s&&s.append(n),n}const de=new se(document.body),ue=new se(document.documentElement),pe={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46};var fe;!function(t){const e=window.navigator.userAgent.toLowerCase();t.isMobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e),t.isRetina=(window.devicePixelRatio||1)>1,t.isTouch=!!window.Touch||"ontouchstart"in window,t.isChrome=!!window.chrome,t.isFirefox=e.indexOf("firefox")>=0,t.isAndroid=e.indexOf("android")>=0,t.isIOS=/iphone|ipad|ipod/i.test(e),t.isSafari=/^((?!chrome|android).)*safari/i.test(e),t.redraw=function(){document.body.offsetHeight};const s=[];let i=!1;function n(){if(!i){i=!0;for(const t of s)t();setTimeout(h)}}window.onload=n,document.addEventListener("DOMContentLoaded",n),t.ready=function(t){i?t():s.push(t)};const r=[];t.width=window.innerWidth,t.height=window.innerHeight;const o=S(()=>{t.width=window.innerWidth,t.height=window.innerHeight;for(const e of r)e({width:t.width,height:t.height});de.trigger("scroll",{top:de.scrollTop})});function h(){o()}function a(t,e,s=31536e3){const i=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${t}=${e};path=/;max-age=${s};domain=${i}`}t.onResize=function(e){e({width:t.width,height:t.height}),r.push(e)},t.offResize=function(t){const e=r.indexOf(t);e>=0&&r.splice(e,1)},t.resize=h,window.addEventListener("resize",()=>{const e=window.innerWidth,s=window.innerHeight;t.width===e&&t.height===s||(t.width=e,t.height=s,o())}),t.getHash=function(){return window.location.hash.slice(1)},t.setHash=function(t){const e=document.body.scrollTop;window.location.hash=t,document.body.scrollTop=e},t.getCookies=function(){const t=document.cookie.split(";"),e={};for(let s=0,i=t.length;s<i;++s){const i=t[s].split("=");i[0]=i[0].replace(/^\s+|\s+$/,""),e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e},t.getCookie=function(t){const e=document.cookie.match(new RegExp(`(^|;) ?${t}=([^;]*)(;|$)`));return e?e[2]:void 0},t.setCookie=a,t.deleteCookie=function(t){a(t,"",-1)};function c(t,e){const s=(t||"").split("."),i=_(window.localStorage.getItem("_M")||void 0);let n=i;for(let t=0;t<s.length-1;++t)null==n[s[t]]&&(n[s[t]]={}),n=n[s[t]];n[s[s.length-1]]=e,window.localStorage.setItem("_M",JSON.stringify(i))}function l(){const t=document.activeElement;return t===document.body?void 0:ae(t)}t.setStorage=c,t.getStorage=function(t){let e=_(window.localStorage.getItem("_M")||void 0);if(!t)return e;const s=(t||"").split("."),i=s.pop();for(const t of s){if(!(t in e))return;e=e[t]}return e[i]},t.deleteStorage=function(t){t?c(t,void 0):window.localStorage.setItem("_M","")},t.getActiveInput=l,t.onKey=function(t,e,s=!1){const i=E(t),n=i.map(t=>pe[t]||t),r=s?"keyup":"keydown";document.addEventListener(r,(function(t){const s=l();if(s&&(s.is("input, textarea, [contenteditable]")||s.hasAttr("tabindex")))return;const r=n.findIndex(e=>t.keyCode===e||t.key===e);r>=0&&e(t,i[r])}))}}(fe||(fe={}));const ge=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/.test(navigator.userAgent)||+(navigator.userAgent.match(/\bEdge\/12\.(\d+)\b/)||[])[1]<10547||+(navigator.userAgent.match(/\bAppleWebKit\/(\d+)\b/)||[])[1]<537,me={};function ve(){if(!ge)return;Array.from(document.querySelectorAll("svg > use")).forEach((function(t){const e=t.getAttribute("xlink:href"),[s,i]=e.split("#");if(!s.length||!i)return;const n=t.parentNode;n.removeChild(t),s in me||(me[s]=fetch(s).then(t=>t.text()));me[s].then(t=>{const e=document.implementation.createHTMLDocument("");e.documentElement.innerHTML=t;const s=e.getElementById(i).cloneNode(!0),r=document.createDocumentFragment();for(;s.childNodes.length;)r.appendChild(s.firstChild);n.appendChild(r)})}))}let we=!1;setTimeout(()=>we=!0);const ye={cancel:()=>{},promise:Promise.resolve()};function xe(t,e){if(0===e)return t(1,0,()=>{}),ye;const s=Date.now(),i=T();let n=0,r=!0;const o=()=>{r=!1,i.reject()};return function h(){r&&(!e||n<=e)&&window.requestAnimationFrame(h);const a=Date.now()-s;t(e?Math.min(1,a/e):a,a-n,o),e&&a>=e&&i.resolve(),n=a}(),{cancel:o,promise:i.promise}}function $e(t,e=0,s=0){switch(t){case"quad":return Math.pow(e,2);case"cubic":return Math.pow(e,3);case"quart":return Math.pow(e,4);case"quint":return Math.pow(e,5);case"circ":return 1-Math.sqrt(1-Math.pow(e,2));case"sine":return 1-Math.cos(e*Math.PI/2);case"exp":return e<=0?0:Math.pow(2,10*(e-1));case"back":return s||(s=1.70158),e*e*((s+1)*e-s);case"elastic":return s||(s=.3),-Math.pow(2,10*(e-1))*Math.sin((2*(e-1)/s-.5)*Math.PI);case"swing":return.5-Math.cos(e*Math.PI)/2;case"spring":return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e);case"bounce":return e<1/11?1/64-7.5625*(.5/11-e)*(.5/11-e):e<3/11?1/16-7.5625*(2/11-e)*(2/11-e):e<7/11?1/4-7.5625*(5/11-e)*(5/11-e):1-7.5625*(1-e)*(1-e);default:return e}}function be(t,e=0,s=0){if(0===e)return 0;if(1===e)return 1;const[i,n]=t.split("-");return"in"===n?$e(i,e,s):"out"===n?1-$e(i,1-e,s):e<=.5?$e(i,2*e,s)/2:1-$e(i,2*(1-e),s)/2}function Me(t,e,s=400,i=0,n="ease-in-out"){if(!we)return Object.keys(e).forEach(s=>{const i=e[s];t.css(s,Array.isArray(i)?i[1]:i)}),ye;"bounce-in"===n&&(n="cubic-bezier(0.175, 0.885, 0.32, 1.275)"),"bounce-out"===n&&(n="cubic-bezier(0.68, -0.275, 0.825, 0.115)");let r="";fe.isSafari&&(r=t._el.style.transition,t.css("transition","none"),fe.redraw());const o=t._data.animation;o&&o.cancel();const h={},a={},c=T(),l=window.getComputedStyle(t._el);Object.keys(e).forEach(s=>{const n=e[s],r=s.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,e)=>e.toUpperCase());a[r]=Array.isArray(n)?n[0]:l.getPropertyValue(s),h[r]=Array.isArray(n)?n[1]:n,i&&t.css(s,a[r])});const d=h.height;let u;"auto"===h.height&&(h.height=t.children.map(t=>t.outerHeight).reduce((t,e)=>t+e,0)+"px");let p=!1;A(()=>{p||(u=t._el.animate([a,h],{duration:s,easing:n,fill:"forwards"}),u.onfinish=()=>{t._el&&Object.keys(e).forEach(e=>t.css(e,"height"===e?d:h[e])),fe.isSafari&&t.css("transition",r),c.resolve(),u.cancel()})},i);const f={cancel(){p=!0,t._el&&Object.keys(e).forEach(e=>t.css(e,t.css(e))),u&&u.cancel()},promise:c.promise};return setTimeout(()=>t._data.animation=f),f}const Ce=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;function ke(t,e="fade",s=500,i=0){if(t.show(),!we)return ye;const n=+t.css("opacity")||1;if("fade"===e)return Me(t,{opacity:[0,n]},s,i);if("pop"===e){const e=t.transform.replace(/scale\([0-9.]*\)/,"").replace(Ce,"translate($1px,$2px)");return Me(t,{opacity:[0,n]},s,i),Me(t,{transform:[e+" scale(0.5)",e+" scale(1)"]},s,i,"bounce-in")}if("descend"===e){return Me(t,{opacity:[0,1],transform:["translateY(-50%)","none"]},s,i)}if(e.startsWith("draw")){const n=t.strokeLength;t.css("stroke-dasharray",n+"px"),t.css("opacity")||t.css("opacity",1);const r=Me(t,{"stroke-dashoffset":[n+"px","draw-reverse"===e?2*n+"px":0]},s,i,"linear");return r.promise.then(()=>t.css("stroke-dasharray","")),r}if(e.startsWith("slide")){const r={opacity:[0,n],transform:["translateY(50px)","none"]};return e.includes("down")&&(r.transform[0]="translateY(-50px)"),e.includes("right")&&(r.transform[0]="translateX(-50px)"),e.includes("left")&&(r.transform[0]="translateX(50px)"),Me(t,r,s,i)}if(e.startsWith("reveal")){const r={opacity:[0,n],height:[0,"auto"]};return e.includes("left")&&(r.transform=["translateX(-50%)","none"]),e.includes("right")&&(r.transform=["translateX(50%)","none"]),Me(t,r,s,i)}return ye}function Pe(t,e="fade",s=400,i=0,n=!1){if(!t._el)return ye;if(!we)return t.hide(),ye;if("none"===t.css("display"))return ye;let r;if("fade"===e)r=Me(t,{opacity:[1,0]},s,i);else if("pop"===e){const e=t.transform.replace(/scale\([0-9.]*\)/,"");Me(t,{opacity:[1,0]},s,i),r=Me(t,{transform:[e+" scale(1)",e+" scale(0.5)"]},s,i,"bounce-out")}else if("ascend"===e){r=Me(t,{opacity:[1,0],transform:["none","translateY(-50%)"]},s,i)}else if(e.startsWith("draw")){const n=t.strokeLength;t.css("stroke-dasharray",n);r=Me(t,{"stroke-dashoffset":["draw-reverse"===e?2*n+"px":0,n+"px"]},s,i,"linear")}else if(e.startsWith("slide")){const n={opacity:0,transform:"translateY(50px)"};e.includes("up")&&(n.transform="translateY(-50px)"),r=Me(t,n,s,i)}else if(e.startsWith("reveal")){const n={opacity:0,height:0};e.includes("left")&&(n.transform="translateX(-50%)"),e.includes("right")&&(n.transform="translateX(50%)"),r=Me(t,n,s,i)}return r.promise.then(()=>n?t.remove():t.hide()),r}class Ae extends L{constructor(t,e,s={}){let i;super(),this.$el=t,this.position=new W(0,0),this.disabled=!1,this.width=0,this.height=0,this.options=k(s,{moveX:!0,moveY:!0}),this.setDimensions(e),Et(t,{start:()=>{this.disabled||(i=this.position,this.trigger("start"),ue.addClass("grabbing"))},move:(t,e)=>{this.disabled||(this.setPosition(i.x+t.x-e.x,i.y+t.y-e.y),this.trigger("drag",this.position))},end:(t,e)=>{this.disabled||(this.trigger(t.equals(e)?"click":"end"),ue.removeClass("grabbing"))},accessible:!0}),fe.onResize(()=>{const t=this.width,s=this.height;this.setDimensions(e),this.setPosition(this.position.x*this.width/t||0,this.position.y*this.height/s||0)})}setDimensions(t){"svg"===t.type?(this.width=this.options.width||t.svgWidth,this.height=this.options.height||t.svgHeight):(this.width=this.options.width||t.width,this.height=this.options.height||t.height)}setPosition(t,e){const s=this.options.margin||0;let i=new W(this.options.moveX?t:0,this.options.moveY?e:0).clamp(new U(0,this.width,0,this.height),s).round(this.options.snap||1);this.options.round&&(i=this.options.round(i)),i.equals(this.position)||(this.position=i,this.options.useTransform?this.$el.translate(i.x,i.y):(this.options.moveX&&this.$el.css("left",i.x+"px"),this.options.moveY&&this.$el.css("top",i.y+"px")),this.trigger("move",i))}}function Te(t){const e=new Map,s=new Map;let i=void 0,n=0;function r(t){i=t;const e=t(u);return i=void 0,e}function o(t){for(const s of e.values())s.has(t)&&s.delete(t)}function h(e,n){s.has(e)&&o(s.get(e));const h=()=>{t[e]=n(u),i===h&&(i=void 0),a(e)};s.set(e,h),r(h)}function a(s){const i=e.get(s);if(i)for(const e of i)e(t)}function c(){for(const s of e.values())for(const e of s)e(t)}function l(e){Object.assign(t,e),c()}function d(){return n+=1,"_x"+n}const u=new Proxy(t,{get:(s,n)=>"watch"===n?r:"unwatch"===n?o:"setComputed"===n?h:"forceUpdate"===n?c:"assign"===n?l:"getKey"===n?d:"_internal"===n?[t,e]:(i&&(e.has(n)||e.set(n,new Set),e.get(n).add(i)),t[n]),set:(e,i,n)=>(t[i]===n||(t[i]=n,s.has(i)&&(o(s.get(i)),s.delete(i)),a(i)),!0),deleteProperty:(i,n)=>(delete t[n],e.delete(n),s.delete(n),!0)});return u}function Se(t,e){const s=e.regex.exec(t);if(s){s.shift();const t={};for(const[i,n]of e.params.entries())t[n]=s[i];return t}}let _e="complete"===document.readyState;window.addEventListener("load",()=>setTimeout(()=>_e=!0)),"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");const Ie=new class extends L{constructor(){super(...arguments),this.$viewport=de,this.views=[],this.active={path:"",hash:"",index:0},this.search=window.location.search,this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(t={}){t.$viewport&&(this.$viewport=t.$viewport),t.initialise&&(this.initialise=t.initialise),t.preloaded&&(this.preloaded=t.preloaded),t.transition&&(this.transition=t.transition),t.noLoad&&(this.noLoad=t.noLoad),t.click&&de.on("click",t=>this.onLinkClick(t)),t.history&&window.addEventListener("popstate",t=>{_e&&t.state&&this.goToState(t.state)})}view(t,{enter:e,exit:s,template:i}={}){const n=(t.match(/:\w+/g)||[]).map(t=>t.substr(1)),r=t.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")+"\\/?",o=t.includes("?")?"":"(\\?.*)?",h={regex:new RegExp("^"+r+o+"$","i"),params:n,enter:e,exit:s,template:i};this.views.push(h);const a=Se(window.location.pathname,h);a&&(this.active={path:window.location.pathname+this.search,hash:window.location.hash,index:0},window.history.replaceState(this.active,"",this.active.path+this.active.hash),fe.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,a),h.enter&&h.enter(this.$viewport,a)):this.loadView(h,a,window.location.pathname)})}))}paths(...t){for(const e of t)this.view(e)}getView(t){for(const e of this.views){const s=Se(t,e);if(s)return{view:e,params:s}}}load(t,e=""){const s=this.getView(t);return t===this.active.path&&e!==this.active.hash?(this.trigger("hashChange",e.slice(1)),this.trigger("change",t+e),!0):!(!s||t===this.active.path)&&(this.trigger("change",t+e),window.ga&&window.ga("send","pageview",t+e),this.noLoad?s.view.enter&&s.view.enter(this.$viewport,s.params):this.loadView(s.view,s.params,t),!0)}loadView(t,e={},s=""){return dt(this,void 0,void 0,(function*(){this.$viewport.css({opacity:.4,"pointer-events":"none"});const i=yield function(t,e,s){return dt(this,void 0,void 0,(function*(){return t.template?"string"==typeof t.template?t.template:t.template(e):(yield fetch(s+(s.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()}))}(t,e,s);this.$viewport.css("opacity",0),setTimeout(()=>{this.$viewport.removeChildren(),de.scrollTop=0,this.$viewport.html=i,fe.resize(),ve(),this.$viewport.css({opacity:1,"pointer-events":"all"});const s=this.$viewport.$("title");s&&(document.title=s.text),this.initialise(this.$viewport,e),t.enter&&t.enter(this.$viewport,e),this.trigger("afterChange",{$viewport:this.$viewport})},350)}))}onLinkClick(t){if(t.metaKey||t.ctrlKey||t.shiftKey)return;if(t.defaultPrevented)return;let e=t.target;for(;e&&"A"!==e.nodeName;)e=e.parentNode;if(!e||"A"!==e.nodeName)return;const s=e;if(s.target)return;if(s.origin!==window.location.origin)return;if(s.hasAttribute("download")||"external"===s.getAttribute("rel"))return;const i=s.getAttribute("href");if(i&&i.indexOf("mailto:")>-1)return;this.goTo(s.pathname+s.search,s.hash)&&t.preventDefault()}goToState(t){if(!t||!t.path)return;const e=this.load(t.path+this.search,t.hash);e&&t.index<this.active.index&&this.trigger("back"),e&&t.index>this.active.index&&this.trigger("forward"),this.active=t}goTo(t,e=""){const s=this.load(t,e);if(s){const s=this.active?this.active.index+1:0;this.active={path:t,hash:e,index:s},window.history.pushState(this.active,"",t+e)}return s}back(){window.history.back()}forward(){window.history.forward()}};const Ee=new Map;class Le extends HTMLElement{constructor(){super(...arguments),this.wasConnected=!1,this.isReady=!1}connectedCallback(){return dt(this,void 0,void 0,(function*(){if(this.wasConnected)return void this._view.trigger("connected");this.wasConnected=!0,this.isReady=!1,this._view.created();const t=Ee.get(this._view.tagName)||{};(t.template||t.templateId)&&function(t,e){const s=Array.from(t.childNodes);if(e.template)t.innerHTML=e.template;else if(e.templateId){const s=document.querySelector(e.templateId);if(!s)throw new Error("Template not found: "+e.templateId);for(;t.firstChild;)t.removeChild(t.firstChild);const i=s.content,n=document.importNode(i,!0);t.appendChild(n)}if(!s.length)return;const i=t.querySelector("slot:not([name])");for(const e of s){const s=e.getAttribute?e.getAttribute("slot"):void 0,n=s?t.querySelector(`slot[name="${s}"]`):i;n&&n.parentNode.insertBefore(e,n)}for(const e of Array.from(t.querySelectorAll("slot")))e.parentNode.removeChild(e)}(this,t);const e=function t(e){const s=[];for(const i of Array.from(e.children))i.tagName.startsWith("X-")?s.push(i):s.push(...t(i));return s}(this).filter(t=>!t.isReady).map(t=>new Promise(e=>t.addEventListener("ready",e)));yield Promise.all(e),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0}))}disconnectedCallback(){this._view.trigger("disconnected")}attributeChangedCallback(t,e,s){this._view.trigger("attr:"+t,{newVal:s,oldVal:e})}}class qe extends Qt{created(){}ready(){}}function Oe(t,e={}){return function(s){class i extends Le{constructor(){super(),this._view=new s(this)}}i.observedAttributes=e.attributes||[],Ee.set(t.toUpperCase(),e),window.customElements.define(t,i)}}class Re{constructor(t){this.clipEndTime=0,this.player=new Audio(t),this.player.preload="true",this.player.addEventListener("timeupdate",()=>{this.player.currentTime>=this.clipEndTime&&this.triggerCallback(!0)}),window.addEventListener("beforeunload",()=>this.player.pause())}playClip(t,e,s){this.triggerCallback(!1),this.player.currentTime=t,this.clipEndTime=e,this.clipCallback=s,this.player.play()}triggerCallback(t){if(!this.clipCallback)return;const e=this.clipCallback;this.clipCallback=void 0,this.player.pause(),e({ended:t})}pause(){this.triggerCallback(!1)}get isPlaying(){return!!this.clipCallback}}let Ne=!1,je=void 0;class Ve{constructor(t,e){this.audio=t,this.paragraphs=[],this.paragraphs=e.$$(".voice").map(e=>new Be(e,t));for(const[t,s]of this.paragraphs.entries())s.on("end",()=>{var s;if(this.paragraphs[t+1])this.paragraphs[t+1].play();else{const t=e.nextStep;t&&t.isShown&&(null===(s=t.narration)||void 0===s||s.play())}})}play(){var t;!this.audio.isPlaying&&Ne&&(null===(t=this.paragraphs[0])||void 0===t||t.play())}}class Be extends v{constructor(t,e){super(),this.$p=t,this.audio=e,this.playing=void 0,this.sentences=t.$$(".sentence[data-timings]").map(t=>new De(t,e)),this.$button=le("button",{class:"playback-btn"}),this.$button.on("click",()=>{this.playing?this.audio.pause():this.play(),Ne=!Ne,je=void 0}),t.prepend(this.$button),t.addClass("sentence-wrap");for(const[t,e]of this.sentences.entries())e.on("end",e=>{this.playing=void 0,e&&this.sentences[t+1]?setTimeout(()=>this.play(this.sentences[t+1]),200):(this.$button.removeClass("active"),e&&setTimeout(()=>this.trigger("end"),400))})}play(t){const e=t||this.sentences[0],s=e.$reveal;if(s&&"hidden"===s.css("visibility"))return this.$button.removeClass("active"),je=s,void s.one("reveal",()=>{je!==s||this.audio.isPlaying||this.play(e)});this.playing=e,this.playing.play(),this.$button.addClass("active");const i=this.$p.parents("x-tabbox .tab")[0];if(i){const t=i.parents("x-tabbox")[0];t.makeActive(i.index());const e=t.active;t.one("change",t=>{this.playing&&t!==e&&this.audio.pause()})}const n=this.$p.bounds,r=n.top+n.height-fe.height+20;r>0&&de.scrollBy(r+100),setTimeout(()=>this.$button.focus(),800)}}class De extends v{constructor(t,e){super(),this.$el=t,this.audio=e;const s=t.attr("data-timings").split("-");this.start=+s[0]/1e3,this.end=(+s[1]-200)/1e3}play(){this.$el.addClass("playing"),this.audio.playClip(this.start,this.end,({ended:t})=>{this.$el.removeClass("playing"),this.trigger("end",t)})}get $reveal(){return this.$el.parents(".reveal")[0]}}function ze(t,...e){return e.includes(t)}function He(t,e=0){return t[t.length-1-e]}function We(t){return t.filter((e,s)=>t.indexOf(e)===s)}function Fe(t){return t.reduce((t,e)=>t.concat(Array.isArray(e)?Fe(e):e),[])}function Ue(t,e=/\s+/){return t?t.trim().split(e):[]}function Ke(t,e,s=1e-6){return!isNaN(t)&&!isNaN(e)&&Math.abs(t-e)<s}class Ge extends Error{constructor(t,e){super(e),this.name=t}static undefinedVariable(t){return new Ge("EvalError",`Undefined variable “${t}”.`)}static undefinedFunction(t){return new Ge("EvalError",`Undefined function “${t}”.`)}static invalidCharacter(t){return new Ge("SyntaxError",`Unknown symbol “${t}”.`)}static conflictingBrackets(t){return new Ge("SyntaxError",`Conflicting brackets “${t}”.`)}static unclosedBracket(t){return new Ge("SyntaxError",`Unclosed bracket “${t}”.`)}static startOperator(t){return new Ge("SyntaxError",`A term cannot start with a “${t}”.`)}static endOperator(t){return new Ge("SyntaxError",`A term cannot end with a “${t}”.`)}static consecutiveOperators(t,e){return new Ge("SyntaxError",`A “${t}” cannot be followed by a “${e}”.`)}static invalidExpression(){return new Ge("SyntaxError","This expression is invalid.")}}const Xe={pi:Math.PI,"π":Math.PI,e:Math.E},Ye={"(":")","[":"]","{":"}","|":"|"},Ze={"*":"·","**":"∗","//":"//","+-":"±","–":"−","-":"−",xx:"×",sum:"∑",prod:"∏",int:"∫",del:"∂",grad:"∇",aleph:"ℵ",not:"¬",AA:"∀",EE:"∃","'":"’","!=":"≠","<=":"≤",">=":"≥",in:"∈","!in":"∉","==":"≡","~=":"≅","~~":"≈",sub:"⊂",sube:"⊆",prop:"∝",oo:"∞","<-":"←","->":"→","=>":"⇒","<=>":"⇔","|->":"↦",uarr:"↑",darr:"↓",lArr:"⇐"},Je={Gamma:"Γ",Delta:"Δ",Theta:"Θ",Lambda:"Λ",Xi:"Ξ",Pi:"Π",Sigma:"Σ",Phi:"Φ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ɛ",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",pi:"π",rho:"ρ",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",CC:"ℂ",NN:"ℕ",QQ:"ℚ",RR:"ℝ",ZZ:"ℤ"},Qe="abcdefghijklmnopqrstuvwxyz",ts=[...Qe.split(""),...Qe.toUpperCase().split(""),...Object.values(Je),"$"],es=[..."|()[]{}÷,!<>=*/+-–−~^_…°•∥⊥'∠:%∼△",...Object.values(Ze)],ss={_:"sub","^":"sup","//":"/","÷":"/"},is={"<":"&lt;",">":"&gt;"};function ns(t){return t in is?is[t]:t}const rs=new Set(["sin","cos","tan","sec","csc","cot","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","exp","log","ln","det","dim","mod","gcd","lcm","min","max"]);function os(t){return rs.has(t)}const hs={"+":"plus","−":"minus","·":"times","×":"times","/":"over","//":"divided by","%":"percent","!":"factorial","±":"plus-minus","=":"equals","≠":"does not equal","<":"is less than",">":"is greater than","≤":"is less than or equal to","≥":"is greater than or equal to","π":"pi","≅":"is congruent to","∥":"is parallel to","⊥":"is perpendicular to"};for(const t of Object.keys(Je))hs[Je[t]]=t;class as{evaluate(t={}){return NaN}substitute(t={}){return this}get simplified(){return this}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(t={}){return""}toMathML(t={}){return""}}class cs extends as{constructor(t){super(),this.n=t}evaluate(){return this.n}toString(){return""+this.n}toVoice(){return""+this.n}toMathML(){return`<mn>${this.n}</mn>`}}class ls extends as{constructor(t){super(),this.i=t}evaluate(t={}){if(this.i in t)return t[this.i];if(this.i in Xe)return Xe[this.i];throw Ge.undefinedVariable(this.i)}toMathML(){return`<mi${os(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(t={}){return t[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in hs?hs[this.i]:1===this.i.length?`_${this.i}_`:this.i}}class ds extends as{constructor(t){super(),this.s=t}evaluate(t={}){if(this.s in t)return t[this.s];throw Ge.undefinedVariable(this.s)}toString(){return'"'+this.s+'"'}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}}class us extends as{toString(){return" "}toMathML(){return"<mspace></mspace>"}}class ps extends as{constructor(t){super(),this.o=t}toString(){return this.o.replace("//","/")}toVoice(){return hs[this.o]||this.o}get functions(){return[this.o]}toMathML(){const t=ns(this.toString());return`<mo value="${t}">${t}</mo>`}}const fs=Ue("+ − * × · / ÷ // sup sub subsup"),gs=Ue("sub sup subsup"),ms='<mo value="," lspace="0">,</mo>';function vs(t,e){return!!fs.includes(e)&&(t instanceof $s||t instanceof xs&&(!!fs.includes(t.fn)&&(!(!gs.includes(t.fn)||!gs.includes(e))||fs.indexOf(e)>fs.indexOf(t.fn))))}function ws(t,e){return t instanceof $s||t instanceof xs?`<mrow>${e}</mrow>`:e}function ys(t){return"2"===t?"squared":"3"===t?"cubed":"to the power of "+t}class xs extends as{constructor(t,e=[]){super(),this.fn=t,this.args=e}evaluate(t={}){const e=this.args.map(e=>e.evaluate(t));if(this.fn in t)return t[this.fn](...e);switch(this.fn){case"+":return e.reduce((t,e)=>t+e,0);case"−":return e.length>1?e[0]-e[1]:-e[0];case"*":case"·":case"×":return e.reduce((t,e)=>t*e,1);case"/":return e[0]/e[1];case"sin":case"cos":case"tan":return Math.sin(e[0]);case"log":return Math.log(e[0])/Math.log(e[1]||Math.E);case"sup":return Math.pow(e[0],e[1]);case"sqrt":return Math.sqrt(e[0]);case"root":return Math.pow(e[0],1/e[1]);case"(":return e[0]}throw Ge.undefinedFunction(this.fn)}substitute(t={}){return new xs(this.fn,this.args.map(e=>e.substitute(t)))}collapse(){return"("===this.fn?this.args[0].collapse():new xs(this.fn,this.args.map(t=>t.collapse()))}get simplified(){return this}get variables(){return We(Fe(this.args.map(t=>t.variables)))}get functions(){return We([this.fn,...Fe(this.args.map(t=>t.functions))])}toString(){const t=this.args.map(t=>vs(t,this.fn)?"("+t.toString()+")":t.toString());return"−"===this.fn?t.length>1?t.join(" − "):"−"+t[0]:"sup"===this.fn?t.join("^"):"sub"===this.fn?t.join("_"):"subsup"===this.fn?`${t[0]}_${t[1]}^${t[2]}`:Ue("+ * × · / = < > ≤ ≥ ≈").includes(this.fn)?t.join(" "+this.fn+" "):ze(this.fn,"(","[","{")?this.fn+this.args.join(", ")+Ye[this.fn]:ze(this.fn,"!","%")?t[0]+this.fn:`${this.fn}(${t.join(", ")})`}toMathML(t={}){const e=this.args.map(e=>e.toMathML(t)),s=this.args.map((t,s)=>{return i=t,n=this.fn,r=e[s],vs(i,n)?`<mfenced>${r}</mfenced>`:r;var i,n,r});if(this.fn in t){const s=e.map((t,e)=>({toString:()=>t,val:this.args[e]}));return t[this.fn](...s)}if("−"===this.fn)return s.length>1?s.join('<mo value="−">−</mo>'):'<mo rspace="0" value="−">−</mo>'+s[0];if(ze(this.fn,"+","=","<",">","≤","≥","≈")){const t=ns(this.fn);return s.join(`<mo value="${t}">${t}</mo>`)}if(ze(this.fn,"*","×","·")){let t=s[0];for(let e=1;e<s.length-1;++e){t+=(this.args[0]instanceof cs&&this.args[1]instanceof cs?'<mo value="×">×</mo>':"")+s[1]}return t}if("//"===this.fn)return s.join('<mo value="/">/</mo>');if("sqrt"===this.fn)return`<msqrt>${s[0]}</msqrt>`;if(ze(this.fn,"/","root")){const t="/"===this.fn?"mfrac":"mroot";return`<${t}>${this.args.map((t,s)=>ws(t,e[s])).join("")}</${t}>`}if(ze(this.fn,"sup","sub")){const t=[ws(this.args[0],s[0]),ws(this.args[1],e[1])];return`<m${this.fn}>${t.join("")}</m${this.fn}>`}if("subsup"===this.fn){return`<msubsup>${[ws(this.args[0],s[0]),ws(this.args[1],e[1]),ws(this.args[2],e[2])].join("")}</msubsup>`}if(ze(this.fn,"(","[","{"))return`<mfenced open="${this.fn}" close="${Ye[this.fn]}">${s.join(ms)}</mfenced>`;if(ze(this.fn,"!","%"))return s[0]+`<mo value="${this.fn}" lspace="0">${this.fn}</mo>`;if("abs"===this.fn)return`<mfenced open="|" close="|">${s.join(ms)}</mfenced>`;if("bar"===this.fn)return`<mover>${ws(this.args[0],s[0])}<mo value="‾">‾</mo></mover>`;if("vec"===this.fn)return`<mover>${ws(this.args[0],s[0])}<mo value="→">→</mo></mover>`;return`<mi${os(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${s.join(ms)}</mfenced>`}toVoice(t={}){const e=this.args.map(e=>e.toVoice(t)),s=e.join(" ");if(this.fn in t){const s=e.map((t,e)=>({toString:()=>t,val:this.args[e]}));return t[this.fn](...s)}return ze(this.fn,"(","[","{")?s:"sqrt"===this.fn?"square root of "+s:"%"===this.fn?s+" percent":"!"===this.fn?s+" factorial":"/"===this.fn?`${e[0]} over ${e[1]}`:"//"===this.fn?`${e[0]} divided by ${e[1]}`:"sub"===this.fn?s:"subsup"===this.fn?`${e[0]} ${e[1]} ${ys(e[2])}`:"sup"===this.fn?`${e[0]} ${ys(e[1])}`:hs[this.fn]?e.join(` ${hs[this.fn]} `):os(this.fn)?`${this.fn} ${s}`:`${this.fn} of ${s}`}}class $s extends as{constructor(t){super(),this.items=t}evaluate(t={}){return this.collapse().evaluate(t)}substitute(t={}){return this.collapse().substitute(t)}get simplified(){return this.collapse().simplified}get variables(){return We(function(...t){return t.reduce((t,e)=>t.concat(e),[])}(...this.items.map(t=>t.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(t=>t.toString()).join(" ")}toMathML(t={}){return this.items.map(e=>e.toMathML(t)).join("")}toVoice(t={}){return this.items.map(e=>e.toVoice(t)).join(" ")}collapse(){return function(t){if(!(t=t.filter(t=>!(t instanceof us))).length)throw Ge.invalidExpression();if(ks(t[0],"%!"))throw Ge.startOperator(t[0]);for(let e=0;e<t.length;++e)ks(t[e],"%!")&&(t.splice(e-1,2,new xs(t[e].o,[t[e-1]])),e-=1);As(t,"= < > ≤ ≥"),As(t,"// ÷"),ks((t=Ss(t,"× * ·",!0))[0],"− ±")&&t.splice(0,2,new xs(t[0].o,[t[1]]));As(t,"− ±"),ks(t[0],"+")&&(t=t.slice(1));if((t=Ss(t,"+")).length>1)throw Ge.invalidExpression();return t[0]}(this.items).collapse()}}var bs;function Ms(t,e){if(e===bs.STR)return new ds(t);if(t&&e){if(e===bs.SPACE&&t.length>1)return new us;if(e===bs.NUM){if(isNaN(+t))throw Ge.invalidExpression();return new cs(+t)}return e===bs.VAR?t in Je?new ls(Je[t]):t in Ze?new ps(Ze[t]):new ls(t):e===bs.OP?new ps(t in Ze?Ze[t]:t):void 0}}function Cs(t,e){const s=[[]];for(const i of t)e(i)?s.push([]):He(s).push(i);return s}function ks(t,e){return t instanceof ps&&Ue(e).includes(t.o)}function Ps(t){return t instanceof xs&&"("===t.fn?t.args[0]:t}function As(t,e){if(ks(t[0],e))throw Ge.startOperator(t[0]);if(ks(He(t),e))throw Ge.endOperator(He(t));for(let s=1;s<t.length-1;++s){if(!ks(t[s],e))continue;const i=t[s],n=t[s-1],r=t[s+1];if(n instanceof ps)throw Ge.consecutiveOperators(n.o,i.o);if(r instanceof ps)throw Ge.consecutiveOperators(i.o,r.o);const o=t[s+2];if("^ _"===e&&ks(i,"_ ^")&&ks(o,"_ ^")&&i.o!==o.o){const e=t[s+3];if(e instanceof ps)throw Ge.consecutiveOperators(o.o,e.o);const h=[Ps(n),Ps(r),Ps(e)];"^"===i.o&&([h[1],h[2]]=[h[2],h[1]]),t.splice(s-1,5,new xs("subsup",h)),s-=4}else{const e=ss[i.o]||i.o,o=[Ps(n),Ps(r)];t.splice(s-1,3,new xs(e,o)),s-=2}}}function Ts(t){return As(t,"^ _"),As(t,"/"),(e=t).length>1||e[0]instanceof ps?new $s(e):e[0];var e}function Ss(t,e,s=!1){const i=[];let n=[],r=!1;function o(){if(r)throw Ge.invalidExpression();n.length&&(i.push(n.length>1?new xs(e[0],n):n[0]),n=[])}for(const h of t)if(ks(h,e)){if(r||!n.length)throw Ge.invalidExpression();r=!0}else if(h instanceof ps)o(),i.push(h),r=!1;else{const t=!s||h instanceof cs;if(n.length&&!r&&t)throw Ge.invalidExpression();n.push(h),r=!1}return o(),i}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPACE=1]="SPACE",t[t.STR=2]="STR",t[t.NUM=3]="NUM",t[t.VAR=4]="VAR",t[t.OP=5]="OP"}(bs||(bs={}));const _s={numEquals:function(t,e){try{const s=We([...t.variables,...e.variables]),i=t.collapse(),n=e.collapse();let r=0;for(let t=0;t<5;++t){const t={};for(const e of s)t[e]=Xe[e]||5*Math.random();const e=i.evaluate(t),o=n.evaluate(t);if(!isNaN(e)&&!isNaN(o)){if(!Ke(e,o))return!1;r+=1}}return!!r}catch(t){return!1}},parse:function(t){const e=new Map;return function(...s){const i=s.join("--");return e.has(i)||e.set(i,t(...s)),e.get(i)}}((function(t,e=!1){const s=function(t){const e=[[]];for(const s of t){const t=He(e).length?He(e)[0].o:void 0;if(ks(s,") ] }")||ks(s,"|")&&"|"===t){if(!ks(s,Ye[t]))throw Ge.conflictingBrackets(s.o);const i=e.pop(),n=He(e),r=ks(s,")")&&He(n)instanceof ls&&"π"!==He(n).i?n.pop().i:ks(s,"|")?"abs":i[0].o,o=Cs(i.slice(1),t=>ks(t,","));n.push(new xs(r,o.map(Ts)))}else ks(s,"( [ { |")?e.push([s]):He(e).push(s)}if(e.length>1)throw Ge.unclosedBracket(He(e)[0].o);return Ts(e[0])}(function(t){const e=[];let s="",i=bs.UNKNOWN;for(const n of t){if('"'===n){const t=i===bs.STR?bs.UNKNOWN:bs.STR,n=Ms(s,i);n&&e.push(n),s="",i=t;continue}if(i===bs.STR){s+=n;continue}const t=n.match(/[0-9.]/)?bs.NUM:ts.includes(n)?bs.VAR:es.includes(n)?bs.OP:n.match(/\s/)?bs.SPACE:bs.UNKNOWN;if(!t)throw Ge.invalidCharacter(n);if(!i||i===bs.NUM&&t!==bs.NUM||i===bs.VAR&&t!==bs.VAR&&t!==bs.NUM||i===bs.OP&&!(s+n in Ze)||i===bs.SPACE&&t!==bs.SPACE){const n=Ms(s,i);n&&e.push(n),s="",i=t}s+=n}const n=Ms(s,i);return n&&e.push(n),e}(t));return e?s.collapse():s}))};function Is(t,...e){return e.includes(t)}function Es(t,e){return new Array(e).fill(t)}function Ls(t){return t.reduce((t,e)=>t+e,0)}function qs(t){const e=t.map(t=>({val:t,next:void 0})),s=e.length;for(let t=0;t<s-1;++t)e[t].next=e[t+1];return e[s-1].next=e[0],e}function Os(t,e,s=1e-6){return!isNaN(t)&&!isNaN(e)&&Math.abs(t-e)<s}function Rs(t,e,s,i=1e-6){return e>s&&([e,s]=[s,e]),t>e+i&&t<s-i}const Ns=/(\d+)(\d{3})/,js=["","k","m","b","t","q"];function Vs(t,e=0,s=!0){const i=function(t,e=6){if(!e)return""+t;const s=(""+Math.abs(Math.floor(t))).length,i=t<0?1:0;if(s<=e-i)return""+Gs(t,e-s-i-1);const n=Math.floor(Math.log10(Math.abs(t))/3);return Gs(t/Math.pow(10,3*n),e-(s%3||3)-i-1)+js[n]}(t,e).replace("-","–");return s?function(t){let[e,s]=t.split(".");for(;Ns.test(e);)e=e.replace(Ns,"$1,$2");return e+(s?"."+s:"")}(i):i}const Bs=/^-?0,[0-9]+$/,Ds=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,zs=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;const Hs=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],Ws=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],Fs=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function Us(t){const[e,s,i]=t.split(""),n="0"===e?"":" "+Hs[+e]+" hundred";return s+i==="00"?n:+s<2?n+" "+Hs[+(s+i)]:"0"===i?n+" "+Ws[+s]:n+" "+Ws[+s]+"-"+Hs[+i]}function Ks(t){if(0===t)return"zero";const e=Math.round(Math.abs(t)).toString(),s=Math.ceil(e.length/3),i=e.padStart(3*s,"0");let n="";for(let t=0;t<s;t+=1){const e=i.substr(3*t,3);"000"!==e&&(n+=Us(e)+Fs[s-1-t])}return n.trim()}function Gs(t,e=0){const s=Math.pow(10,e);return Math.round(t*s)/s}function Xs(t,e=1){return Math.round(t/e)*e}function Ys(t,e=-1/0,s=1/0){return Math.min(s,Math.max(e,t))}function Zs(t,e,s=.5){return t+(e-t)*s}function Js(t){return t*t}function Qs(t,e){return(t%e+e)%e}function ti(t,e=0){const s=function t(e){if(1===e.length)return[[],e];const s=e.pop(),i=t(e),n=[];for(const t of i)n.push(t,[...t,s]);return n}(t.slice(0));return e?s.filter(t=>t.length===e):s}const ei=(t,e)=>{const s=t<0?"–":"";return 1===Math.abs(t)&&e?s+e:s+Math.abs(t)+(e||"")};class si{constructor(t=0,e=0){this.re=t,this.im=e}get modulus(){return Math.sqrt(this.re*this.re+this.im*this.im)}get argument(){return Math.atan2(this.im,this.re)}get conjugate(){return new si(this.re,-this.im)}root(t,e=0){const s=Math.pow(this.modulus,1/t),i=(this.argument+2*e*Math.PI)/t;return new si(s*Math.cos(i),s*Math.sin(i))}toString(t=2){const e=Gs(this.re,t),s=Gs(this.im,t);return 0===s?ei(e):0===e?ei(s,"i"):[ei(e),s<0?"–":"+",ei(Math.abs(s),"i")].join(" ")}add(t){return si.sum(this,t)}subtract(t){return si.difference(this,t)}multiply(t){return si.product(this,t)}divide(t){return si.quotient(this,t)}static sum(t,e){return"number"==typeof t&&(t=new si(t,0)),"number"==typeof e&&(e=new si(e,0)),new si(t.re+e.re,t.im+e.im)}static difference(t,e){return"number"==typeof t&&(t=new si(t,0)),"number"==typeof e&&(e=new si(e,0)),new si(t.re-e.re,t.im-e.im)}static product(t,e){"number"==typeof t&&(t=new si(t,0)),"number"==typeof e&&(e=new si(e,0));const s=t.re*e.re-t.im*e.im,i=t.im*e.re+t.re*e.im;return new si(s,i)}static quotient(t,e){if("number"==typeof t&&(t=new si(t,0)),"number"==typeof e&&(e=new si(e,0)),Math.abs(e.re)<Number.EPSILON||Math.abs(e.im)<Number.EPSILON)return new si(1/0,1/0);const s=e.re*e.re+e.im*e.im,i=(t.re*e.re+t.im*e.im)/s,n=(t.im*e.re-t.re*e.im)/s;return new si(i,n)}static exp(t){"number"==typeof t&&(t=new si(t,0));const e=Math.exp(t.re);return new si(e*Math.cos(t.im),e*Math.sin(t.im))}}class ii{constructor(t=0,e=0){this.x=t,this.y=e,this.type="point"}get unitVector(){return Os(this.length,0)?new ii(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new ii(-this.x,-this.y)}get flip(){return new ii(this.y,this.x)}get perpendicular(){return new ii(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(t){return ii.distance(this,t.project(this))}clamp(t,e=0){const s=Ys(this.x,t.xMin+e,t.xMax-e),i=Ys(this.y,t.yMin+e,t.yMax-e);return new ii(s,i)}transform(t){const e=t[0][0]*this.x+t[0][1]*this.y+t[0][2],s=t[1][0]*this.x+t[1][1]*this.y+t[1][2];return new ii(e,s)}rotate(t,e=ni){const s=this.x-e.x,i=this.y-e.y,n=Math.cos(t),r=Math.sin(t),o=s*n-i*r+e.x,h=s*r+i*n+e.y;return new ii(o,h)}reflect(t){const e=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y,i=this.x-t.p1.x,n=(e*(this.y-t.p1.y)-s*i)/(e*e+s*s),r=this.x+2*n*s,o=this.y-2*n*e;return new ii(r,o)}scale(t,e=t){return new ii(this.x*t,this.y*e)}shift(t,e=t){return new ii(this.x+t,this.y+e)}translate(t){return this.shift(t.x,t.y)}changeCoordinates(t,e){const s=e.xMin+(this.x-t.xMin)/t.dx*e.dx,i=e.yMin+(this.y-t.yMin)/t.dy*e.dy;return new ii(s,i)}add(t){return ii.sum(this,t)}subtract(t){return ii.difference(this,t)}equals(t){return Os(this.x,t.x)&&Os(this.y,t.y)}round(t=1){return new ii(Xs(this.x,t),Xs(this.y,t))}floor(){return new ii(Math.floor(this.x),Math.floor(this.y))}mod(t,e=t){return new ii(this.x%t,this.y%e)}angle(t=ni){return ai(this,t)}static average(...t){const e=Ls(t.map(t=>t.x))/t.length,s=Ls(t.map(t=>t.y))/t.length;return new ii(e,s)}static dot(t,e){return t.x*e.x+t.y*e.y}static sum(t,e){return new ii(t.x+e.x,t.y+e.y)}static difference(t,e){return new ii(t.x-e.x,t.y-e.y)}static distance(t,e){return Math.sqrt(Js(t.x-e.x)+Js(t.y-e.y))}static manhattan(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}static interpolate(t,e,s=.5){return new ii(Zs(t.x,e.x,s),Zs(t.y,e.y,s))}static interpolateList(t,e=.5){const s=t.length-1,i=Math.floor(Ys(e,0,1)*s);return ii.interpolate(t[i],t[i+1],s*e-i)}static fromPolar(t,e=1){return new ii(e*Math.cos(t),e*Math.sin(t))}}const ni=new ii(0,0);class ri{constructor(t,e,s,i){this.xMin=t,this.xMax=e,this.yMin=s,this.yMax=i}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}get rect(){return new wi(new ii(this.xMin,this.xMin),this.dx,this.dy)}}const oi=2*Math.PI;class hi{constructor(t,e,s){this.a=t,this.b=e,this.c=s,this.type="angle"}transform(t){return new hi(this.a.transform(t),this.b.transform(t),this.c.transform(t))}get rad(){const t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x);let e=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-t;return e<0&&(e+=oi),e}get deg(){return 180*this.rad/Math.PI}get isRight(){return Os(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a))return;if(this.b.equals(this.c))return;const t=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),e=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x);let s=(t+e)/2;t>e&&(s+=Math.PI);const i=Math.cos(s)+this.b.x,n=Math.sin(s)+this.b.y;return new ci(this.b,new ii(i,n))}get sup(){return this.rad<Math.PI?this:new hi(this.c,this.b,this.a)}get arc(){return new pi(this.b,this.a,this.rad)}equals(t){return!1}project(){return this.b}at(){return this.b}}function ai(t,e=ni){return(Math.atan2(t.y-e.y,t.x-e.x)+oi)%oi}class ci{constructor(t,e){this.p1=t,this.p2=e,this.type="line"}make(t,e){return new ci(t,e)}get length(){return ii.distance(this.p1,this.p2)}get midpoint(){return ii.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return ai(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new ii(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(t){const e=ii.sum(t,ii.difference(this.p2,this.p1));return new ci(t,e)}perpendicular(t){return new ci(t,ii.sum(t,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}project(t){const e=ii.difference(this.p2,this.p1),s=ii.difference(t,this.p1),i=e.scale(ii.dot(e,s)/this.length**2);return ii.sum(this.p1,i)}contains(t){return Os(t.x*(this.p1.y-this.p2.y)+this.p1.x*(this.p2.y-t.y)+this.p2.x*(t.y-this.p1.y),0)}at(t){return ii.interpolate(this.p1,this.p2,t)}transform(t){return new this.constructor(this.p1.transform(t),this.p2.transform(t))}rotate(t,e=ni){return new this.constructor(this.p1.rotate(t,e),this.p2.rotate(t,e))}reflect(t){return new this.constructor(this.p1.reflect(t),this.p2.reflect(t))}scale(t,e=t){return this.make(this.p1.scale(t,e),this.p2.scale(t,e))}shift(t,e=t){return this.make(this.p1.shift(t,e),this.p2.shift(t,e))}translate(t){return this.shift(t.x,t.y)}equals(t){return this.contains(t.p1)&&this.contains(t.p2)}}class li extends ci{constructor(){super(...arguments),this.type="ray"}make(t,e){return new li(t,e)}equals(t){return"ray"===t.type&&(this.p1.equals(t.p1)&&this.contains(t.p2))}}class di extends ci{constructor(){super(...arguments),this.type="segment"}contains(t){return!!ci.prototype.contains.call(this,t)&&(Os(this.p1.x,this.p2.x)?Rs(t.y,this.p1.y,this.p2.y):Rs(t.x,this.p1.x,this.p2.x))}make(t,e){return new di(t,e)}project(t){const e=ii.difference(this.p2,this.p1),s=ii.difference(t,this.p1),i=Ys(ii.dot(e,s)/Js(this.length),0,1);return ii.sum(this.p1,e.scale(i))}contract(t){return new di(this.at(t),this.at(1-t))}equals(t,e=!1){return"segment"===t.type&&(this.p1.equals(t.p1)&&this.p2.equals(t.p2)||!e&&this.p1.equals(t.p2)&&this.p2.equals(t.p1))}static intersect(t,e){return ki(t,e)[0]||void 0}}class ui{constructor(t=ni,e=1){this.c=t,this.r=e,this.type="circle"}get circumference(){return oi*this.r}get area(){return Math.PI*this.r**2}get arc(){const t=this.c.shift(this.r,0);return new pi(this.c,t,oi)}transform(t){const e=Math.abs(t[0][0])+Math.abs(t[1][1]);return new ui(this.c.transform(t),this.r*e/2)}rotate(t,e=ni){return new ui(this.c.rotate(t,e),this.r)}reflect(t){return new ui(this.c.reflect(t),this.r)}scale(t,e=t){return new ui(this.c.scale(t,e),this.r*(t+e)/2)}shift(t,e=t){return new ui(this.c.shift(t,e),this.r)}translate(t){return this.shift(t.x,t.y)}contains(t){return ii.distance(t,this.c)<=this.r}equals(t){return Os(this.r,t.r)&&this.c.equals(t.c)}project(t){const e=t.subtract(this.c).unitVector.scale(this.r);return ii.sum(this.c,e)}at(t){const e=2*Math.PI*t;return this.c.shift(this.r*Math.cos(e),this.r*Math.sin(e))}tangentAt(t){const e=this.at(t),s=this.c.rotate(Math.PI/2,e);return new ci(e,s)}}class pi{constructor(t,e,s){this.c=t,this.start=e,this.angle=s,this.type="arc"}get radius(){return ii.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}transform(t){return new this.constructor(this.c.transform(t),this.start.transform(t),this.angle)}rotate(t,e=ni){return new this.constructor(this.c.rotate(t,e),this.start.rotate(t,e),this.angle)}reflect(t){return new this.constructor(this.c.reflect(t),this.start.reflect(t),this.angle)}scale(t,e=t){return new this.constructor(this.c.scale(t,e),this.start.scale(t,e),this.angle)}shift(t,e=t){return new this.constructor(this.c.shift(t,e),this.start.shift(t,e),this.angle)}translate(t){return this.shift(t.x,t.y)}get startAngle(){return ai(this.start,this.c)}project(t){const e=this.startAngle,s=e+this.angle;let i=ai(t,this.c);return s>oi&&i<s-oi&&(i+=oi),i=Ys(i,e,s),this.c.shift(this.radius,0).rotate(i,this.c)}at(t){return this.start.rotate(this.angle*t,this.c)}contract(t){return new this.constructor(this.c,this.at(t/2),this.angle*(1-t))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,2*Math.PI-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,2*Math.PI-this.angle)}get center(){return this.at(.5)}equals(){return!1}}class fi extends pi{constructor(){super(...arguments),this.type="sector"}}class gi{constructor(...t){this.type="polygon",this.points=t}get circumference(){let t=0;for(let e=1;e<this.points.length;++e)t+=ii.distance(this.points[e-1],this.points[e]);return t}get signedArea(){const t=this.points,e=t.length;let s=t[e-1].x*t[0].y-t[0].x*t[e-1].y;for(let i=1;i<e;++i)s+=t[i-1].x*t[i].y-t[i].x*t[i-1].y;return s/2}get area(){return Math.abs(this.signedArea)}get centroid(){const t=this.points,e=t.length;let s=0;for(let i=0;i<e;++i)s+=t[i].x;let i=0;for(let s=0;s<e;++s)i+=t[s].y;return new ii(s/e,i/e)}get edges(){const t=this.points,e=t.length,s=[];for(let i=0;i<e;++i)s.push(new di(t[i],t[(i+1)%e]));return s}get radius(){const t=this.centroid,e=this.points.map(e=>ii.distance(e,t));return Math.max(...e)}transform(t){return new this.constructor(...this.points.map(e=>e.transform(t)))}rotate(t,e=ni){const s=this.points.map(s=>s.rotate(t,e));return new this.constructor(...s)}reflect(t){const e=this.points.map(e=>e.reflect(t));return new this.constructor(...e)}scale(t,e=t){const s=this.points.map(s=>s.scale(t,e));return new this.constructor(...s)}shift(t,e=t){const s=this.points.map(s=>s.shift(t,e));return new this.constructor(...s)}translate(t){return this.shift(t.x,t.y)}contains(t){let e=!1;for(const s of this.edges){if(s.p1.equals(t)||s.contains(t))return!1;if(s.p1.y>t.y==s.p2.y>t.y)continue;const i=(s.p2.x-s.p1.x)/(s.p2.y-s.p1.y);t.x<i*(t.y-s.p1.y)+s.p1.x&&(e=!e)}return e}equals(t){return!1}project(t){let e=void 0,s=1/0;for(const i of this.edges){const n=i.project(t),r=ii.distance(t,n);r<s&&(e=n,s=r)}return e||this.points[0]}at(t){return ii.interpolateList([...this.points,this.points[0]],t)}get oriented(){if(this.signedArea>=0)return this;const t=[...this.points].reverse();return new this.constructor(...t)}intersect(t){const e=[qs(this.oriented.points),qs(t.oriented.points)],s=this.points.length+t.points.length,i=[];let n=0,r=e[n].find(e=>t.contains(e.val));if(r){for(;r.val!==i[0]&&i.length<s;){i.push(r.val);const t=new di(r.val,r.next.val);r=r.next;for(const s of e[1-n]){const e=Ci(t,new di(s.val,s.next.val))[0];if(e){n=1-n,r={val:e,next:s.next};break}}}return new gi(...i)}}static collision(t,e){for(const s of t.edges)for(const t of e.edges)if(di.intersect(s,t))return!0;return e.contains(t.points[0])||t.contains(e.points[0])}static regular(t,e=1){const s=2*Math.PI/t,i=Math.PI/2-s/2,n=function(t,e){const s=[];for(let i=0;i<e;++i)s.push(t(i));return s}(t=>ii.fromPolar(i+s*t,e),t);return new gi(...n)}static interpolate(t,e,s=.5){const i=t.points.map((t,i)=>ii.interpolate(t,e.points[i],s));return new gi(...i)}}class mi extends gi{constructor(){super(...arguments),this.type="polyline"}get edges(){const t=[];for(let e=0;e<this.points.length-1;++e)t.push(new di(this.points[e],this.points[e+1]));return t}}class vi extends gi{constructor(){super(...arguments),this.type="triangle"}get circumcircle(){const[t,e,s]=this.points,i=2*(t.x*(e.y-s.y)+e.x*(s.y-t.y)+s.x*(t.y-e.y)),n=(t.x**2+t.y**2)*(e.y-s.y)+(e.x**2+e.y**2)*(s.y-t.y)+(s.x**2+s.y**2)*(t.y-e.y),r=(t.x**2+t.y**2)*(s.x-e.x)+(e.x**2+e.y**2)*(t.x-s.x)+(s.x**2+s.y**2)*(e.x-t.x),o=new ii(n/i,r/i),h=ii.distance(o,this.points[0]);return new ui(o,h)}get incircle(){const t=this.edges,e=t.map(t=>t.length),s=e[0]+e[1]+e[2],[i,n,r]=this.points,o=e[1]*i.x+e[2]*n.x+e[0]*r.x,h=e[1]*i.y+e[2]*n.y+e[0]*r.y,a=new ii(o/s,h/s),c=a.distanceFromLine(t[0]);return new ui(a,c)}get orthocenter(){const[t,e,s]=this.points;return Ci(new ci(t,e).perpendicular(s),new ci(t,s).perpendicular(e))[0]}}class wi{constructor(t,e=1,s=e){this.p=t,this.w=e,this.h=s,this.type="rectangle"}static aroundPoints(...t){const e=t.map(t=>t.x),s=t.map(t=>t.y),i=Math.min(...e),n=Math.max(...e)-i,r=Math.min(...s),o=Math.max(...s)-r;return new wi(new ii(i,r),n,o)}get center(){return new ii(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){const t=new ii(this.p.x+this.w,this.p.y),e=new ii(this.p.x+this.w,this.p.y+this.h),s=new ii(this.p.x,this.p.y+this.h);return new gi(this.p,t,e,s)}transform(t){return this.polygon.transform(t)}rotate(t,e=ni){return this.polygon.rotate(t,e)}reflect(t){return this.polygon.reflect(t)}scale(t,e=t){return new wi(this.p.scale(t,e),this.w*t,this.h*e)}shift(t,e=t){return new wi(this.p.shift(t,e),this.w,this.h)}translate(t){return this.shift(t.x,t.y)}contains(t){return Rs(t.x,this.p.x,this.p.x+this.w)&&Rs(t.y,this.p.y,this.p.y+this.h)}equals(t){return!1}project(t){const e={x:this.p.x+this.w,y:this.p.y+this.h},s=this.p.x+this.w/2,i=this.p.y+this.h/2,n=(i-t.y)/(s-t.x);if(t.x<=s){const s=n*(this.p.x-t.x)+t.y;if(this.p.y<s&&s<e.y)return new ii(this.p.x,s)}if(t.x>=s){const s=n*(e.x-t.x)+t.y;if(this.p.y<s&&s<e.y)return new ii(e.x,s)}if(t.y<=i){const s=(this.p.y-t.y)/n+t.x;if(this.p.x<s&&s<e.x)return new ii(s,this.p.y)}if(t.y>=i){const s=(e.y-t.y)/n+t.x;if(this.p.x<s&&s<e.x)return new ii(s,e.y)}return this.p}at(t){}}function yi(t){return Is(t.type,"polygon","polyline","rectangle")}function xi(t){return Is(t.type,"line","ray","segment")}function $i(t){return"circle"===t.type}function bi(t){return"arc"===t.type}function Mi(t,e){const s=t.p2.x-t.p1.x,i=t.p2.y-t.p1.y,n=Js(s)+Js(i),r=e.c.x,o=e.c.y,h=(t.p1.x-r)*(t.p2.y-o)-(t.p2.x-r)*(t.p1.y-o),a=Js(e.r)*n-Js(h);if(a<0)return[];const c=h*i/n,l=-h*s/n;if(Os(a,0))return[e.c.shift(c,l)];const d=s*(i<0?-1:1)*Math.sqrt(a)/n,u=Math.abs(i)*Math.sqrt(a)/n;return[e.c.shift(c+d,l+u),e.c.shift(c-d,l-u)]}function Ci(...t){if(t.length<2)return[];if(t.length>2)return function t(e){return e.reduce((e,s)=>e.concat(Array.isArray(s)?t(s):s),[])}(ti(t,2).map(t=>Ci(...t)));let[e,s]=t;if(yi(s)&&([e,s]=[s,e]),yi(e)){return[...xi(s)?e.points.filter(t=>s.contains(t)):[],...Ci(s,...e.edges)]}return ki(e,s)}function ki(t,e){let s=[];xi(t)&&xi(e)?s=function(t,e){const s=t.p1.x-t.p2.x,i=t.p1.y-t.p2.y,n=e.p1.x-e.p2.x,r=e.p1.y-e.p2.y,o=s*r-i*n;if(Os(o,0))return[];const h=t.p1.x*t.p2.y-t.p1.y*t.p2.x,a=e.p1.x*e.p2.y-e.p1.y*e.p2.x;return[new ii((h*n-s*a)/o,(h*r-i*a)/o)]}(t,e):xi(t)&&$i(e)?s=Mi(t,e):$i(t)&&xi(e)?s=Mi(e,t):$i(t)&&$i(e)&&(s=function(t,e){const s=ii.distance(t.c,e.c);if(s>t.r+e.r)return[];if(s<Math.abs(t.r-e.r))return[];if(Os(s,0)&&Os(t.r,e.r))return[];if(Os(s,t.r+e.r))return[new ci(t.c,e.c).midpoint];const i=(Js(t.r)-Js(e.r)+Js(s))/(2*s),n=Math.sqrt(Js(t.r)-Js(i)),r=(e.c.x-t.c.x)*i/s+(e.c.y-t.c.y)*n/s+t.c.x,o=(e.c.y-t.c.y)*i/s-(e.c.x-t.c.x)*n/s+t.c.y,h=(e.c.x-t.c.x)*i/s-(e.c.y-t.c.y)*n/s+t.c.x,a=(e.c.y-t.c.y)*i/s+(e.c.x-t.c.x)*n/s+t.c.y;return[new ii(r,o),new ii(h,a)]}(t,e));for(const i of[t,e])"segment"===i.type&&(s=s.filter(t=>{return s=t,Os((e=i).p1.x,e.p2.x)?Rs(s.y,e.p1.y,e.p2.y):Rs(s.x,e.p1.x,e.p2.x);var e,s})),"ray"===i.type&&(s=s.filter(t=>{return s=t,Os((e=i).p1.x,e.p2.x)?(s.y-e.p1.y)/(e.p2.y-e.p1.y)>0:(s.x-e.p1.x)/(e.p2.x-e.p1.x)>0;var e,s}));return s}function Pi(t,e,s){return function(t,e,s){const i=[];for(let n=0;n<e;++n)i.push(Es(t,s));return i}(t,e,s)}function Ai(...t){const[e,...s]=t,i=s.length>1?Ai(...s):s[0];if(e[0].length!==i.length)throw new Error("Matrix sizes don’t match.");const n=[];for(let t=0;t<e.length;++t){const s=[];for(let n=0;n<i[0].length;++n){let r=0;for(let s=0;s<i.length;++s)r+=e[t][s]*i[s][n];s.push(r)}n.push(s)}return n}function Ti(t){const e=t.length;if(e!==t[0].length)throw new Error("Not a square matrix.");const s=function(t=2){const e=Pi(0,t,t);for(let s=0;s<t;++s)e[s][s]=1;return e}(e),i=function(t,e,s){const i=[];for(let n=0;n<e;++n){const e=[];for(let i=0;i<s;++i)e.push(t(n,i));i.push(e)}return i}((e,s)=>t[e][s],e,e);for(let t=0;t<e;++t){let n=i[t][t];if(!n){for(let n=t+1;n<e;++n)if(0!==i[n][t]){for(let r=0;r<e;++r)[i[n][r],i[t][r]]=[i[t][r],i[n][r]],[s[n][r],s[t][r]]=[s[t][r],s[n][r]];break}if(n=i[t][t],!n)throw new Error("Matrix not invertible.")}for(let r=0;r<e;++r)i[t][r]=i[t][r]/n,s[t][r]=s[t][r]/n;for(let n=0;n<e;++n){if(n===t)continue;const r=i[n][t];for(let o=0;o<e;++o)i[n][o]-=r*i[t][o],s[n][o]-=r*s[t][o]}}return s}function Si(t){const e=Math.random()*Ls(t);let s=0;return t.findIndex(t=>(s+=t)>=e)}const _i=new Map;function Ii(t=.5){return Math.random()<t?1:0}const Ei=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];function Li(t,e,s,i=1){let n=0;for(let r=e;r<s;r+=i)n+=t(r)*i||0;return n}var qi=Object.freeze({__proto__:null,shuffle:function(t){for(let e=(t=t.slice(0)).length-1;e>0;--e){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t},integer:function(t,e){const s=void 0===e?t:e-t+1;return(void 0===e?0:t)+Math.floor(s*Math.random())},weighted:Si,smart:function(t,e){e||(e=function(t=10){return Math.random().toString(36).substr(2,t)}()),_i.has(e)||_i.set(e,Es(1,t));const s=_i.get(e),i=Si(s.map(t=>t*t));return s[i]-=1,s[i]<=0&&_i.set(e,s.map(t=>t+1)),i},bernoulli:Ii,binomial:function(t=1,e=.5){let s=0;for(let i=0;i<t;++i)s+=Ii(e);return s},poisson:function(t=1){if(t<=0)return 0;const e=Math.exp(-t);let s=1,i=0;for(;s>e;++i)s*=Math.random();return i-1},uniform:function(t=0,e=1){return t+(e-t)*Math.random()},normal:function(t=0,e=1){const s=Math.random(),i=Math.random();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*i)*Math.sqrt(e)+t},exponential:function(t=1){return t<=0?0:-Math.log(Math.random())/t},geometric:function(t=.5){if(!(t<=0||t>1))return Math.floor(Math.log(Math.random())/Math.log(1-t))},cauchy:function(){let t,e,s;do{e=2*Math.random()-1,s=2*Math.random()-1,t=e*e+s*s}while(t>=1);return e/s},normalPDF:function(t,e=1,s=0){return Math.exp(-((t-e)**2)/(2*s))/Math.sqrt(2*Math.PI*s)},integrate:Li,chiCDF:function(t,e){return 1-Li(t=>Math.pow(t,(e-2)/2)*Math.exp(-t/2),0,t)/Math.pow(2,e/2)/function t(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*t(1-e));e-=1;let s=Ei[0];for(let t=1;t<9;t++)s+=Ei[t]/(e+t);const i=e+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*s}(e/2)}});function Oi(t,e){let s=1,i=t[0];for(let n=1;n<t.length;++n)s*=e,i+=s*t[n];return i}function Ri(t,e=2){const s=t.map(t=>function(t,e,s=1){const i=[];if(void 0===e&&t>=0)for(let e=0;e<t;e+=s)i.push(e);else if(void 0===e)for(let e=0;e>t;e-=s)i.push(e);else if(t<=e)for(let n=t;n<=e;n+=s)i.push(n);else for(let n=t;n>=e;n-=s)i.push(n);return i}(e+1).map(e=>Math.pow(t[0],e))),i=function(t){const e=[];for(let s=0;s<t[0].length;++s){const i=[];for(let e=0;e<t.length;++e)i.push(t[e][s]);e.push(i)}return e}(s),n=t.map(t=>[t[1]]),r=Ai(i,s);return Ai(Ti(r),i,n).map(t=>t[0])}function Ni(t,e){const s=t.reduce((t,e)=>t+e[1],0)/t.length,i=t.reduce((t,e)=>t+(e[1]-s)**2,0);return 1-t.reduce((t,s)=>t+(s[1]-e(s[0]))**2,0)/i}var ji=Object.freeze({__proto__:null,linear:function(t,e=!1){let s=0,i=0,n=0,r=0;const o=t.length;for(let e=0;e<o;e++)s+=t[e][0],i+=t[e][1],n+=t[e][0]*t[e][0],r+=t[e][0]*t[e][1];if(e){return[0,r/n]}const h=(o*r-s*i)/(o*n-s*s);return[i/o-h*s/o,h]},exponential:function(t){const e=[0,0,0,0,0,0];for(const s of t)e[0]+=s[0],e[1]+=s[1],e[2]+=s[0]*s[0]*s[1],e[3]+=s[1]*Math.log(s[1]),e[4]+=s[0]*s[1]*Math.log(s[1]),e[5]+=s[0]*s[1];const s=e[1]*e[2]-e[5]*e[5];return[Math.exp((e[2]*e[3]-e[5]*e[4])/s),(e[1]*e[4]-e[5]*e[3])/s]},logarithmic:function(t){const e=[0,0,0,0],s=t.length;for(const s of t)e[0]+=Math.log(s[0]),e[1]+=s[1]*Math.log(s[0]),e[2]+=s[1],e[3]+=Math.pow(Math.log(s[0]),2);const i=(s*e[1]-e[2]*e[0])/(s*e[3]-e[0]*e[0]);return[(e[2]-i*e[0])/s,i]},power:function(t){const e=[0,0,0,0],s=t.length;for(const s of t)e[0]+=Math.log(s[0]),e[1]+=Math.log(s[1])*Math.log(s[0]),e[2]+=Math.log(s[1]),e[3]+=Math.pow(Math.log(s[0]),2);const i=(s*e[1]-e[2]*e[0])/(s*e[3]-e[0]*e[0]);return[Math.exp((e[2]-i*e[0])/s),i]},polynomial:Ri,coefficient:Ni,bestPolynomial:function(t,e=.85,s=8){if(!(t.length<=1))for(let i=1;i<s;++i){const s=Ri(t,i),n=t=>Oi(s,t);if(Ni(t,n)>=e)return{order:i,coefficients:s,fn:n}}}});class Vi{constructor(){this.callbacks=[]}add(t){this.callbacks.push(t)}start(t=1e3){return xe(t=>{for(const e of this.callbacks)e(t)},t).promise}}function Bi(t,e,s){if("adding"===s){const s=t.strokeLength,i=e<.5?0:be("cubic-in",2*e-1);t.css({"stroke-dasharray":s+"px","stroke-dashoffset":s*(1-i)+"px"})}else if("deleting"===s){const s=t.strokeLength,i=e<.5?be("cubic-in",2*e):1;t.css({"stroke-dasharray":s+"px","stroke-dashoffset":s*(2-i)+"px"})}}function Di(t,e){const s=[t];let i=t.expr;for(;e.startsWith(i);){if(e===i)return s;const t=d(s).next;if(!t)return;s.push(t),i+=t.expr}}function zi(t,e){return 1===e.length&&"mrow"===e[0].type?e[0]:new Ki(e,t)}class Hi{constructor(t,e,s,i){this.type=t,this.equation=s,this.$element=i,this.children=[],this.status="",this.value="",this.customColor="",this.roundedMotion=!1,this.width=0,this.height=0,this.baseline=0,this.transform={x:0,y:0,scale:1},this.currentDimensions=[0,0,0],this.currentWorldTransform={x:0,y:0,scale:1},this.addChildren(e),i&&s.$row.append(i)}get expr(){return""}get log(){const t=this.children.map(t=>t.log);return`<${this.type}>${t.join("")}</${this.type}>`}get color(){return this.customColor||(this.parent?this.parent.color:"")}static create(t,e){const s=t.nodeName.toLowerCase();if(i(s,"mn","mi","mo","mtext"))return new Ui(s,t,e);if(!i(s,"mrow","mfrac","mfenced","msqrt","mroot","msub","msup","msubsup"))return new Ji(t,e);let n=Array.from(t.children,t=>Hi.create(t,e));switch(s){case"mrow":return new Ki(n,e);case"mfrac":return n=n.map(t=>zi(e,[t])),new Gi(n,e);case"mfenced":return n=[zi(e,n)],new Yi(n,e);case"msqrt":return n=[zi(e,n)],new Zi(s,n,e);case"mroot":return n=n.map(t=>zi(e,[t])),new Zi(s,n,e);case"msub":case"msup":case"msubsup":return n=n.map(t=>zi(e,[t])),new Xi(s,n,e)}throw new Error("Unknown element type tag "+t.nodeName)}get marginLeft(){return.1}get marginRight(){return.1}setTransform(t=0,e=0,s=1){this.transform.x=t,this.transform.y=e,this.transform.scale=s}get worldTransform(){let t=this;const e=Object.assign({},this.transform);for(;t=t.parent;)s=e,i=t.transform,s.scale*=i.scale,s.x=s.x*i.scale+i.x,s.y=s.y*i.scale+i.y;var s,i;return e}get next(){if(!this.parent)return;const t=this.parent.children.indexOf(this);return this.parent.children[t+1]}get prev(){if(!this.parent)return;const t=this.parent.children.indexOf(this);return this.parent.children[t-1]}addChildren(t,e=this.children.length){for(const e of t)e.detach(),e.parent=this;this.children.splice(e,0,...t)}insertAfter(t){const e=this.parent.children.indexOf(this);this.parent.addChildren(t,e+1)}insertBefore(t){const e=this.parent.children.indexOf(this);this.parent.addChildren(t,e)}detach(){if(this.parent){const t=this.parent.children.indexOf(this);t>=0&&this.parent.children.splice(t,1)}}deleteFromDom(){this.$element&&this.$element.remove(),this.$element=void 0;for(const t of this.children)t.deleteFromDom()}hasParent(t){let e=this;for(;e=e.parent;)if(e.type===t)return!0;return!1}measure(){for(const t of this.children)t.measure()}clean(){for(const t of this.children)t.clean()}setStatus(t){this.status=t;for(const e of this.children)e.setStatus(t)}render(t){for(const e of this.children)e.render(t);if(!this.$element)return;const e=this.currentWorldTransform,s=this.currentWorldTransform=this.worldTransform,n=this.currentDimensions,r=this.currentDimensions=[this.width,this.height,this.baseline];if(function(t,e){return Os(t.x,e.x)&&Os(t.y,e.y)&&Os(t.scale,e.scale)}(e,s)&&function(t,e){return t.every((t,s)=>Os(t,e[s]))}(n,r)&&!this.status)return;if(!t)return this.positionElement(s),void this.drawElement(1,r[0],r[1],r[2],s.scale);"adding"===this.status&&this.positionElement(s);const o=s.y+this.baseline<this.equation.root.baseline?-1:1,h=this.roundedMotion?function(t,e,s=1){const i=s*Math.abs(e.x-t.x)/3,n=ii.average(t,e).shift(0,i);return function(s){return{x:(1-s)**2*t.x+2*s*(1-s)*n.x+s*s*e.x,y:(1-s)**2*t.y+2*s*(1-s)*n.y+s*s*e.y}}}(e,s,o):void 0;this.roundedMotion=!1,t.add(t=>{if(!this.$element)return;const o=be("cubic",t),a=i(this.status,"adding","deleting"),c=a?r[0]:Zs(n[0],r[0],o),l=a?r[1]:Zs(n[1],r[1],o),d=a?r[2]:Zs(n[2],r[2],o),u=a?s.scale:Zs(e.scale,s.scale,o);if(this.drawElement(t,c,l,d,u),!this.status){const t=h?h(o):ii.interpolate(e,s,o);this.positionElement({x:t.x,y:t.y,scale:u})}})}positionElement(t){this.$element.setTransform(t,0,t.scale)}drawElement(t,e,s,i,n){}}const Wi=["=","≈","<",">","≤","≥"],Fi=le("svg",{width:0,height:0,style:"position: absolute; top: -100px; left: -100px"},de);class Ui extends Hi{constructor(t,e,s){const i=le("text",{text:e.textContent},Fi),n=i.width;super(t,[],s,i),this.value=e.textContent||"",this.width=n;const r=this.value.split("").every(t=>"acegmnopqrsuvwxyz".includes(t));this.height=(1.1-(r?.15:0))*this.equation.fontSize,this.baseline=this.height-.2*this.equation.fontSize,"mtext"!==t&&"normal"!==e.getAttribute("mathvariant")||i.addClass("font-normal")}get expr(){return"mtext"===this.type?`"${this.value}"`:this.value}get log(){return`<${this.type}>${this.value}</${this.type}>`}get marginLeft(){if("mo"===this.type)return Wi.includes(this.value)?this.equation.isDisplay?.6:.35:i(this.value,"∡","△","!","%","’")||i(this.value,"…","°")&&this.prev&&"mn"===this.prev.type?0:.25;if("mi"===this.type){if(this.prev&&"mn"===this.prev.type)return.1;if(this.prev&&"mi"===this.prev.type)return.05;if(this.prev&&"mfrac"===this.prev.type)return.15}return 0}get marginRight(){return"mo"===this.type?this.equation.isDisplay&&Wi.includes(this.value)?.6:i(this.value,"∡","△")?0:"−"!==this.value||this.prev&&!Wi.includes(this.prev.value)?.25:.1:0}positionElement(t){if(!this.$element)return;const e=(this.equation.fontSize-this.baseline)*t.scale;this.$element.setTransform({x:t.x,y:t.y-e},0,t.scale)}drawElement(t,e,s,i,n){"adding"===this.status?this.$element.setAttr("opacity",t<.5?0:be("cubic-in",2*t-1)):"deleting"===this.status&&this.$element.setAttr("opacity",t<.5?1-be("cubic-in",2*t):0),this.$element.css("stroke-width",1.5*(1-n)+"px"),this.$element.css("color",this.color||"currentColor")}}class Ki extends Hi{constructor(t,e,s,i=0){super("mrow",t,e),this.align=s,this.dx=i}addChildren(t,e=this.children.length){const s=[];for(const e of t)"mrow"===e.type?(s.push(...e.children),e.detach()):s.push(e);Hi.prototype.addChildren.call(this,s,e)}get expr(){return this.children.map(t=>t.expr).join("")}measure(){if(Hi.prototype.measure.call(this),!this.children.length)return void(this.height=this.width=this.baseline=0);this.baseline=Math.max(...this.children.map(t=>t.baseline)),this.height=this.baseline+Math.max(...this.children.map(t=>t.height-t.baseline));let t=0;for(const[e,s]of this.children.entries())s.setTransform(t,this.baseline-s.baseline),t+=s.width,e<this.children.length-1&&(t+=Math.max(s.marginRight,this.children[e+1].marginLeft)*this.equation.fontSize);if(this.align){const t=this.children.find(t=>t.expr===this.align);t&&(this.transform.x=this.dx-t.transform.x-t.width/2)}this.width=t}}class Gi extends Hi{constructor(t,e){super("mfrac",t,e,le("line"))}get expr(){return this.children.map(t=>t.expr).join("/")}measure(){Hi.prototype.measure.call(this);const t=.1*this.equation.fontSize,e=!this.equation.isDisplay||this.hasParent("mfrac")?.66:1,[s,i]=this.children;this.width=(Math.max(s.width,i.width)+2*t)*e,this.height=(s.height+i.height)*e,this.baseline=s.height*e+this.equation.fontSize*(.55-.2),s.setTransform((this.width-s.width*e)/2,0,e),i.setTransform((this.width-i.width*e)/2,s.height*e,e)}drawElement(t,e,s,i){const n=i-this.equation.fontSize*(.55-.2);this.$element.setLine({x:0,y:n},{x:e,y:n}),this.$element.setAttr("stroke",this.color||"currentColor"),Bi(this.$element,t,this.status)}}class Xi extends Hi{get expr(){let t=this.children[0].expr;return"msup"!==this.type&&(t+="_"+this.children[1].expr),"msup"===this.type&&(t+="^"+this.children[1].expr),"msubsup"===this.type&&(t+="^"+this.children[2].expr),t}measure(){Hi.prototype.measure.call(this);const[t,e,s]=this.children,i="msup"===this.type?void 0:e,n="msubsup"===this.type?s:"msup"===this.type?e:void 0,r=.05*this.equation.fontSize,o=n?.65*n.height-.4*this.equation.fontSize:0,h=i?.65*i.height-.5*this.equation.fontSize:0,a=n?n.width:0,c=i?i.width:0;this.width=t.width+r+.65*Math.max(a,c),this.height=t.height+o+h,this.baseline=t.baseline+o,t.setTransform(0,this.baseline-t.baseline),n&&n.setTransform(t.width+r,0,.65),i&&i.setTransform(t.width+r,this.height-.65*i.height,.65)}clean(){if(Hi.prototype.clean.call(this),this.children=this.children.filter(t=>"mrow"!==t.type||t.children.length),0===this.children.length)return this.detach();1===this.children.length&&(this.insertAfter(this.children),this.detach())}}class Yi extends Hi{constructor(t,e){super("mfenced",t,e,le("path"))}get expr(){return`(${this.children.map(t=>t.expr).join()})`}get marginLeft(){return.2}get marginRight(){return.2}measure(){Hi.prototype.measure.call(this);const t=this.children[0];this.height=t.height+2,this.baseline=t.baseline+1;const e=1+this.height/this.equation.fontSize,s=.1*this.equation.fontSize;this.width=t.width+2*(e+s),t.setTransform(e+s,1)}drawElement(t,e,s){const i=Math.min(2+s/this.equation.fontSize,5),n=s-4,r=`M${i},2c${-2*i/3},${.15*n},${-i},${.32*n},${-i},${n/2}s${i/3},${.35*n},${i},${n/2}M${e-i},2c${2*i/3},${.15*n},${i},${.32*n},${i},${n/2}s${-i/3},${.35*n},${-i},${n/2}`;this.$element.setAttr("d",r),this.$element.css("stroke",this.color||"currentColor"),Bi(this.$element,t,this.status)}clean(){Hi.prototype.clean.call(this),this.children.length||this.detach()}}class Zi extends Hi{constructor(t,e,s){super(t,e,s,le("path"))}get expr(){return`sqrt(${this.children.map(t=>t.expr).join()})`}get marginLeft(){return.2}get marginRight(){return.2}measure(){Hi.prototype.measure.call(this);const t=this.children[0];this.height=t.height+2,this.baseline=t.baseline+2;const e=Math.min(16,3+5*this.height/this.equation.fontSize),s=.05*this.equation.fontSize;this.width=t.width+e+2*s,t.setTransform(e+s,2)}drawElement(t,e,s){const i=Math.min(16,3+5*s/this.equation.fontSize),n=s-2,r=`M0,${.55*n}L${.18*i},${.51*n}L${.45*i},${n}L${i},2L${e},2`;this.$element.setAttr("d",r),this.$element.css("stroke",this.color||"currentColor"),Bi(this.$element,t,this.status)}clean(){Hi.prototype.clean.call(this),this.children.length||this.detach()}}class Ji extends Hi{constructor(t,e){var s;super("foreign",[],e,le("g")),this.$body=le("div",{},e.$overlay),this.$body._el.appendChild(t),this.$measure=le("span",{text:".",style:"font-size: 0"},this.$body),this.checkForResize(),this.$body.on("resize",()=>{this.checkForResize()&&this.equation.resize()}),null===(s=this.$body.$("x-blank, x-blank-input"))||void 0===s||s.on("solve",t=>{n(()=>this.replace(t.solution,"#0f82f2"),t.restore?0:200)})}deleteFromDom(){var t;null===(t=this.$body)||void 0===t||t.remove(),this.$body=void 0,this.$measure=void 0}replace(t,e){var s;const i=isNaN(+t)?"mtext":"mn",n=document.createElement(i);n.textContent=t;const r=new Ui(i,n,this.equation);r.customColor=e,this.insertAfter([r]),null===(s=this.$body)||void 0===s||s.off("resize"),this.detach(),this.deleteFromDom(),this.equation.resize()}checkForResize(){var t,e;const s=this.height,i=this.width,n=this.baseline;return this.height=(null===(t=this.$body)||void 0===t?void 0:t.height)||0,this.width=(null===(e=this.$body)||void 0===e?void 0:e.width)||0,this.baseline=this.$measure.bounds.top-this.$body.bounds.top,!(Os(s,this.height)&&Os(i,this.width)&&Os(n,this.baseline))}positionElement(t){this.$body.css({left:t.x+"px",top:t.y+"px"}),Os(t.scale,1)||this.$body.css("transform",`scale(${t.scale})`)}get expr(){return this.$body.text}get log(){return`<foreign>${this.expr}</foreign>`}}class Qi extends v{constructor(t,e,s=0,i="=",n=18,r=!0){super(),this.$row=t,this.$overlay=e,this.fontSize=n,this.isDisplay=r,this.isReady=!0,this.deletedNodes=new Set,this.desc=le("desc",{},t),this.root=new Ki([],this,i,s)}setValue(t){const e=Array.isArray(t)?t.map(t=>Hi.create(t,this)):this.parse(t);for(const t of this.root.children)t.deleteFromDom();this.root.addChildren(e),this.updateDescription(),this.resize()}updateDescription(){this.desc.text=this.root.expr}resize(){this.root.measure(),this.root.render()}parse(t){var e,s;const i=new DOMParser,n=_s.parse(t).toMathML(),r=i.parseFromString(`<math>${n}</math>`,"text/xml");if("parsererror"===(null===(e=r.firstChild)||void 0===e?void 0:e.nodeName))throw new Error(null===(s=r.firstChild)||void 0===s?void 0:s.textContent);const o=r.firstChild.childNodes;return Array.from(o,t=>Hi.create(t,this))}find(t){let[e,s]=t.split("`");e=e.replace(/[–-]/g,"−");const i=+s||1,n=this.root.children.slice(0);let r=0;for(;n.length;){const t=n.shift(),s=t instanceof Ki?void 0:Di(t,e);if(s&&(r+=1,r===i))return s;n.unshift(...t.children)}throw new Error(`Can't find element ${e}.`)}animate(t=1200){return s(this,void 0,void 0,(function*(){this.isReady=!1,this.root.clean(),this.root.measure();const e=new Vi;this.root.render(e),this.trigger("resize",{height:this.root.height});for(const t of this.deletedNodes)t.render(e);yield e.start(t);for(const t of this.deletedNodes)t.deleteFromDom();this.root.setStatus(""),this.deletedNodes.clear(),this.isReady=!0}))}addTermAfter(t,e){const s=d(e?this.find(e):this.root.children),i=this.parse(t);s.insertAfter(i);for(const t of i)t.setStatus("adding");this.updateDescription()}addTermBefore(t,e){const s=e?this.find(e)[0]:this.root.children[0],i=this.parse(t);s.insertBefore(i);for(const t of i)t.setStatus("adding");this.updateDescription()}deleteTerm(t){for(const e of this.find(t))e.setStatus("deleting"),e.detach(),this.deletedNodes.add(e);this.updateDescription()}replaceTerm(t,e){const s=this.find(t),i=this.parse(e);s[0].insertBefore(i);for(const t of i)t.setStatus("adding");for(const t of s)t.setStatus("deleting"),t.detach(),this.deletedNodes.add(t);this.updateDescription()}moveTermAfter(t,e){const s=this.find(t);for(const t of s)t.roundedMotion=!0;d(e?this.find(e):this.root.children).insertAfter(s),this.updateDescription()}moveTermBefore(t,e){const s=this.find(t);for(const t of s)t.roundedMotion=!0;(e?this.find(e)[0]:this.root.children[0]).insertBefore(s),this.updateDescription()}moveTermToStart(t){const e=this.find(t);for(const t of e)t.roundedMotion=!0;this.root.children[0].insertBefore(e),this.updateDescription()}wrapTerms(t,...e){const s=e.map(t=>this.find(t));for(const t of s)for(const e of t)e.roundedMotion=!0;const i=this.parse(t);for(const t of i)t.setStatus("adding");s[0][0].insertBefore(i);for(const[t,e]of s.entries()){const s=this.find("$"+(t+1))[0];s.insertAfter(e),s.detach(),s.deleteFromDom()}this.updateDescription()}unwrapTerm(t,e=1){const s=this.find(t);let i=s[0],n=1;for(;n<=e;)i=i.parent,i instanceof Ki&&(i=i.parent),n+=1;i.insertAfter(s),i.setStatus("deleting"),i.detach(),this.deletedNodes.add(i),this.updateDescription()}get leftSide(){const t=this.root.children.findIndex(t=>"="===t.expr);return this.root.children.slice(0,t-1)}get rightSide(){const t=this.root.children.findIndex(t=>"="===t.expr);return this.root.children.slice(t+1)}}let tn=class extends qe{constructor(){super(...arguments),this.rows=[],this.isReady=!0,this.topOffset=4,this.currentHeight=0,this.currentStep=0,this.nextEvents={},this.backEvents={}}ready(){this.$svg=this.$("svg"),this.$lastRow=this.$svg.$("g"),this.$overlay=this.$(".overlay"),this.$legend=this.$(".legend-box"),this.$steps=this.$legend.$$("li"),this.$back=this.$(".back"),this.$next=this.$(".next");const t=+this.attr("dx")||0;this.equation=new Qi(this.$lastRow,this.$overlay,t);const e=this.$(".math"),s=e?Array.from(e._el.children):[];this.equation.setValue(this.attr("expr")||s),this.currentHeight=this.topOffset+this.$lastRow.height+16,this.$svg.css("height",this.currentHeight+"px"),this.equation.on("resize",({height:t})=>{const e=this.topOffset+t+16;Math.abs(e-this.currentHeight)<8||(this.currentHeight=e,this.$svg.animate({height:e+"px"},1200))}),this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.$steps[0].show(),fe.onResize(()=>{const t=this.$svg.width/2;for(const e of[this.$lastRow,this.$overlay])e.css("transform",`translate(${t}px, ${this.topOffset}px)`);for(const e of this.rows)e.$el.css("transform",`translate(${t}px, ${e.top}px)`)});const i=this.$overlay.$$("x-blank, x-blank-input");i.length&&(this.$next.addClass("hide"),Promise.all(i.map(t=>t.onPromise("solve"))).then(()=>setTimeout(()=>this.goNext(),1200)))}newRow(){return s(this,void 0,void 0,(function*(){const t=this.$lastRow.copy(!0,!1),e=this.equation.root.height;this.rows.push({$el:t,height:e,top:this.topOffset}),this.$lastRow.insertBefore(t),fe.redraw(),this.topOffset+=e+16,this.currentHeight=this.topOffset+e+16;for(const t of[this.$lastRow,this.$overlay])t.animate({transform:`translate(${this.$svg.width/2}px, ${this.topOffset}px)`},600);yield this.$svg.animate({height:this.currentHeight+"px"},600).promise}))}hideLastRow(){return s(this,void 0,void 0,(function*(){if(!this.rows.length)return;const t=this.rows.pop();this.topOffset=t.top;for(const e of[this.$lastRow,this.$overlay])e.animate({transform:`translate(${this.$svg.width/2}px, ${t.top}px)`},600);this.currentHeight=t.top+this.$lastRow.height+16,this.$svg.animate({height:this.currentHeight+"px"},600),yield t.$el.exit("fade",300,300).promise,t.$el.remove()}))}onNextStep(t){this.nextEvents=t}onBackStep(t){this.backEvents=t}goNext(){return s(this,void 0,void 0,(function*(){if(!this.isReady||!this.equation.isReady||this.currentStep>=this.$steps.length-1)return;this.isReady=!1;const t=this.currentStep+1;this.$steps[t].hasClass("new-row")&&(yield this.newRow(),yield r(400)),t in this.nextEvents&&(yield this.nextEvents[t](this.equation),yield this.equation.animate(1200),yield r(1200)),yield this.go(t),this.trigger("next",{step:t}),this.isReady=!0}))}goBack(){return s(this,void 0,void 0,(function*(){if(!this.isReady||!this.equation.isReady||this.currentStep<=0)return;const t=this.currentStep-1;this.isReady=!1,this.currentStep in this.backEvents&&(yield this.backEvents[this.currentStep](this.equation),yield this.equation.animate()),this.$steps[this.currentStep].hasClass("new-row")&&this.hideLastRow(),yield this.go(t),this.trigger("back",{step:t}),this.isReady=!0}))}go(t){return s(this,void 0,void 0,(function*(){this.$steps[t].show();const e=this.$steps[t].height+"px";this.$steps[t].hide(),this.$legend.animate({height:e},800).promise.then(()=>this.$legend.css("height","auto"));const s=this.currentStep;this.currentStep=t,this.trigger("step",t),yield this.$steps[s].exit("fade",400).promise,this.$back.setClass("hide",t<=0),this.$next.setClass("hide",t>=this.$steps.length-1),yield this.$steps[t].enter("fade",400).promise}))}};tn=e([Oe("x-algebra-flow",{templateId:"#algebra-flow"})],tn);let en=class extends qe{constructor(){super(...arguments),this.done=!1}ready(){this.$target=this.$(".target"),this.$popup=this.$(".popup");const t=this.$popup.$$(".choice");this.solution=t[0].html;qi.shuffle(l(t.length)).forEach(e=>{this.$popup.append(t[e]),t[e].on("click",()=>{this.removeClass("on"),t[e].blur(),e?(this.$target.html=t[e].html,this.addClass("invalid"),this.trigger("invalid")):(this.solve(),this.trigger("valid",this.solution))})});const e=this.$target.bounds.left+this.$popup.width>fe.width-15;this.setClass("left",e),Lt(this,{enter:()=>{if(this.done)return;this.addClass("on");const t=this.$target.bounds,e=this.$popup.width,s=this.$popup.height,i=fe.width-10-t.left,n=e<i,r=t.right-e>10,o=t.top+t.height+s>fe.height-10;this.setClass("left",r&&!n),this.setClass("top",o),this.$popup.css("max-width",r||n?"none":i+"px")},exit:()=>{this.removeClass("on")},delay:100,exitDelay:400,$clickTarget:this.$target})}solve(t=!1){this.done=!0,this.$target.html=this.solution,this.removeClass("on invalid"),this.addClass("done"),this.trigger("solve",{solution:this.solution,restore:t}),setTimeout(()=>this.$popup.remove(),250),this.$target.removeAttr("tabindex")}};function sn(t){if(t.match("^[0-9]+/[0-9]+$")){const e=t.split("/");return+e[0]/+e[1]}return function(t){return!(t=t.replace(/^–/,"-").trim())||t.match(/[^0-9.,-]/)?NaN:Bs.test(t)?parseFloat(t.replace(/,/,".")):Ds.test(t)?parseFloat(t.replace(/,/g,"")):zs.test(t)?parseFloat(t.replace(/\./g,"").replace(/,/,".")):NaN}(t)}function nn(t,e){const s=function(t,e=1e-6){return Os(t%1,0,e)}(e)&&e>=0;fe.isAndroid&&s||fe.isIOS&&!s?t.setAttr("type","number"):fe.isIOS&&t.setAttr("pattern","[0-9]*")}en=e([Oe("x-blank",{templateId:"#blank"})],en);let rn=class extends qe{constructor(){super(...arguments),this.solution="",this.solutionNum=NaN,this.range=0,this.input="",this.hint="",this.attempts=0,this.placeholder="???",this.done=!1}ready(){if(this.$input=this.$("input"),this.$target=this.$(".target"),this.solution=this.attr("solution"),this.solution.indexOf("±")>=0){const t=this.solution.split("±");this.solution=t[0].trim(),this.range=+t[1]}this.solutionNum=sn(this.solution),this.hint=this.attr("hint"),this.removeAttr("solution"),this.removeAttr("hint"),nn(this.$input,this.solutionNum),this.hasAttr("placeholder")&&(this.placeholder=this.attr("placeholder")),this.$input.setAttr("placeholder",this.placeholder),this.removeAttr("placeholder"),this.$input.change(t=>{this.input=t,this.isCorrect&&(this.solve(),this.trigger("valid",t),this.moveCursor())}),this.$input.onKeyDown("enter",()=>this.$input.blur()),this.$input.on("focus",()=>{this.addClass("on"),this.removeClass("invalid"),this.$input.setAttr("placeholder"," ")}),this.$input.on("blur",()=>{if(this.removeClass("on"),this.setClass("invalid",!!this.input&&!this.done),this.$input.setAttr("placeholder",this.placeholder),this.input&&!this.done){this.attempts+=1;const t=this.attempts>=(this.hint?4:3)?`Hmmm… maybe try ${this.solution}?`:this.attempts>=2?this.hint:void 0;this.trigger("invalid",{hint:t})}})}get isCorrect(){if(this.done)return!0;const t=sn(this.input);return this.input.toLowerCase()===this.solution.toLowerCase()||(this.range&&Math.abs(t-this.solutionNum)<=this.range?(this.solution=this.input,!0):Os(t,this.solutionNum)||Ks(t)===this.solution||this.input===Ks(this.solutionNum))}moveCursor(){const t=this.getParentModel().$step;if(!t)return;const e=t.$blanks[t.$blanks.indexOf(this)+1];e&&!e.done&&"X-BLANK"!==e.tagName&&"hidden"!==e.css("visibility")&&e.bounds.width&&e.focus()}solve(t=!1){this.done=!0,this.$input.remove(),this.$target.html=this.solution,this.addClass("done"),this.trigger("solve",{solution:this.solution,restore:t})}focus(){this.$input.focus()}blur(){this.$input.blur()}};rn=e([Oe("x-blank-input",{templateId:"#blank-input"})],rn);const on=pe;function hn(t){const e=t.prev;e&&i(e.tagName,"MO","MI","MN")?e.insertBefore(t):e?d(e.children).append(t):t.parent.hasClass("math")||(t.parent.prev?t.parent.prev.append(t):t.parent.parent.insertBefore(t))}function an(t,e){e.insertBefore(t),e.parent.removeClass("empty"),t.children.length&&t.children[0].append(e)}function cn(t,e){"abcdefghijklmnopqrstuvwxyzπ".includes(e)?an(le("mi",{text:e}),t):"0123456789.".includes(e)?an(le("mn",{text:e}),t):"+−±×÷<>≤≥=%!".includes(e)?an(le("mo",{text:e,value:e}),t):"frac"===e?an(le("mfrac",{html:'<mrow class="empty"></mrow><mrow class="empty"></mrow>'}),t):"sqrt"===e?an(le("msqrt",{html:'<mrow class="empty"></mrow>'}),t):i(e,"^","sup")?an(le("msup",{html:'<mrow class="empty"></mrow>'}),t):"brackets"===e||"([{|".includes(e)?an(le("mfenced",{html:'<mrow class="empty"></mrow>',type:"("}),t):")]}".includes(e)&&(t.next||"MFENCED"!==t.parent.parent.tagName||t.parent.parent.insertAfter(t))}function ln(t,e){const s=t.$$(`${e}:first-child, *:not(${e}) + ${e}`);for(const t of s)if("MFRAC"!==t.parent.tagName)for(;t.next&&t.next.tagName===e.toUpperCase();)t.text+=t.next.text,t.next.remove()}const dn={"+":"addition","×":"multiplication","/":"fractions or division","−":"subtraction",sqrt:"square roots","^":"powers"};function un(t,e,s){const i=t.variables;if(e.length){const t=i.find(t=>!e.includes(t));if(t){const i=function(t,e){const s=t.length/2,i=p(e.map(e=>({w:e,d:m(t,e)})).filter(({d:t})=>t<s),t=>t.d)[0];return i?i.w:void 0}(t,s||e);return i?`Did you mean “<em>${i}</em>” instead of “<em>${t}</em>”?`:`There shouldn’t be a variable called “<em>${t}</em>”.`}const n=e.find(t=>!i.includes(t));if(n)return`Your expression should contain “<em>${n}</em>”.`}}let pn=class extends qe{constructor(){super(...arguments),this.isDone=!1,this.shortVar=!1,this.lastAttempt="",this.errorCount=0,this.hints=[],this.fns=[],this.validate=void 0}ready(){if(this.$math=this.$(".math"),this.$textarea=this.$("textarea"),this.$cursor=this.$(".cursor"),this.$error=this.$(".error-message"),this.$step=this.getParentModel().$step,this.solution=_s.parse(this.attr("solution")),this.hasAttr("numeric")&&(this.numeric=+this.attr("precision")||.01),this.vars=this.hasAttr("vars")?g(this.attr("vars")):this.solution?this.solution.variables:[],this.hasAttr("fns")&&(this.fns=g(this.attr("fns"))),this.solution&&this.fns.push(...this.solution.functions),this.fns.includes("/")&&!this.fns.includes("×")&&this.fns.push("×"),this.hasAttr("hints")&&(this.hints=g(this.attr("hints"))),this.hasAttr("substitutions")){this.substitutions={},this.autocomplete=this.vars.slice(0);for(const t of this.attr("substitutions").split("|"))if(t.trim()){const[e,s]=t.split(":");this.autocomplete.push(e.trim()),this.substitutions[e.trim()]=_s.parse(s)}}for(const t of["solution","precision","vars","fns","vars-required","substitutions"])this.removeAttr(t);this.shortVar=this.hasAttr("short-var");const t=g(this.attr("keys")||"+ − × ÷ frac sup sqrt brackets"),e=this.$(".keys");for(const s of e.children)t.includes(s.data.type)?(s.on("pointerdown",t=>t.preventDefault()),s.on("pointerup",()=>{cn(this.$cursor,s.data.type),this.check()})):s.remove();this.on("pointerdown",t=>this.onPointerdown(t)),this.$textarea.on("focus",()=>this.onPointerdown()),this.$textarea.on("blur",()=>this.onBlur()),this.$textarea.on("key",t=>this.onKey(t))}focus(){this.trigger("pointerdown")}onPointerdown(t){if(this.isDone)return;t&&t.preventDefault&&t.preventDefault(),this.addClass("active"),this.$textarea.focus();const e=t&&t.target?ae(t.target):this;if("X-EQUATION"===e.tagName||e.hasClass("math")){const e=u(this.$math.children.map(t=>t.outerWidth))/2;!t||Tt(t).x<this.$math.bounds.left+e?this.$math.prepend(this.$cursor):this.$math.append(this.$cursor)}else if("M"===e.tagName[0]){const s=Tt(t).x<e.boxCenter.x;"MROW"===e.tagName?s?e.prepend(this.$cursor):e.append(this.$cursor):s?e.insertBefore(this.$cursor):e.insertAfter(this.$cursor)}}onKey(t){if(i(t.code,on.enter,on.escape))this.$textarea.blur();else if(t.code===on.left)hn(this.$cursor);else if(t.code===on.right)!function(t){const e=t.next;if(e&&i(e.tagName,"MO","MI","MN"))return e.insertAfter(t);e?e.children[0].prepend(t):t.parent.hasClass("math")||(t.parent.next?t.parent.next.prepend(t):t.parent.parent.insertAfter(t))}(this.$cursor);else if(t.code===on.up)!function(t){let e=t.parent;for(;"MFRAC"!==e.parent.tagName||!e.prev;){if(e.hasClass("math"))return;e=e.parent}e.prev.append(t)}(this.$cursor);else if(t.code===on.down)!function(t){let e=t.parent;for(;"MFRAC"!==e.parent.tagName||!e.next;){if(e.hasClass("math"))return;e=e.parent}e.next.prepend(t)}(this.$cursor);else if(i(t.code,on.backspace,on.delete))!function(t){const e=t.prev,s=t.parent;if(e&&i(e.tagName,"MO","MI","MN"))e.remove(),s.children.length<=1&&s.addClass("empty");else if(e||s.prev||s.hasClass("math"))hn(t);else{const e=s.parent;e.insertBefore(t);for(const t of e.children)for(const s of t.children)e.insertBefore(s);e.remove(),t.parent.children.length<=1&&t.parent.addClass("empty")}}(this.$cursor),this.check();else{const e=t.key.replace("*","×").replace("/","÷").replace("-","−");cn(this.$cursor,e),this.check()}}onBlur(){if(this.isDone)return;if(!this.value)return this.removeClass("active has-error");if(this.removeClass("active"),this.addClass("has-error"),this.value===this.lastAttempt)return;if(this.lastAttempt=this.value,!this.$step)return;const t=this.error||(this.hints||[]).shift()||"incorrect",e=this.$step.addHint(t,{class:"incorrect"});this.$error.html=e.text,this.errorCount+=1,this.trigger("error",{count:this.errorCount,msg:t}),this.errorCount>=5&&this.$step.addHint(`Hmmm… maybe try ${this.solution.toMathML()}?`)}check(){if(this.error=void 0,this.value=function t(e,s){if(e instanceof Text)return e.textContent||"";if(e.hasClass("cursor"))return"";const i=e.childNodes;return"MI"===e.tagName?e.text+(s?" ":""):"MFENCED"===e.tagName?"("+t(i[0],s)+")":"MSUP"===e.tagName?"^("+t(i[0],s)+")":"MFRAC"===e.tagName?`(${t(i[0],s)})/(${t(i[1],s)})`:"MSQRT"===e.tagName?"sqrt("+t(i[0],s)+")":i.map(e=>t(e,s)).join("")}(this.$math,this.shortVar).trim(),!this.value)return;if(this.$math.$(".empty"))return this.error="Fill in all empty placeholders in the expression.";const t=function(t){try{return{expr:_s.parse(t,!0)}}catch(t){return{error:t instanceof Ge?t.message:"This is not a valid mathematical expression."}}}(this.value);if(t.error)return this.error=t.error;const e=this.substitutions?t.expr.substitute(this.substitutions):t.expr;if(this.numeric&&function(t,e,s=.001){try{return Os(t.evaluate(),e.evaluate(),s)}catch(t){return!1}}(this.solution,e,this.numeric))return this.solve();if(this.validate){const e=this.validate(t.expr)||{};if(e.isCorrect)return this.complete(t.expr);if(e.error)return this.error=e.error}if(this.solution&&_s.numEquals(this.solution,e))return this.complete(t.expr);const s=un(e,this.vars,this.autocomplete);if(s)return this.error=s;const i=function(t,e){if(e.length){const s=t.functions.find(t=>!e.includes(t));if(s)return`This expression should not contain ${dn[s]||"“"+s+"”"}.`}}(e,this.fns);return i?this.error=i:void 0}complete(t){this.isDone||(this.isDone=!0,this.removeClass("has-error active"),this.addClass("done"),this.$textarea.blur(),this.shortVar||ln(this.$math,"mi"),ln(this.$math,"mn"),this.trigger("solve",{expr:t}))}solve(){this.$math.removeClass("empty"),this.$math.html=this.solution.toMathML(),this.complete(this.solution)}};pn=e([Oe("x-equation",{templateId:"#equation"})],pn);const fn={opacity:[0,1],transform:["translateX(-50px)","none"]},gn={error:"You’ve already had this expression before. Try simplifying it."};let mn=class extends qe{constructor(){super(...arguments),this.rowCount=1,this.previousAnswers=[],this.isSolved=!1,this.maxRows=6,this.steps=[],this.hints=[]}created(){this.$table=this.$("table tbody"),this.lastRowContent=this.$table.$("tr:last-child").html}ready(){this.hasAttr("max-rows")&&(this.maxRows=+this.attr("max-rows")),this.hasAttr("steps")&&(this.steps=this.attr("steps").split("|")),this.hasAttr("hints")&&(this.hints=this.attr("hints").split("|")),this.removeAttr("steps"),this.removeAttr("hints"),this.setupEquation(this.$("x-equation"))}setupEquation(t){this.$equation=t,t.one("solve",t=>this.onSolveRow(t.expr)),t.hints=this.hints,t.validate=t=>{const e=this.previousAnswers.includes(t.toString());return(this.validate?this.validate(t,e):void 0)||(e?gn:{})}}onSolveRow(t){if(this.trigger("solve-row",{expr:t,$math:this.$equation.$math}),this.isFinal&&this.isFinal(t))return this.trigger("solve");if(this.isSolved)return;if(this.rowCount+=1,this.previousAnswers.push(t.toString()),this.rowCount>this.maxRows){const t=this.$equation.solution.toMathML();this.trigger("hint","You have to fully simplify this expression. The correct solution is $0.".replace("$0",t)),this.trigger("solve")}const e=le("tr",{html:this.lastRowContent},this.$table);e.animate(fn,400,500),this.setupEquation(e.$("x-equation")),setTimeout(()=>this.$equation.focus(),1200)}solve(){if(this.isSolved=!0,this.steps.length){const t=this.$table.$("tr:last-child"),e=this.lastRowContent.replace(/<x-equation.*<\/x-equation>/,'<span class="math fill"></span>');for(const s of this.steps){const i=le("tr",{html:e},this.$table),n=i.$(".math.fill"),r=_s.parse(s);n.html=r.toMathML(),t.insertBefore(i),this.trigger("solve-row",{expr:r,$math:n})}}this.$equation.solve()}};mn=e([Oe("x-equation-system")],mn);let vn=class extends qe{ready(){const t=this.$(".btn-red"),e=this.$(".text-area"),s=this.getParentModel().$step,i="no"!==this.attr("toolbar"),n=this.hasAttr("plain");if(s&&s.initialData&&s.initialData.data){const t=s.initialData.data.freeText;t&&(e.html=t)}if(i)for(const t of this.$$(".toolbar .btn")){const e=t.data.command.split(":");t.on("click",()=>document.execCommand(e[0],!1,e[1]))}else this.$(".toolbar").remove();let r="";const o=h(()=>s.storeData("freeText",r));e.on("change keyup input paste",()=>{const t=e.text;n&&(e.text=t),r=e.html,this.trigger("change",{text:t,html:r}),o()}),t.on("click",()=>{this.trigger("submit"),s.score("quill")})}};vn=e([Oe("x-free-text",{templateId:"#free-text"})],vn);let wn=class extends qe{ready(){const t=this.$(".wrapper"),e=this.$(".panel"),s=e.children,i=this.$(".next"),n=this.$(".back"),r=this.$(".dots"),o=s.map(()=>le("div",{class:"dot"},r)),h=s.length,a=+this.attr("slide-width")||void 0;let c=this.width,l=1,d=c,u=0,p=0;const f=t=>{p=t,e.translate(t,0),this.trigger("move",t)},g=t=>{u=t;for(const[e,s]of o.entries())s.setClass("on",e>=t&&e<t+l);i.setClass("disabled",t===h-l),n.setClass("disabled",0===t),this.trigger("change",t)};fe.onResize(()=>{c=this.width,l=a?Math.ceil(c/a):1,d=c/l;for(const t of s)t.css("width",d+"px");e.css("width",h*d+"px"),f(-u*d),g(u)});let m="quad";let v,w,y,x,$=!1;const b=()=>{v=Date.now()-x,f(w+y*be(m,v/500)),!$&&v<500?requestAnimationFrame(b):this.trigger("slide-end")};function M(t){$=!1,v=0,w=p,y=-t*d-p,x=Date.now(),g(t),b()}let C,k,P,A;i.on("click",(function(){m="quad",u<h-l&&M(u+1)})),n.on("click",(function(){m="quad",u>0&&M(u-1)})),Et(t,{start:t=>{$=!0,C=p,k=t.x,A=P=k},move:t=>{P=A,A=t.x;const e=C-k+t.x,s=-(h-l)*d;f(e>0?e/4:e<s?s+(e-s)/4:e),this.css("pointer-events","none")},end:()=>{const t=A-P,e=t>12?1:t<-12?-1:0;m="quad-out",M(Ys(Math.round(-p/d-e),0,h-l)),setTimeout(()=>this.css("pointer-events","auto"))}})}};wn=e([Oe("x-gallery",{templateId:"#gallery"})],wn);let yn=class extends qe{constructor(){super(...arguments),this.history=[],this.playing=!1,this.completed=!1,this.slideGenerator=()=>{}}ready(){this.addClass("paused");const t=this.$(".slide-template");this.slideTemplate=t.html,t.remove(),this.time=+this.attr("time")||8e3,this.goal=(this.attr("goal")||"6/8").split("/").map(t=>+t),this.$progress=this.$(".progress"),this.$dots=this.$(".dots"),this.$dots.css("margin-left",-8*this.goal[1]+"px");for(let t=0;t<this.goal[1];++t)le("div",{class:"dot"},this.$dots);this.$(".toggle").on("click",()=>{this[this.playing?"pause":"play"]()})}score(t){if(this.$dots.children[this.history.length].addClass(t?"green":"red"),this.history.push(t),!this.completed&&u(this.history)>=this.goal[0])return this.completed=!0,this.$("x-solved").enter(),this.trigger("score"),this.pause(),!0}makeSlide(){if(!this.playing)return;if(this.history.length>=this.goal[1]){this.history.shift(),this.$dots.animate({transform:["none","translateX(-16px)"]},300).promise.then(()=>this.$dots.css("transform","none"));const t=this.$dots.children[0];t.exit("fade",300).promise.then(()=>t.remove());le("div",{class:"dot"},this.$dots).enter("fade",300)}if(this.$currentSlide){const t=this.$currentSlide;t.animate({transform:["none","translateX(-100%)"]},400).promise.then(()=>{t.remove()})}const t=le("div",{class:"slide",html:this.slideTemplate},this);t.animate({transform:["translateX(100%)","none"]},400);const e=this.time*(1-u(this.history)/this.goal[1]/2),s=this.$progress.animate({width:["100%","0%"]},e,400,"linear"),i=e=>{t.addClass("done");const i=this.score(e);s.cancel(),i||setTimeout(()=>this.makeSlide(),1e3)};function n(e){t.trigger("error",e),i(0)}s.promise.then(n),this.$currentSlide=t,this.currentAnimation=s,this.slideGenerator(t,(function(e){t.trigger("success",e),i(1)}),n)}setFirstSlide(t){this.$currentSlide=le("div",{class:"slide",html:this.slideTemplate},this),t(this.$currentSlide)}play(){this.playing||(this.playing=!0,this.removeClass("paused"),this.makeSlide(),this.$("x-solved").hide())}pause(){this.playing&&(this.playing=!1,this.currentAnimation&&this.currentAnimation.cancel(),this.addClass("paused"))}};yn=e([Oe("x-gameplay",{templateId:"#gameplay"})],yn);const xn=JSON.parse(ae("#glossary").text),$n=JSON.parse(ae("#bios").text);let bn=void 0;fe.onResize(()=>{bn&&bn.hide()});let Mn=class extends qe{ready(){this.xid=this.attr("xid"),this.$target=this.$(".target"),this.$popup=this.$(".popup"),this.$popup.html=this.body()||"",this.setClass("left",fe.width>600&&this.$target.bounds.left+this.$popup.width>fe.width-15),Lt(this,{enter:()=>this.show(),exit:()=>this.hide(),delay:100,exitDelay:200,$clickTarget:this.$target,canFocusWithin:!0,preventMouseover:()=>fe.width<=600})}show(){if(bn=this,this.addClass("on"),fe.width<=600){const t=ae("#glossary-modal");return t.$(".modal-body").html=this.body(),t.open()}const t=this.$target.bounds,e=this.$popup.width,s=this.$popup.height,i=t.top+t.height+s<fe.height-10,n=t.top-s>(window.isWebView?10:54);this.setClass("top",n&&!i),this.setClass("left",t.left+e>fe.width-15)}hide(){bn=void 0,this.removeClass("on")}body(){const t=xn[this.xid];if(!t)return console.warn("missing gloss:",this.xid);let e=t.text;if(t.image&&(e+=`<img class="gloss-img" alt="" src="/resources/shared/glossary/${t.image}"/>`),t.link&&!window.isWebView){location.pathname===t.link.split("#")[0]||(e+=`<p><a href="${t.link}" class="btn btn-white btn-small" target="_blank">Learn more…</a></p>`)}return e}};Mn=e([Oe("x-gloss",{templateId:"#gloss"})],Mn);let Cn=class extends Mn{body(){const t=$n[this.xid];if(!t)return console.warn("missing bio:",this.xid);const e=`<img class="bio-img" alt="" src="/resources/shared/bios/${this.xid}.jpg"/>`,s=t.born?`<p><a href="/timeline/${this.xid}" class="btn btn-white btn-small" target="_blank">Timeline</a></p>`:"";return(!1===t.image?"":e)+t.bio+s}};Cn=e([Oe("x-bio",{templateId:"#gloss"})],Cn);let kn=!1,Pn={x:0,y:0,s:1},An=void 0;const Tn=le("div",{class:"lightbox-overlay"},de),Sn=le("div",{class:"lightbox-img"},Tn);function _n(){kn&&(kn=!1,Tn.removeClass("on"),Sn.setTransform(Pn,0,Pn.s),setTimeout(()=>{An.css("visibility","visible"),Tn.css("display","none"),Sn.css("transform","none"),Sn.removeClass("transitions")},400))}Tn.on("click touchmove",_n),fe.onKey("escape",_n),Tn.on("scrollwheel touchmove",t=>{t.preventDefault(),t.stopPropagation()}),fe.onKey("space up down left right pagedown pageup",t=>{kn&&(t.preventDefault(),t.stopPropagation())});let In=class extends qe{ready(){const t=this.attr("src"),e=this.$(".wrap"),s=this.attr("width"),i=this.attr("height");this.css("width",s+"px"),e.css("padding-bottom",+i/+s*100+"%");const n=e.$("img");n.setAttr("src",t),n.setAttr("alt",this.attr("alt")||""),t.endsWith(".gif")&&n.on("click",()=>n.setAttr("src",t));const r=e.$(".credit"),o=this.attr("credit");o?r.text=o:r.remove();const h=e.$(".zoom");if(this.hasAttr("lightbox")){this.addClass("interactive");const e=t.replace(/\.(?=[^.]*$)/,"-large.");this.on("click",()=>function(t,e,s){kn=!0,An=t,Tn.show(),Sn.show();const i=t.bounds,n=Sn.bounds,r=i.left+i.width/2-n.left-n.width/2,o=i.top+i.height/2-n.top-n.height/2,h=Math.max(i.width/n.width,i.height/n.height);Pn={x:r,y:o,s:h},Sn.css("background-image",`url(${s}), url(${e})`),Sn.css("transform",`translate(${r}px, ${o}px) scale(${h})`),fe.redraw(),Sn.addClass("transitions"),fe.redraw(),t.css("visibility","hidden"),Tn.addClass("on"),Sn.css("transform","scale(1) translate(0,0)")}(this,t,e))}else h.remove()}};In=e([Oe("x-img",{templateId:"#image"})],In);let En=class extends qe{constructor(){super(...arguments),this.correctCount=0,this.solvedCount=0,this.isSolved=!1}ready(){this.$items=this.children,this.itemsClicked=this.$items.map(()=>!1),this.$items.forEach((t,e)=>{const s=t.data.error,i=s?"incorrect":"correct";s||(this.correctCount+=1),t.one("click",()=>{this.itemsClicked[e]||this.isSolved||(this.trigger("hint",{msg:s||"correct",class:i}),t.addClass(i),s||(this.solvedCount+=1,this.trigger("score","picker-"+e),this.checkSolved()))})})}restore(t){const e=t.map(t=>+t.slice(7));for(const t of e)this.itemsClicked[t]=!0,this.$items[t].addClass("correct");this.solvedCount=e.length,this.checkSolved()}checkSolved(){this.solvedCount<this.correctCount||(this.addClass("solved"),this.isSolved=!0)}};En=e([Oe("x-picker")],En);let Ln=class extends qe{constructor(){super(...arguments),this.visible=!0}ready(){this.on("click",()=>{this.play(),setTimeout(()=>this.trigger("play"),400)})}play(){this.visible&&(this.visible=!1,this.exit("pop",400))}reset(){this.visible||(this.visible=!0,setTimeout(()=>this.enter("pop"),400))}};Ln=e([Oe("x-play-btn",{templateId:"#play-btn"})],Ln);let qn=class extends qe{constructor(){super(...arguments),this.playing=!1}ready(){this.$icon=this.$("x-icon-btn"),this.$("button").on("click",()=>this.toggle())}toggle(){this.playing?this.pause():this.play()}play(){this.playing||(this.playing=!0,this.$icon.setAttr("icon","pause"),this.trigger("play"))}pause(){this.playing&&(this.playing=!1,this.$icon.setAttr("icon","play"),this.trigger("pause"))}};qn=e([Oe("x-play-toggle",{templateId:"#play-toggle"})],qn);let On=class extends qe{ready(){const t=this.children[0],e=+this.attr("width")||760;t.css("width",e+"px");const s=t.height;fe.onResize(()=>{const i=this.width/e;this.css("height",s*i+"px"),t.css("transform",`scale(${i})`)})}};On=e([Oe("x-scale-box",{template:"<div><slot></slot></div>"})],On);let Rn=class extends qe{constructor(){super(...arguments),this.current=0}ready(){this.steps=+this.attr("steps"),this.speed=+this.attr("speed")||1;const t=this.$(".bar"),e=this.$(".knob"),s=this.hasAttr("continuous"),i=this.hasAttr("snap")?t.width/this.steps:.001;this.drag=new Ae(e,t,{moveY:!1,snap:i}),this.drag.on("start",()=>{this.animation&&this.animation.cancel(),this.animation=void 0}),this.drag.on("move",t=>{let e=t.x/this.drag.width*this.steps;s||(e=Math.round(e)),Os(e,this.current)||(this.current=e,this.trigger("move",e))}),this.drag.on("end",()=>this.trigger("slide-end"));const n=this.$(".play");this.hasAttr("no-play")?n.remove():n.on("click",()=>this.play()),this.on("attr:steps",t=>this.steps=+t.newAttr)}set(t){Os(t,this.current)||this.drag.setPosition(t*this.drag.width/this.steps,0)}play(){return s(this,void 0,void 0,(function*(){this.current>=this.steps&&this.set(0);const t=3e3*(1-this.current/this.steps)/this.speed;this.moveTo(this.steps,t)}))}moveTo(t,e=600){return s(this,void 0,void 0,(function*(){if(this.animation||t===this.current)return;const s=this.current;this.animation=xe(e=>{this.set(s+(t-s)*be("quad",e))},e),yield this.animation.promise,this.animation=void 0,this.trigger("slide-end")}))}bindVariable(t,e){t[e]=0,this.on("move",s=>t[e]=s),t.watch(()=>this.set(t[e]))}};Rn=e([Oe("x-slider",{attributes:["steps"],templateId:"#slider"})],Rn);let Nn=class extends qe{constructor(){super(...arguments),this.length=0,this.current=0,this.locked=!1}ready(){this.$legend=this.$(".legend-box"),this.$steps=this.$legend.children,this.$back=this.$(".back"),this.$next=this.$(".next");const t=this.$(".dots");this.$dots=this.$steps.map(()=>le("div",{class:"dot"},t)),this.length=this.$steps.length,this.current=0,this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.$steps[0].show(),this.$dots[0].addClass("on")}go(t){if(this.locked||t<0||t>this.length-1||t===this.current)return;this.locked=!0,setTimeout(()=>this.locked=!1,600),this.$back.setClass("disabled",0===t),this.$next.setClass("disabled",t===this.length-1),this.$dots[this.current].removeClass("on"),this.$dots[t].addClass("on"),this.$steps[t].show();const e=this.$steps[t].height+"px";this.$steps[t].hide(),this.$steps[this.current].exit("fade",300).promise.then(()=>this.$steps[t].enter("fade",300)),this.$legend.animate({height:e},600).promise.then(()=>this.$legend.css("height","auto")),this.current=t,this.trigger("step",t)}goNext(){this.locked||(this.go(this.current+1),this.trigger("next",this.current))}goBack(){this.locked||(this.go(this.current-1),this.trigger("back",this.current))}};Nn=e([Oe("x-slideshow",{templateId:"#slideshow"})],Nn);const jn=f(M.rainbow(8)),Vn=f(["badge","homework","laurels","lightbulb","owl","scroll","trophy"]);let Bn=class extends qe{constructor(){super(...arguments),this.visible=!1}ready(){this.$svg=this.$("use"),this.$text=this.$(".message"),this.$step=this.getParentModel().$step,this.on("click",()=>this.exit())}enter(){if(this.visible)return ye;this.visible=!0;const t=this.$step?this.$step.addHint("correct").text:"correct",e=jn(),s=Vn();return this.css("background-color",e.toString()),this.$text.text=t.replace(/<.*?>/g,""),this.$svg.setAttr("xlink:href","/sketch.svg#"+s),ve(),ke(this,"pop",300,600)}exit(){return this.visible?(this.visible=!1,Pe(this,"pop",300)):ye}};function Dn(t,e){const s=function(t){let e=0;return t.map(t=>e+=t)}(t.map(t=>t.h+10));for(const[i,n]of t.entries())n!==e&&n.drag.setPosition(0,s[i-1]||0)}Bn=e([Oe("x-solved",{templateId:"#solved"})],Bn);let zn=class extends qe{ready(){this.items=this.children.map(t=>({drag:new Ae(t,this,{moveX:!1,useTransform:!0}),index:+t.data.index,h:0}));for(const t of this.children)t.removeAttr("data-index");for(const t of this.items)t.drag.on("drag",()=>{this.items=p(this.items,e=>e.drag.position.y-(e===t?10:0)),Dn(this.items,t)}),t.drag.on("end",()=>{var t;Dn(this.items),((t=this.items).every((t,e)=>t.index===e)||t.every((e,s)=>e.index===t.length-s-1))&&this.solve()});fe.onResize(()=>{for(const t of this.items)t.h=t.drag.$el.height;const t=u(this.items.map(t=>t.h));this.css("height",t+10*this.items.length-10+"px"),Dn(this.items)})}solve(){this.trigger("solve"),this.addClass("solved");for(const t of this.items)t.drag.disabled=!0}};zn=e([Oe("x-sortable")],zn);const Hn=f(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]);class Wn{constructor(t){this.index=t,this.color=Hn(),this.tilt=Math.floor(10*Math.random())-10,this.tiltAngleIncrement=.07*Math.random()+.05,this.tiltAngle=0,this.x=Math.random()*fe.width,this.y=(Math.random()-1)*fe.height,this.r=qi.uniform(10,30)}draw(t){t.beginPath(),t.lineWidth=this.r/2,t.strokeStyle=this.color,t.moveTo(this.x+this.tilt+this.r/4,this.y),t.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),t.stroke()}update(t,e){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(t)+3+this.r/2)/2,this.x+=Math.sin(t),this.tilt=15*Math.sin(this.tiltAngle-this.index/3),this.x<-20?(this.x=-20,this.y=Math.random()*fe.height,this.tilt=Math.floor(10*Math.random())-20):this.x>fe.width+20?(this.x=fe.width+20,this.y=Math.random()*fe.height,this.tilt=Math.floor(10*Math.random())-20):e&&this.y>fe.height&&(this.x=Math.random()*fe.width,this.y=-10,this.tilt=Math.floor(10*Math.random())-20)}}let Fn=void 0;function Un(t=2e3,e=150){Fn||(Fn=le("canvas",{style:"position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999"},de)),Fn.setAttr("width",fe.width),Fn.setAttr("height",fe.height),Fn.show();const s=Fn.ctx,i=c(t=>new Wn(t),e),n=xe(e=>{s.clearRect(0,0,fe.width,fe.height);const r=e<t;let o=0;for(const t of i)t.draw(s),t.update(e,r),t.y<fe.height&&(o+=1);o||(n.cancel(),Fn.hide())})}let Kn=class extends qe{constructor(){super(...arguments),this.model=Te({$step:this}),this.tools={confetti:Un},this.isShown=!1,this.isCompleted=!1,this.scores=new Set}ready(){this.goals=g(this.attr("goals")),this.$course=(this.getParentModel()||{}).$course,this.$blanks=this.$$("x-blank, x-blank-input");for(const[t,e]of this.$blanks.entries())e.on("valid",()=>{this.addHint("correct"),this.score("blank-"+t)}),e.on("invalid",t=>this.addHint(t.hint||"incorrect",{class:"incorrect"}));this.$equations=this.$$("x-equation, x-equation-system").filter(t=>!t.parents("x-equation-system").length);for(const[t,e]of this.$equations.entries())e.on("solve",()=>{this.addHint("correct"),this.score("eqn-"+t)});for(const t of this.$$("x-equation-system"))t.on("hint",t=>this.addHint(t));this.$reveals=this.$$(".reveal");for(const t of this.$reveals){t.data.display="visibility";const e=+t.data.duration||400,i=600+(+t.data.delay||0);this.onScore(t.data.when,()=>s(this,void 0,void 0,(function*(){"visible"!==t.css("visibility")&&(yield t.enter(t.data.animation||"fade",e,i).promise,t.css("opacity",""),t.trigger("reveal"))})))}this.$nextBtn=this.$$(".next-step");for(const[t,e]of this.$nextBtn.entries())this.onScore("next-"+t,()=>e.exit("pop")),e.one("click",()=>this.score("next-"+t));for(const t of this.$$(".check[data-when]"))this.onScore(t.data.when,()=>t.addClass("visible"));this.$picker=this.$("x-picker"),this.$picker&&(this.$picker.on("hint",t=>this.addHint(t.msg,{class:t.class})),this.$picker.on("score",t=>this.score(t)));for(const t of this.$$(".step-target"))Lt(t,{enter:()=>{const e=this.$$('[target~="'+t.data.to+'"]');for(const t of e)t.addClass("focus");this.addClass("focus"),this.trigger("target-focus",{$targets:e})},exit:()=>{for(const t of this.$$(".focus"))t.removeClass("focus");this.removeClass("focus")}});const t=this.$("x-slideshow");t&&t.on("next",t=>this.score("slide-"+(t-1)));const e=this.$("x-algebra-flow");e&&e.on("next",({step:t})=>this.score("algebra-flow-"+(t-1))),this.$sortables=this.$$("x-sortable");for(const[t,e]of this.$sortables.entries())e.on("solve",()=>{this.addHint("correct"),this.score("sortable-"+t)});const i=this.$("x-gameplay");i&&i.on("score",()=>this.score("gameplay")),this.$$("x-slider").forEach((t,e)=>{t.on("slide-end",()=>this.score("slider-"+e))});const n=this.$("x-quill");n&&n.on("submit",()=>this.score("quill"));for(const[t,e]of this.$$("x-var").entries())e.on("slide-end",()=>this.score("var-"+t));for(const t of this.$$(".var, .var-action, x-slider"))t.bindModel(this.model);this.$course&&this.$course.audio&&(this.narration=new Ve(this.$course.audio,this))}show(){if(this.isShown)return;this.isShown=!0;try{const t=this.id.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(t,e)=>e.toUpperCase());window.StepFunctions&&window.StepFunctions[t]&&window.StepFunctions[t](this)}catch(t){console.error(t)}this.initialData&&this.restore(this.initialData);const t=this.$$("x-gesture[target]");setTimeout(()=>{if(!this.isReady)for(const e of t)e.start()},2e3),this.$course&&this.$course.log("Step","show",this.id),this.trigger("show"),this.addClass("on"),fe.resize(),setTimeout(()=>{this.narration&&this.narration.play()},400)}complete(){if(!this.isCompleted){this.isShown||this.show(),this.isCompleted=!0;for(const t of this.$reveals)"visible"!==t.css("visibility")&&t.enter("fade",400).promise.then(()=>t.css("opacity",""));for(let t=0;t<this.$nextBtn.length;++t)this.score("next-"+t);this.trigger("complete")}}restore(t){this.$blanks.forEach((e,s)=>{t.scores.includes("blank-"+s)&&e.solve(!0)}),this.$equations.forEach((e,s)=>{t.scores.includes("eqn-"+s)&&e.solve()}),this.$sortables.forEach((e,s)=>{t.scores.includes("sortable-"+s)&&e.solve()}),this.$picker&&this.$picker.restore(t.scores.filter(t=>t.startsWith("picker-"))),t.scores.forEach(t=>this.score(t,!1))}get isReady(){return this.goals.every(t=>this.scores.has(t))}get isPageLoaded(){return!this.$course||this.$course.isReady}score(t,e=!0){this.scores.has(t)||(this.scores.add(t),this.trigger("score-"+t),this.trigger("score"),this.$course&&(this.$course.trigger("score"),this.$course.saveProgress({steps:{[this.id]:{scores:[t]}}}),this.$course.log("Step","score",this.id+"/"+t)),e&&this.isReady&&this.$course&&this.$course.isReady&&setTimeout(()=>{this.$course.$activeStep===this&&this.$course.nextStep()},1200))}storeData(t,e){this.$course&&this.$course.saveProgress({steps:{[this.id]:{data:{[t]:e}}}})}onScore(t,e){const s=g(t);if(s.every(t=>this.scores.has(t)))return e&&e(),Promise.resolve();const i=o(),n=()=>{s.every(t=>this.scores.has(t))&&(e&&e(),i.resolve(),this.off("score",n))};return this.on("score",n),i.promise}addHint(t,e={}){return this.trigger("hint",t),this.$course&&this.$course.isReady?this.isInViewport?this.$course.$tutor.showHint(t,e):(this.one("enterViewport",()=>this.$course.$tutor.showHint(t,e)),{text:this.$course.$tutor.hints[t]||t}):{text:t}}getText(t){return this.$course&&this.$course.$tutor&&this.$course.$tutor.hints[t]||t}getHelp(){}delayedHint(t,e=1e4){let s=setTimeout(t,e);this.on("score",()=>{clearTimeout(s),this.isCompleted||(s=setTimeout(t,2e4))}),this.on("complete",()=>clearTimeout(s))}get nextStep(){if(!this.$course)return;const t=this.$course.$steps.indexOf(this);return this.$course.$steps[t+1]}};Kn=e([Oe("x-step")],Kn);const Gn=ce("header, x-tutor, .sidebar"),Xn=le("svg",{class:"target-body",style:"position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            display: none; pointer-events: none; z-index: 900; opacity: 0;\n            transform: translateZ(0); will-change: opacity; transition: opacity .3s;",html:'<defs>\n      <mask id="masking"><rect width="100%" height="100%" fill="white"/></mask>\n    </defs>\n    <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto">\n      <path d="M 0 0 L 10 5 L 0 10 z"/>\n    </marker>\n    <rect x="0" y="0" width="100%" height="100%" mask="url(#masking)" fill="white" opacity="0.9"/>\n    <path id="target-arrow" stroke="black" stroke-width="5" marker-end="url(#arrow)" opacity="0.3" stroke-linecap="round"/>'},de);const Yn=Xn.$("mask"),Zn=Xn.$("#target-arrow");let Jn=!1,Qn=[],tr=class extends qe{ready(){this.setAttr("tabindex",0);const t=this.attr("to"),e=this.hasAttr("no-margins");let s,r,o,h=void 0;const a=()=>{Jn=!0;const s=ce(t);if(!s.length)return;const i=s[0].hasParent(...Gn);void 0===h&&(h=this.hasParent(...Gn));const n=this.bounds,o=s.map(t=>t.bounds).filter(t=>t.width||t.height);if(r=0,!i){const t=Math.min(...o.map(t=>t.top)),e=Math.max(...o.map(t=>t.top+t.height)),s=fe.height-12-e,i=(window.isWebView?12:56)-t;r=s<0?s:i>0?i:0}for(const t of Qn)t.remove();Qn=[n,...o].map((t,s)=>{const i=s?e?4:10:0;return le("rect",{x:t.left-i,y:t.top-i+(s||!h?r:0),width:t.width+2*i,height:t.height+2*i,rx:4,ry:4},Yn)}),Zn.points=function(t,e,s,i){const n=new ii(t.left-15,t.top+s-15),r=new wi(n,t.width+30,t.height+30).project({x:e.left+e.width/2,y:e.top+e.height/2+i}),o=new ii(e.left-15,e.top+i-15);return[r,new wi(o,e.width+30,e.height+30).project({x:t.left+t.width/2,y:t.top+t.height/2+s})]}(n,o[0],h?0:r,i?0:r)},c=()=>{r&&de.scrollBy(-r,300),Xn.css("display","block"),fe.redraw(),n((function(){Xn.css("opacity",1)}),r?300:0)},l=t=>{if(Jn){if(t){if(i(t.type,"mousemove","pointermove")&&function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])}(s,[t.clientX,t.clientY])<40)return}clearTimeout(o),Jn=!1,Xn.css("opacity",0),setTimeout(()=>{Jn||Xn.css("display","none")},300),de.off("mousewheel mousemove touchend touchmove",l),this.off("mouseleave blur",l)}},d=()=>{r&&!h?de.on("mousemove",l):this.on("mouseleave",l),de.on("mousewheel touchend touchmove",l),this.on("blur",l)};this.on("mouseenter touchstart focus",t=>{s=[t.clientX,t.clientY],a(),o=window.setTimeout(c,r?50:30),d()}),this.on("click",e=>{Jn?(e.handled=!0,l(),setTimeout(()=>ae(t).trigger("click mousedown"))):(Jn=!0,r=0,c(),d())})}};tr=e([Oe("x-target")],tr);const er=/[0-9+\-*/()^\s]+/g;function sr(t,e,s={}){const n=le("div",{class:"msg-wrap","data-display":"flex"}),r=le("div",{class:"msg "+e},n);return s.class&&r.addClass(s.class),s.visible||n.hide(),i(e,"hint","question")?r.html=t:"img"===e?r.css("background-image",`url(${t})`):"video"===e&&le("iframe",{src:t,allowfullscreen:!0},r),n}let ir=class extends qe{constructor(){super(...arguments),this.recentMessages=[],this.isOpen=!1,this.queuePromise=Promise.resolve()}ready(){this.$course=(this.getParentModel()||{}).$course,this.hints=JSON.parse(ae("#hints").text)||{},this.correct=f(qi.shuffle(this.hints.correct||[])),this.incorrect=f(qi.shuffle(this.hints.incorrect||[])),this.$toasts=this.$(".toasts"),this.$chat=this.$(".chat"),this.$chatBody=this.$(".chat-body"),this.$toasts.on("click",t=>{t.handled||this.open()}),this.$(".close").on("click",()=>this.close());const t=this.$(".chat-footer");this.$query=t.$(".input"),this.$query.onKeyDown("enter",t=>{t.preventDefault(),this.askQuestion(this.$query.text.trim()),this.$query.text=""}),this.$query.on("focus",()=>t.addClass("focus")),this.$query.on("blur",()=>t.removeClass("focus")),this.$(".hint").on("click",()=>{this.queue(this.hints.tutorial1),this.queue(this.$course.user?this.hints.tutorial2:this.hints.account)})}open(){this.isOpen||(this.isOpen=!0,this.$chat.enter("slide-up",200),this.$chatBody.scrollTop=this.$chatBody.scrollHeight,this.trigger("open"))}close(){this.isOpen&&(this.isOpen=!1,this.$query.blur(),this.trigger("close"),this.$chat.exit("slide-down",200))}queue(t,e="hint",s={}){this.queuePromise=this.queuePromise.then(()=>(this.display(t,e,s),r(500)))}display(t,e="hint",s={}){let i=s.timeout||8e3;fe.width<640&&(i*=.7);if((null==s.toast||s.toast)&&!this.isOpen){const n=sr(t,e,s);this.$toasts.append(n),n.enter("reveal-right"),setTimeout(()=>n.exit("reveal-right",400,0,!0),i),this.on("open",()=>n.exit("reveal",200,0,!0))}const n=sr(t,e,{class:s.class,visible:!this.isOpen});this.$chatBody.append(n),this.isOpen&&(n.enter("reveal",300),xe(()=>this.$chatBody.scrollTop=this.$chatBody.scrollHeight,200))}showHint(t,e={}){if(i(t,"correct","incorrect")){const s="correct"===t?this.correct():this.incorrect(),i="correct"===t?3e3:5e3;return this.queue(s,"hint",{class:e.class||t,timeout:i}),{text:s}}let s=this.hints[t]||t;if(e.variables)for(const[t,i]of Object.entries(e.variables))s=s.replace(new RegExp("\\$"+t,"g"),i);return!e.force&&this.recentMessages.includes(t)||(this.recentMessages.push(t),setTimeout(()=>this.recentMessages.shift(),1e4),!1!==e.store&&this.$course&&this.$course.saveProgress({hints:[{content:s,kind:"hint"}]}),this.queue(s,"hint",{class:e.class})),{text:s}}askQuestion(t){if(!t)return;this.queue(t,"question"),this.$course&&this.$course.log("Tutor","ask",t);const e=(t.match(er)||[]).filter(t=>t.length>=3&&!t.match(/^[\s0-9]+$/));if(e.length)try{const t=_s.parse(e[0],!0),s=t.evaluate();return this.queue(`<span class="math">${t.toMathML()}<mo value="=">=</mo><mn>${s}</mn></span>`)}catch(t){console.log("Parse Error:",e[0])}}meanEasterEgg(){}};ir=e([Oe("x-tutor",{templateId:"#tutor"})],ir);const nr=le("div",{class:"var-overlay"},de);let rr=class extends qe{constructor(){super(...arguments),this.valueChange=!1}ready(){const t=this.attr("bind");if(!t)return;const[e,s,i]=t.split("|");[this.min,this.max,this.step]=i.split(",").map(t=>+t),this.name=e,this.model=this.getParentModel(),this.$(".content").bindModel(this.model),this.$progress=this.$(".progress"),this.setValue(+s);const n=20*(fe.isMobile?1.5:1)/Ys((this.max-this.min)/this.step/12,1,3);let r=0,o=0;for(const t of this.$$(".left, .right")){const e=t.hasClass("left")?-this.step:this.step;t.on("click",()=>{this.setValue(this.value+e),this.trigger("slide-end")})}Et(this,{start:t=>{r=t.x,o=this.value,this.addClass("on"),this.valueChange=!1,nr.show(),ue.addClass("grabbing")},move:t=>{const e=(t.x-r)/n;this.setValue(o+Gs(e)*this.step)},end:()=>{this.removeClass("on"),this.valueChange&&this.trigger("slide-end"),nr.hide(),ue.removeClass("grabbing")}})}setValue(t){const e=Gs(Ys(t,this.min,this.max),2);if(e===this.value)return;this.value=e,this.valueChange=!0,this.model&&(this.model[this.name]=e);const s=this.max-this.min;this.$progress.css("width",116*(e-this.min)/s+"px")}};function or(t){const e=Math.floor(t/60),s=Math.floor(t%60);return e+":"+(s<10?"0":"")+s}rr=e([Oe("x-var",{templateId:"#var"})],rr);let hr=class extends qe{ready(){const t=this.attr("src"),e=this.$(".video-wrap"),s=this.$("video"),i=this.attr("width"),n=this.attr("height");this.css("width",i+"px"),e.css("padding-bottom",+n/+i*100+"%"),s.setAttr("poster",this.attr("poster")||t.replace(/mp4$/,"jpg")),this.hasAttr("loop")&&(s._el.loop=!0),this.hasAttr("audio")||(s._el.muted=!0),le("source",{src:t,type:"video/mp4"},s),this.hasAttr("credit")&&(this.$(".credit").text=this.attr("credit"));const r=this.$(".bar"),o=this.$(".progress"),h=this.$(".buffer"),a=this.$(".timecode"),c=new Ae(this.$(".handle"),r,{moveY:!1}),l=this.video=s._el;let d=this.width-110;fe.onResize(()=>d=this.width-110),s.on("canplay",()=>{a.text=or(+l.duration)}),s.on("timeupdate",()=>{const t=l.currentTime/l.duration;o.css("width",100*t+"%"),a.text=or(+l.currentTime),c.setPosition(t*d,0),this.trigger("timeupdate",l.currentTime)}),s.on("progress",()=>{if(l.buffered.length<=0||l.duration<=0)return;const t=l.buffered.end(l.buffered.length-1)/l.duration*100;h.css("width",t+"%")}),s.on("ended",()=>{l.pause(),this.removeClass("playing"),this.trigger("end")});const u=()=>l.paused?this.play():this.pause(),p=t=>this.setTime(t/d*l.duration);this.hasAttr("hover")?(s.on("mouseover touchstart",()=>this.play()),s.on("mouseout touchend touchcancel",()=>this.pause())):s.on("click",u),this.hasAttr("controls")&&(this.$(".controls").show(),this.$(".play-pause-btn").on("click",u),c.on("start",()=>this.pause()),c.on("drag",t=>p(t.x)),r.on("click",t=>p(t.offsetX)))}setTime(t){this.video.currentTime=t}play(){this.video.play(),this.addClass("playing"),this.trigger("play")}pause(){this.video.pause(),this.removeClass("playing")}};hr=e([Oe("x-video",{templateId:"#video"})],hr);let ar=class extends qe{constructor(){super(...arguments),this.solved=!1,this.correctChoice=1}loadBody(t){return s(this,void 0,void 0,(function*(){const e=yield fetch(`/quiz/${t}?xhr=1`);this.html=yield e.text(),this.setUp()}))}setUp(){this.$choices=this.$$("button.choice");for(const[t,e]of this.$choices.entries())e.on("click",()=>this.solve(t))}solve(t){return s(this,void 0,void 0,(function*(){if(this.solved)return;this.solved=!0;const e=ot("",{cardId:this.$(".card-body").id,correct:t===this.correctChoice});for(const t of this.$choices)t.addClass("done");this.$choices[t].addClass("selected"),yield r(500),this.$choices[this.correctChoice].addClass("correct"),t!==this.correctChoice&&this.$choices[t].addClass("incorrect"),yield Promise.all([e,r(1500)]),this.trigger("solve")}))}};ar=e([Oe("x-quiz-card")],ar);let cr=class extends qe{ready(){this.cards=this.$$("x-quiz-card").reverse(),this.cardStack=this.$(".card-stack"),this.cards[0].setUp(),this.cards[0].on("solve",()=>this.nextCard())}nextCard(){return s(this,void 0,void 0,(function*(){const t=this.cards.shift();yield this.cards[0].loadBody(this.id),t.addClass("done"),setTimeout(()=>t.remove(),600);for(const[t,e]of this.cards.entries())e.removeClass("s1 s2 s3 s4"),t>0&&e.addClass("s"+t);this.cards[0].on("solve",()=>this.nextCard());const e=le("x-quiz-card",{class:"s4"});this.cardStack.prepend(e),this.cards.push(e)}))}};function lr(t,e){const s=e.positionLeft-t.positionLeft+e.width/2,i=e.positionTop-t.positionTop+e.height/2;return new ii(s,i)}function dr(t){return t?new ii(...t.split(",").map(t=>+t)):void 0}cr=e([Oe("x-quiz")],cr);let ur=class extends qe{constructor(){super(...arguments),this.doAnimation=!1}created(){this.slide=dr(this.attr("slide")),this.shift=dr(this.attr("offset"))}ready(){this.$target=ae(this.attr("target")),this.$target&&(this.$target.on("click pointerdown focus",()=>this.stop()),this.hasAttr("start")&&this.start())}setTarget(t,e,s){this.$target="string"==typeof t?ae(t):t,e&&(this.slide=e),s&&(this.slide=s)}start(t){this.doAnimation||!this.from&&!this.$target||(this.doAnimation=!0,t&&(this.slide=t),this.slide||this.$end?this.runSlideAnimation():this.runClickAnimation())}startSlide(t,e){this.$target=t,this.$end=e,this.start()}stop(){this.doAnimation=!1}runSlideAnimation(){return s(this,void 0,void 0,(function*(){this.show();let t=this.from||lr(this,this.$target);this.shift&&(t=t.add(this.shift));const e=this.slide?t.add(this.slide):lr(this,this.$end),s=`translate(${t.x-15}px,${t.y-10}px)`,i=`translate(${e.x-15}px,${e.y-10}px)`;yield this.animate({transform:[s+" scale(2)",s],opacity:[0,1]},300).promise,yield this.animate({transform:[s,i]},1e3).promise,yield this.animate({transform:[i,i+" scale(2)"],opacity:[1,0]},300).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runSlideAnimation()},1e3)}))}runClickAnimation(){return s(this,void 0,void 0,(function*(){this.show();let t=this.from||lr(this,this.$target);this.shift&&(t=t.add(this.shift));const e=`translate(${t.x-15}px,${t.y-10}px)`;yield this.animate({transform:[e+" scale(2)",e],opacity:[0,1]},500).promise,yield this.animate({transform:[e,e+" scale(2)"],opacity:[1,0]},500,200).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runClickAnimation()},1e3)}))}};ur=e([Oe("x-gesture",{templateId:"#gesture"})],ur);const pr=[5,2,1];function fr(t){return[Math.min(...t.map(t=>Math.min(...t.map(t=>t.y)))),Math.max(...t.map(t=>Math.max(...t.map(t=>t.y))))]}function gr(t,e,s){return t.hasAttr(e)?"no"!==t.attr(e):s}function mr(t,e,s){const i=t?t.split(","):[];if(3===i.length)return i.map(t=>+t);let n=i.length>0?+i[0]:s?s[0]:0,r=i.length>1?+i[1]:s?s[1]:e;if(Os(n,r))return[n-1,r+1,1];r+=.01*(r-n);const o=(r-n)/Math.floor(Math.abs(e)/80),h=Math.floor(Math.log10(o)),a=Math.pow(10,h),c=pr.find(t=>a*t<=o)*a;return r=c*Math.ceil(r/c),n=c*Math.floor(n/c),[n,r,c]}const vr={hasGeoModel:!0,pi:Math.PI,point:(t,e)=>void 0!==t&&void 0!==e?new ii(t,e):void 0,angle:(t,e,s)=>t&&e&&s?new hi(t,e,s):void 0,line:(t,e)=>t&&e&&!t.equals(e)?new ci(t,e):void 0,ray:(t,e)=>t&&e&&!t.equals(e)?new li(t,e):void 0,segment:(t,e)=>t&&e&&!t.equals(e)?new di(t,e):void 0,circle:(t,e)=>t&&e?new ui(t,e):void 0,arc:(t,e,s)=>t&&e&&s?new pi(t,e,s):void 0,sector:(t,e,s)=>t&&e&&s?new fi(t,e,s):void 0,polygon:(...t)=>t.every(t=>t)?new gi(...t):void 0,polyline:(...t)=>t.every(t=>t)?new mi(...t):void 0,triangle:(t,e,s)=>t&&e&&s?new vi(t,e,s):void 0,rectangle:(t,e,s)=>t?new wi(t,e,s):void 0,distance:ii.distance,round:(t,e=0)=>Gs(t,e),sqrt:Math.sqrt,floor:Math.floor,ceil:Math.ceil,intersections:Ci};function wr(t,e,s){let i=s,n=void 0;for(const s of t){const t=e(s);void 0!==t&&t<i&&(i=t,n=s)}return n}function yr(t,e){return xi(t)?ii.distance(t.p1,e)/t.length:$i(t)?new ci(t.c,e).angle/2/Math.PI:bi(t)?new hi(t.start,t.c,e).rad/t.angle:.5}function xr(t,e,s,i){return`translate(${t.x}px, ${t.y-e}px) scale(${i/100}) rotate(${s}rad)`}class $r extends qe{constructor(){super(...arguments),this.labelSuffix=["",""],this.gridSize=[1,1],this.showGrid=!1,this.showXAxis=!1,this.showYAxis=!1,this.showLabels=!1}setupCoordinates(t,e={}){this.$svg=t,t.addClass("canvas"),this.proportional=!!e.proportional,this.padding=function(t){const e=g(t).map(t=>+t);return 1===e.length?[e[0],e[0],e[0],e[0]]:2===e.length?[e[0],e[1],e[0],e[1]]:3===e.length?[e[0],e[1],e[2],e[1]]:e}(this.attr("padding")||e.padding||"0"),gr(this,"grid",e.showGrid||!1)&&(this.$grid=le("g",{class:"grid"}),t.prepend(this.$grid),this.showGrid=!0);const s=this.attr("axes")||(e.showAxes?"yes":"no");[this.showXAxis,this.showYAxis]=function(t){const e=t.split(",");return["no"!==e[0],"no"!==(e.length>1?e[1]:e[0])]}(s),(this.showXAxis||this.showYAxis)&&(le("defs",{html:'<marker id="axis-arrow" refX="3" refY="3" markerWidth="6"\n    markerHeight="6" orient="auto"><path d="M 0 0 L 6 3 L 0 6 z"/></marker>'},t),this.$axes=le("g",{class:"axes"}),t.prepend(this.$axes),this.axisNames=(this.attr("axis-names")||",").split(",")),this.$axes&&gr(this,"labels",!0)&&(this.labelSuffix=(this.attr("label-suffix")||",").split(","),this.showLabels=!0),(this.showLabels||this.axisNames)&&(this.$labels=le("g",{class:"labels"},t)),this.resize()}resize(){this.css("max-width","none");const t=+this.attr("width")||this.width,e=+this.attr("height")||(this.hasAttr("width")?t:this.height);this.css("max-width",t+"px"),this.$svg.setAttr("width",t),this.$svg.setAttr("height",e),this.$svg.setAttr("viewBox",`0 0 ${t} ${e}`);const s=this.padding;this.viewportBounds=new ri(s[3],t-s[1],s[0],e-s[2]),this.updatePlotBounds(),this.positionElements(t,e)}updatePlotBounds(t){const[e,s,i]=mr(this.attr("x-axis"),this.viewportBounds.dx,null==t?void 0:t.xRange),[n,r,o]=mr(this.attr("y-axis"),this.viewportBounds.dy,null==t?void 0:t.yRange),h=Math.abs(this.viewportBounds.dx/(s-e)),a=Math.abs(this.viewportBounds.dy/(r-n)),c=Math.min(h,a),l=this.proportional?h/c:1,d=this.proportional?a/c:1;this.plotBounds=new ri(l*e,l*s,d*r,d*n),this.plotScale=this.proportional?c:(h+a)/2,this.gridSize=[i,o];const[u,p]=[this.plotBounds,this.viewportBounds];this.plotToViewportMatrix=[[p.dx/u.dx,0,p.xMin-u.xMin/u.dx*p.dx],[0,p.dy/u.dy,p.yMin-u.yMin/u.dy*p.dy]];const f=e>0?l*e:s<0?l*s:0,g=n>0?d*n:r<0?d*r:0;this.plotOrigin=new ii(f,g),this.drawAxes()}drawAxes(){const[t,e]=[this.plotBounds,this.viewportBounds],s=this.toViewportCoords(this.plotOrigin),[i,n]=this.gridSize;if(this.$grid&&this.$grid.removeChildren(),this.$axes&&this.$axes.removeChildren(),this.$labels&&this.$labels.removeChildren(),this.showGrid||this.showXAxis){for(let n=i*Math.trunc(t.xMin/i+.01);n<t.xMax;n+=i){if(this.showYAxis&&n===this.plotOrigin.x)continue;const t=this.toViewportCoords(new ii(n,0)).x;this.showGrid&&le("line",{x1:t,y1:e.yMin,x2:t,y2:e.yMax},this.$grid),this.showLabels&&this.makeLabel(0,n,t,s)}}if(this.showGrid||this.showYAxis){const[i,r]=t.yMin<t.yMax?[t.yMin,t.yMax]:[t.yMax,t.yMin];for(let t=n*Math.trunc(i/n+.01);t<r;t+=n){if(this.showXAxis&&t===this.plotOrigin.y)continue;const i=this.toViewportCoords(new ii(0,t)).y;this.showGrid&&le("line",{x1:e.xMin,y1:i,x2:e.xMax,y2:i},this.$grid),this.showLabels&&this.makeLabel(1,t,i,s)}}this.showXAxis&&(this.$xAxis=le("line",{x1:e.xMin,x2:e.xMax,y1:s.y,y2:s.y},this.$axes)),this.showYAxis&&(this.$yAxis=le("line",{x1:s.x,x2:s.x,y1:e.yMax,y2:e.yMin},this.$axes)),this.showLabels&&this.showXAxis&&this.showYAxis&&(0!==t.xMin||0!==t.yMax||this.labelSuffix[0]||this.labelSuffix[1]?t.yMax===this.plotOrigin.y?this.makeLabel(0,this.plotOrigin.x,s.x,s):this.makeLabel(1,this.plotOrigin.y,s.y,s):le("text",{text:0,x:s.x-5,y:s.y+15,"text-anchor":"end"},this.$labels)),this.axisNames&&(this.axisNames[0]&&le("text",{text:this.axisNames[0],x:this.viewportBounds.xMax-2,y:s.y-12,"text-anchor":"end"},this.$labels),this.axisNames[1]&&le("text",{text:this.axisNames[1],x:s.x+10,y:this.viewportBounds.yMin+5},this.$labels))}makeLabel(t,e,s,i){const n=this.labelSuffix[t];le("text",{text:"i"===n?new si(0,e).toString():Vs(e,4)+n,x:t?i.x-8:s,y:t?s+4:i.y+18,"text-anchor":t?"end":"middle"},this.$labels),le("line",{class:"tick",x1:t?i.x:s,y1:t?s:i.y,x2:t?i.x-4:s,y2:t?s:i.y+4},this.$axes)}positionElements(t,e){for(const s of this.$$("[data-bounds]")){const i=s.data.bounds.split(","),n=this.toViewportCoords(new ii(+i[3],+i[0])),r=this.toViewportCoords(new ii(+i[1],+i[2]));s.css({left:n.x/t*100+"%",top:n.y/e*100+"%",width:(r.x-n.x)/t*100+"%",height:(r.y-n.y)/e*100+"%"})}}toPlotCoords(t){return t.changeCoordinates(this.viewportBounds,this.plotBounds)}toViewportCoords(t){return t.transform(this.plotToViewportMatrix)}}let br=class extends $r{constructor(){super(...arguments),this.steps=400}ready(){const t=le("svg",{},this),e=le("g",{class:"plot"},t);this.$path=le("path",{},e),this.setupCoordinates(t,{showGrid:!0,showAxes:!0,padding:"20"}),this.clear();const s=this.viewportBounds,i=this.steps/s.dx;let n=void 0;Et(t,{start:()=>n=void 0,move:t=>{const e=Ys(Math.round((t.x-s.xMin)*i),0,this.steps-1);this.points[e]=this.toPlotCoords(new ii(s.xMin+e/i,t.y)),n&&this.interpolate(n,e),n=e,this.redraw()},end:()=>this.snap()})}interpolate(t,e){e<t&&([t,e]=[e,t]);const s=this.points[t],i=this.points[e];for(let n=t+1;n<e;++n)this.points[n]=ii.interpolate(s,i,(n-t)/(e-t))}redraw(){let t="",e=!0;for(const s of this.points){if(s){const i=this.toViewportCoords(s);t+=(e?"M":"L")+`${i.x},${i.y}`}e=!s}this.$path.setAttr("d",t)}snap(){const t=this.points.filter(t=>t).map(t=>[t.x,t.y]),e=ji.bestPolynomial(t);if(e){for(let t=0;t<this.steps;++t){if(!this.points[t])continue;const s=this.plotBounds.xMin+t/this.steps*this.plotBounds.dx;this.points[t]=new ii(s,e.fn(s))}this.redraw(),this.trigger("snap",{regression:e})}}clear(){this.points=a(void 0,this.steps),this.$path.setAttr("d","")}};br=e([Oe("x-coordinate-sketch")],br);let Mr=class extends $r{constructor(){super(...arguments),this.isAnimated=this.hasAttr("animate"),this.crosshairGrid=10,this.getCrosshairPosn=t=>t}ready(){const t=le("svg",{},this);if(this.$plot=le("g",{class:"plot"},t),this.$overlay=le("g",{class:"overlay"},t),this.setupCoordinates(t,{showGrid:!0,showAxes:!0,padding:"20"}),this.hasAttr("fn")){const t=_s.parse(this.attr("fn"),!0);this.setFunctions(e=>t.evaluate({x:e}))}gr(this,"crosshairs",!0)&&(this.crosshairGrid=+this.attr("crosshair-grid")||10,this.setupCrosshairs(t))}setPoints(t,e=1){const s=t.map((t,s)=>new ii(s+e,t));this.setSeries(s)}setSeries(...t){const e=Math.max(...t.map(t=>d(t).x)),[s,i]=fr(t);this.updatePlotBounds(new ri(0,e,s,i)),this.$plot.removeChildren();for(const e of t)this.drawLinePlot(e);this.getCrosshairPosn=e=>t[0].reduce((t,s)=>Math.abs(s.x-e.x)<=Math.abs(t.x-e.x)?s:t)}setFunctions(...t){const[e,s]=[this.plotBounds,this.viewportBounds],i=t.map(t=>{const e=[];for(let i=s.xMin;i<s.xMax;i+=2){const s=this.toPlotCoords(new ii(i,0)).x;e.push(new ii(s,t(s)))}return e}),[n,r]=fr(i);this.updatePlotBounds(new ri(e.xMin,e.xMax,n,r)),this.$plot.removeChildren();for(const t of i)this.drawLinePlot(t);const o=this.gridSize[0]/this.crosshairGrid;this.getCrosshairPosn=s=>{const i=Xs(Ys(s.x,e.xMin,e.xMax),o);return new ii(i,t[0](i))}}drawLinePlot(t){const e=le("g",{},this.$plot),s=le("path",{},e),i=this.plotBounds,n=(t=t.filter(t=>t.y>=i.yMax&&t.y<=i.yMin)).map(t=>this.toViewportCoords(t));this.isAnimated?xe(e=>{const r=t.findIndex(t=>t.x>i.xMin+e*i.dx);s.points=n.slice(0,r)},5e3):s.points=n}drawPoints(t){const e=le("g",{},this.$plot),s=this.plotBounds;for(const i of t){const t=this.toViewportCoords(i),n=le("circle",{r:4,cx:t.x,cy:t.y},e);if(this.isAnimated){n.hide();const t=5e3*(i.x-s.xMin)/(s.xMax-s.xMin);setTimeout(()=>n.show(),t)}}}setupCrosshairs(t){const e=le("g",{class:"crosshair"},t),s=le("path",{},e),i=le("circle",{r:4},e),n=le("text",{},e);let r=0;const o=t=>{const e=this.getCrosshairPosn(this.toPlotCoords(t));if(Os(e.x,r))return;r=e.x;const o=this.toViewportCoords(e),h=this.toViewportCoords(this.plotOrigin);i.setCenter(o),s.points=[new ii(h.x,o.y),o,new ii(o.x,h.y)],n.text=`(${Vs(e.x,5,!1)}, ${Vs(e.y,5,!1)})`;const a=n.width,c=o.x+8+a<this.viewportBounds.dx;n.setAttr("x",c?o.x+5:o.x-a-5),n.setAttr("y",o.y>20?o.y-7:o.y+18)};!function(t,e){let s=Tt;"svg"===t.type?s=e=>St(e,t.$ownerSVG):"canvas"===t.type&&(s=e=>_t(e,t));let i=!1;t.on("touchstart mouseenter",t=>{!i&&e.enter&&e.enter(),e.move&&e.move(s(t)),i=!0},{passive:!0}),t.on("pointermove",t=>{i&&e.move&&e.move(s(t))}),t.on("touchend mouseleave",()=>{i&&e.exit&&e.exit(),i=!1},{passive:!0})}(t,{enter:()=>e.show(),move:t=>o(t),exit:()=>e.hide()})}};Mr=e([Oe("x-coordinate-system")],Mr);class Cr{constructor(t,e){this.$canvas=t,this.defaultCallbacks=e,this.callbacks=new WeakMap,this.isMoving=!1,this.shiftKey=!1,setTimeout(()=>{document.addEventListener("keydown",t=>this.shiftKey=t.shiftKey),document.addEventListener("keyup",t=>this.shiftKey=t.shiftKey)},2e3),t.css("touch-action","none"),t.on("pointerdown",t=>this.startEvent(t)),t.on("contextmenu",t=>t.preventDefault()),e.hover&&t.on("pointermove",s=>{this.isMoving||e.hover({posn:St(s,t),event:s})})}listen(t,e){this.callbacks.set(t._el,e),t.hasParent(this.$canvas)||(t.css("touch-action","none"),t.on("pointerdown",t=>this.startEvent(t)))}startEvent(t){if(t.handled)return;this.isMoving=!0,t.preventDefault();const e=fe.getActiveInput();e&&e.blur();const s=t.pointerId,i=this.getCallbacks(t.target),n=St(t,this.$canvas);let r=n,o=!1;const h=t=>{if(t.pointerId&&t.pointerId!==s)return;t.preventDefault();const e=St(t,this.$canvas);ii.distance(e,r)<.5||(!o&&i.start&&i.start({posn:n,event:t}),i.move&&i.move({posn:e,startPosn:n,lastPosn:r,event:t}),o||ue.addClass("grabbing"),r=e,o=!0)},a=t=>{t.pointerId&&t.pointerId!==s||(t.preventDefault(),de.off("pointermove",h),de.off("pointerstop",a),o&&i.end&&i.end({posn:r,event:t}),!o&&i.click&&i.click({posn:n,event:t}),ue.removeClass("grabbing"),this.isMoving=!1)};i.down&&i.down({posn:n,event:t}),de.on("pointermove",h),de.on("pointerstop",a)}getCallbacks(t){for(;t;){if(this.callbacks.has(t))return this.callbacks.get(t);t=t.parentNode||void 0}return this.defaultCallbacks}}function kr(t,e,s){const i=e.map(e=>function(t,e){if("string"==typeof t){const s=Mt(t);return t=>{var i;return null===(i=s(e))||void 0===i?void 0:i.equals(t)}}return"function"==typeof t?t:e=>t.equals(e)}(e,t.model)),n=a(void 0,e.length),r=o();let h=[];const c=({point:t})=>h.push(t),l=s.maxErrors||4;let d=0;const u=({path:t})=>{s.onBegin&&s.onBegin(t)},p=()=>{n.every(t=>t)&&(s.onComplete&&s.onComplete(!0),t.off("add:path",f),t.off("begin:path",u),t.off("add:point",c),r.resolve(n))},f=({path:r})=>{const o=r.value;if(o){for(const[t,e]of i.entries())if(!n[t]&&e(o))return n[t]=r,s.onCorrect&&s.onCorrect(r,t),d=0,h=[],p();r.delete();for(const t of h)t.delete();if(h=[],!(xi(o)&&o.length<1))if(d+=1,d>=l){const i=n.findIndex(t=>!t),r=e[i];if("function"!=typeof r){const e=t.drawPath(r,{animated:1e3});n[i]=e,s.onHint&&s.onHint(e,i),d=0,p()}}else s.onIncorrect&&s.onIncorrect(r)}};return t.on("begin:path",u),t.on("add:path",f),t.on("add:point",c),r.promise}function Pr(t,e){const s=[];for(const i of e.paths)i!==t&&i.value&&s.push(i.value.transform(e.plotToViewportMatrix));return s}const Ar=new ui(new ii(0,-9),12);function Tr(t,e,s){for(const t of s)if(e.every(e=>!Ci(Ar.translate(t),e).length))return t;return s[0]}class Sr{constructor(t,e,s,i){this.$parent=t,this.$el=s,this.color="",this.label="",this.isPending=!1,this.isLocked=!1,this.components=[],this.dependencies=[],this.fixedLabel=!1,this.name=i||t.model.getKey(),t.shapes.set(this.name,this),t.model.watch(e=>{const s=e[this.name];this.$el.css("display",s?"block":"none"),this.$label&&this.$label.css("display",s?"block":"none"),s&&this.redraw(s),t.queueLabelPositioning()}),this.color=s.css("color")||"",this.setValue(e),s.hasAttr("label")&&this.setLabel(s.attr("label"))}get value(){return this.$parent.model[this.name]}get type(){var t;return null===(t=this.value)||void 0===t?void 0:t.type}get locked(){return this.isLocked}get isHidden(){return this.isPending||this.$el.hasAttr("hidden")||this.$el.hasClass("transparent")}setValue(t){t instanceof Function?this.$parent.model.setComputed(this.name,t):this.$parent.model[this.name]=t}setLabel(t,e,s){this.$label||(this.$label=function(t,e){return le("text",{target:t.attr("target")||void 0,class:t.attr("label-class")||t.attr("class")||void 0,"data-when":t.data.when,style:e?"color: "+e:void 0,"text-anchor":"middle"})}(this.$el,e),this.$parent.$objLabels.append(this.$label));const i=kt(t);if(this.$parent.model.watch(t=>this.$label.text=i(t)||""),this.fixedLabel=!!s,s){const t=Mt(s);this.$parent.model.watch(e=>{this.$label.setTransform(t(e).shift(0,5))})}this.updateLabelPosition()}setColor(t){this.color=t,this.$el.css("color",t);for(const e of this.dependencies)e.setColor(t);this.$label&&this.$label.css("color",t)}updateLabelPosition(){if(!this.$label||!this.value||this.fixedLabel)return;const[t,e]=function(t,e){const s=t.value.transform(e.plotToViewportMatrix),i=t.$el;if(xi(s)){let n=s.perpendicularVector,r=s.angle;n.y>=0&&(n=n.scale(-1),r+=Math.PI);const o=[];for(const t of[.5,.35,.65])for(const e of[-15,5])o.push(s.at(t).add(n.scale(e)));if(!e.labelPositioning)return[o[0],r];let h=Tr(0,Pr(t,e),o);return i.hasAttr("mark")&&(h=h.add(s.unitVector.scale(12))),[h,r]}if(bi(s)){const t=new ci(s.start,s.end),e=t.perpendicularVector.y>=0,i=t.angle+(e?Math.PI:0);return[s.at(.5).add(t.perpendicularVector.scale(e?14:5)),i]}if(function(t){return"angle"===t.type}(s)){const t=(+i.attr("size")||Wt(s,{round:i.hasAttr("round")}))+8;return[s.b.add(s.bisector.unitVector.scale(t+5)).shift(0,3)]}if(function(t){return"point"===t.type}(s)){const n=i.hasClass("move")?10:8,r=[s.shift(n,-n),s.shift(-n,-n),s.shift(n,10+n),s.shift(-n,10+n)];return e.labelPositioning?[Tr(0,Pr(t,e),r)]:[r[0]]}return yi(s)?[s.centroid.shift(0,5)]:function(t){return"sector"===t.type}(s)?[s.at(.5).subtract(s.c).scale(.6).add(s.c).shift(0,5)]:$i(s)?[s.c.shift(0,5)]:[]}(this,this.$parent);this.$label.setTransform(t,e)}select(){this.$el.addClass("selected"),this.$el.parent.append(this.$el);for(const t of this.dependencies)t.select()}deselect(){this.$el.removeClass("selected");for(const t of this.dependencies)t.deselect()}hover(t=!1){if(!t){if(this.$parent.hovering===this)return;this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.hovering=this}this.$el.addClass("hover");for(const t of this.dependencies)t.hover(!0)}unhover(t=!1){if(!t){if(this.$parent.hovering!==this)return;this.$parent.hovering=void 0}this.$el.removeClass("hover");for(const t of this.dependencies)t.unhover(!0)}delete(t=300){return s(this,void 0,void 0,(function*(){this.$parent.shapes.delete(this.name);for(const t of this.components)t.deselect();this.$label&&this.$label.exit("fade",t,0,!0),yield this.removeElement(t),this.$parent.model[this.name]=void 0}))}}class _r extends Sr{constructor(t,e,s,i,n=!1){i||(i=le("circle",{})),super(t,e,i,s),this.$parent.hidePoints||t.$points.append(this.$el),t.points.add(this),this.projectionId=t.model.getKey(),this.projectionOffset=void 0,t.model.watch(t=>{this.projection=t[this.projectionId],this.projection&&(void 0===this.projectionOffset&&(this.projectionOffset=yr(this.projection,this.$parent.model[this.name])),this.$parent.model[this.name]=this.projection.at(this.projectionOffset))}),this.lock(n)}setValue(t){t instanceof Function?(this.project(void 0),this.$parent.model.setComputed(this.name,t)):(t&&this.projection&&(t=this.projection.project(t),this.projectionOffset=yr(this.projection,t)),this.$parent.model[this.name]=t)}redraw(t){const e=t.transform(this.$parent.plotToViewportMatrix);this.$el.setCenter(e),this.$halo&&this.$halo.setCenter(e),this.$pulse&&this.$pulse.setCenter(e)}removeElement(t){return s(this,void 0,void 0,(function*(){this.$parent.points.delete(this),yield this.$el.exit("pop",t,0,!0).promise}))}distance(t){return this.value?ii.distance(t,this.value):1/0}lock(t=!0){this.isLocked=t,this.$el.setClass("move",!t),t?this.$el.removeAttr("tabindex"):this.$el.setAttr("tabindex",0)}project(t){if(this.projectionOffset=void 0,"string"==typeof t){const e=Mt(t);this.$parent.model.setComputed(this.projectionId,e)}else t?this.$parent.model.setComputed(this.projectionId,()=>t.value):this.$parent.model[this.projectionId]=void 0}makeIntersection({path1:t,path2:e,index:s}){this.setValue(i=>{if(!i[t.name]||!i[e.name])return;const n=Ci(i[t.name],i[e.name]);return n[Math.min(s,n.length-1)]}),this.lock()}addHalo(){this.$halo=le("circle",{class:"halo",r:18},this.$parent.$pulses),this.$halo.setCenter(this.$el.center),this.$halo.enter("pop")}removeHalo(){return s(this,void 0,void 0,(function*(){this.$halo&&(this.$halo.exit("pop",500,0,!0),this.$halo=void 0)}))}pulsate(){this.$pulse=le("circle",{class:"pulse",r:8},this.$parent.$pulses),this.$pulse.setCenter(this.$el.center),this.$el.one("mouseover pointerdown focus",()=>{this.$pulse&&this.$pulse.remove(),this.$pulse=void 0})}}class Ir extends Sr{constructor(t,e,s,i){super(t,e,i||le("path"),s),t.$paths.append(this.$el),t.paths.add(this)}get locked(){return this.isLocked||!this.components.length||this.components.every(t=>t.locked)}redraw(t){const e=t.transform(this.$parent.plotToViewportMatrix);this.$el.draw(e,{box:this.$parent.boundsRect})}distance(t){return this.value?ii.distance(t,this.value.project(t)):1/0}removeElement(t){return s(this,void 0,void 0,(function*(){this.$parent.paths.delete(this),yield this.$el.exit("draw",t,0,!0).promise}))}setComponents(t,e){this.components=this.dependencies=t,this.setValue(()=>{const s=t.map(t=>t.value);if(!s.some(t=>void 0===t))return e(...s)})}}class Er extends Sr{constructor(t,e,s,i){super(t,e,le("path",{},t.$polygons)),t.polygons.add(this),this.components=s,this.dependencies=[...s,...i]}get locked(){return this.isLocked||!this.components.length||this.components.every(t=>t.locked)}redraw(t){const e=t.transform(this.$parent.plotToViewportMatrix);this.$el.draw(e,{box:this.$parent.boundsRect})}removeElement(t){return s(this,void 0,void 0,(function*(){this.$parent.polygons.delete(this),yield this.$el.exit("fade",t,0,!0).promise}))}distance(){return 1/0}}class Lr{constructor(t){this.$parent=t}enable(){}down(t){}start(t){}move(t,e){}end(t){}hover(t){}click(t){}cancel(){}snapToGrid(t){return this.$parent.snapToGrid?t.round(this.$parent.snapToGrid):t}snapToPoint(t,e){return this.snapPoint=this.$parent.getPointAt(e),this.snapPoint?(t.$el.setClass("move",!this.snapPoint.locked),t.setValue(this.snapPoint.value)):(this.snapIntersect=this.$parent.getIntersectionAt(e),this.snapIntersect?(t.$el.removeClass("move"),t.setValue(this.snapIntersect.posn)):!this.$parent.snapToGrid&&(this.snapPath=this.$parent.getPathAt(e),this.snapPath)?t.setValue(this.snapPath.value.project(e)):(t.$el.addClass("move"),void t.setValue(this.snapToGrid(e))))}getOrMakePointAt(t){let e=this.$parent.getPointAt(t);if(!e){e=new _r(this.$parent,this.snapToGrid(t));const s=this.$parent.getIntersectionAt(t);if(s)e.makeIntersection(s);else if(!this.$parent.snapToGrid){const s=this.$parent.getPathAt(t);s&&e.project(s)}this.$parent.trigger("add:point",{point:e})}return e}showPendingPointAt(t){var e,s,i;const n=(null===(e=this.$parent.getIntersectionAt(t))||void 0===e?void 0:e.posn)||(null===(i=null===(s=this.$parent.getPathAt(t))||void 0===s?void 0:s.value)||void 0===i?void 0:i.project(t)),r=!!n;if(this.$parent.$pendingPoint.toggle(r),r){const e=this.$parent.toViewportCoords(n||t);this.$parent.$pendingPoint.setCenter(e)}}}class qr extends Lr{constructor(){super(...arguments),this.isMoving=!1}enable(){}down(t){this.obj=this.$parent.getPointAt(t)||this.$parent.getPathAt(t)||this.$parent.getPolygonAt(t),this.obj||this.$parent.deselect();const e=this.$parent.selection;e!==this.obj&&(e&&e.components.includes(this.obj)||this.$parent.select(this.obj))}start(){this.obj&&(this.isMoving=!0,this.obj.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("move",{obj:this.obj}))}move(t,e){if(this.obj&&!this.obj.locked&&!this.$parent.locked)if(this.obj instanceof Ir||this.obj instanceof Er){const s=t.subtract(e);for(const t of this.obj.components)t.locked||t.setValue(t.value.add(s))}else this.obj instanceof _r&&this.obj.setValue(this.snapToGrid(t))}end(){this.obj&&(this.isMoving=!1,this.obj.isPending=!1,this.snapPoint||(this.snapIntersect?this.obj.makeIntersection(this.snapIntersect):this.snapPath&&this.obj.project(this.snapPath)),this.$parent.trigger("moveEnd",{path:this.obj}),this.obj=void 0,this.$parent.updateIntersections())}hover(t){if(this.isMoving)return;const e=this.$parent.getPointAt(t)||this.$parent.getPathAt(t)||this.$parent.getPolygonAt(t),s=e&&!this.$parent.locked&&!e.locked,i=e&&this.$parent.canSelect;this.$parent.setCursor(s?"grab":i?"pointer":"default"),s||i?e.hover():this.$parent.hovering&&this.$parent.hovering.unhover()}}class Or extends qr{down(t){this.$parent.deselect(),this.obj=this.getOrMakePointAt(t),this.$parent.select(this.obj)}hover(t){const e=this.$parent.getPointAt(t);if(e)return this.$parent.setCursor(this.$parent.locked||e.locked?"default":"grab"),this.$parent.$pendingPoint.hide(),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}}class Rr extends Lr{enable(){this.$parent.setCursor("crosshair")}down(t){this.$parent.deselect(),this.startPoint=this.getOrMakePointAt(t)}start(t){this.startPoint&&(this.$parent.$pendingPoint.hide(),this.endPoint=new _r(this.$parent,t),this.endPoint.isPending=!0,this.endPoint.$el.addClass("pending"),this.path=new Ir(this.$parent,void 0),this.path.setComponents([this.startPoint,this.endPoint],this.expr),this.path.isPending=!0,this.$parent.updateIntersections(),this.$parent.trigger("begin:path",{path:this.path,start:this.startPoint}))}move(t){if(!this.startPoint||!this.path||!this.endPoint)return;if(ii.distance(t,this.startPoint.value)<20/this.$parent.plotScale)return this.endPoint.setValue(this.snapToGrid(t));this.snapToPoint(this.endPoint,t)}end(){this.startPoint&&this.path&&this.endPoint&&(this.path.isPending=!1,this.endPoint.isPending=!1,this.startPoint.value.equals(this.endPoint.value)?(this.endPoint.delete(),this.path.delete(),this.path=this.endPoint=void 0):this.snapPoint?(this.path.setComponents([this.startPoint,this.snapPoint],this.expr),this.endPoint.delete(),this.endPoint=void 0):this.snapIntersect?this.endPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.endPoint.project(this.snapPath),this.endPoint&&(this.$parent.trigger("add:point",{point:this.endPoint}),this.endPoint.$el.removeClass("pending")),this.path&&(this.$parent.trigger("add:path",{path:this.path}),this.$parent.updateIntersections(),this.$parent.updateInferredPolygons(this.path)),this.startPoint=this.endPoint=this.path=void 0)}hover(t){const e=this.$parent.getPointAt(t);if(e)return this.$parent.$pendingPoint.hide(),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.showPendingPointAt(t)}cancel(){this.endPoint&&this.endPoint.delete(),this.path&&this.path.delete(),this.$parent.$pendingPoint.hide(),this.startPoint=this.endPoint=this.path=void 0}}class Nr extends Rr{expr(t,e){return new di(t,e)}}class jr extends Rr{expr(t,e){return new ui(t,ii.distance(t,e))}}class Vr extends Rr{expr(t,e){return new wi(t,e.x-t.x,e.y-t.y)}}class Br extends Rr{expr(t,e){return new di(t,e).perpendicularBisector}}const Dr=(t,e,s)=>new hi(t,e,s).bisector;class zr extends Lr{enable(){}down(t){if(this.$parent.deselect(),this.firstPoint)if(this.secondPoint)this.path.isPending=this.thirdPoint.isPending=!1,this.thirdPoint.$el.removeClass("pending"),this.firstPoint.removeHalo(),this.secondPoint.removeHalo(),this.snapPoint?(this.path.setComponents([this.firstPoint,this.secondPoint,this.snapPoint],Dr),this.thirdPoint.delete(),this.thirdPoint=void 0):this.snapIntersect?this.thirdPoint.makeIntersection(this.snapIntersect):this.snapPath&&this.thirdPoint.project(this.snapPath),this.thirdPoint&&this.$parent.trigger("add:point",{path:this.thirdPoint}),this.$parent.trigger("add:path",{path:this.path}),this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0,this.$parent.updateIntersections();else{if(this.secondPoint=this.getOrMakePointAt(t),!this.secondPoint)return;this.secondPoint.addHalo(),this.thirdPoint=new _r(this.$parent,this.secondPoint.value),this.thirdPoint.$el.addClass("pending"),this.path=new Ir(this.$parent,void 0),this.path.setComponents([this.firstPoint,this.secondPoint,this.thirdPoint],Dr),this.path.isPending=this.thirdPoint.isPending=!0}else this.firstPoint=this.getOrMakePointAt(t),this.firstPoint&&this.firstPoint.addHalo()}hover(t){if(this.$parent.$pendingPoint.hide(),this.thirdPoint)return this.snapToPoint(this.thirdPoint,t),void this.$parent.setCursor(this.snapPoint?"pointer":"crosshair");const e=this.$parent.getPointAt(t);if(e)return this.$parent.setCursor("pointer"),e.hover();this.$parent.hovering&&this.$parent.hovering.unhover(),this.$parent.setCursor("crosshair"),this.showPendingPointAt(t)}cancel(){this.firstPoint&&this.firstPoint.removeHalo(),this.secondPoint&&this.secondPoint.removeHalo(),this.thirdPoint&&this.thirdPoint.delete(),this.path&&this.path.delete(),this.firstPoint=this.secondPoint=this.thirdPoint=this.path=void 0}}let Hr=class extends $r{constructor(){super(...arguments),this.shapes=new Map,this.points=new Set,this.paths=new Set,this.polygons=new Set,this.intersections=new Set,this.snapToGrid=0,this.locked=!1,this.hidePoints=!1,this.canSelect=!1,this.canIntersect=!1,this.canProject=!0,this.inferPolygons=!1,this.labelPositioning=!1,this.cursor="default"}ready(){const t=this.children.filter(t=>"SVG"===t.tagName)[0];if(!this.hasAttr("x-axis")&&!this.hasAttr("y-axis")){const t=+this.attr("grid"),e=+this.attr("width")||this.width,s=+this.attr("height")||e;this.setAttr("x-axis",t?`-0.5,${e/t-.5},1`:`0,${e},1`),this.setAttr("y-axis",t?s/t-.5+",-0.5,1":s+",0,1"),t&&this.setAttr("snap",1)}this.setupCoordinates(t,{proportional:!0}),this.boundsRect=this.viewportBounds.rect,this.model=this.getParentModel()||Te({}),this.model.hasGeoModel||this.model.assign(vr),this.$polygons=le("g",{class:"polygons"},t),this.$paths=le("g",{class:"paths"},t),this.$pulses=le("g",{class:"pulses"},t),this.$points=le("g",{class:"points"},t),this.$objLabels=le("g",{class:"labels"},t),this.snapToGrid=this.hasAttr("snap")?+this.attr("snap")||1:0,this.hidePoints=this.hasAttr("no-points"),this.canIntersect=gr(this,"intersections",!1),this.canProject=gr(this,"projections",!0),this.canSelect=gr(this,"selectable",!1),this.inferPolygons=gr(this,"infer-polygons",!1),this.labelPositioning=gr(this,"label-positioning",!0),this.hasClass("sticky")&&this.css("top",`calc(50vh - ${this.height/2}px)`),this.queueLabelPositioning=h(()=>{for(const t of this.shapes.values())t.updateLabelPosition()},0,!0);const e=t.$$("path[x], path[\\:d], circle");for(const t of e){const e=t.hasAttr("x")?Mt(t.attr("x")):void 0,s=t.attr("name");if(t.hasAttr(":d"))this.$paths.append(t),t.bindModel(this.model);else if("PATH"===t.tagName)this.$paths.append(t),new Ir(this,e,s,t);else{this.$points.append(t);const i=!t.hasClass("move"),n=e||t.center,r=new _r(this,n,s,t,i);t.hasAttr("project")&&r.project(t.attr("project")),t.hasClass("pulsate")&&r.pulsate()}}this.$pendingPoint=le("circle",{class:"pending"},this.$points),this.$pendingPoint.hide(),this.updateIntersections();const s={move:new qr(this),point:new Or(this),line:new Nr(this),circle:new jr(this),perpBisector:new Br(this),angleBisector:new zr(this),rectangle:new Vr(this)};this.$tools=this.$(".tools");let i=s[this.$tools.$active.data.tool];i.enable();const n=()=>this.toolOverride||i;this.$tools.on("change",t=>{n().cancel(),this.toolOverride=void 0,i=s[t.data.tool],this.hovering&&this.hovering.unhover(),this.$pendingPoint.hide(),this.hovering=void 0,this.deselect(),i.enable()});const r=(t,e=!1)=>this.toPlotCoords(e?t.clamp(this.viewportBounds,8):t);new Cr(t,{down:t=>n().down(r(t.posn)),start:t=>n().start(r(t.posn)),move:t=>n().move(r(t.posn,!0),r(t.lastPosn,!0)),end:t=>n().end(r(t.posn,!0)),click:t=>n().click(r(t.posn)),hover:t=>n().hover(r(t.posn))}),fe.onKey("escape",()=>n().cancel()),fe.onKey("backspace delete",()=>this.delete()),document.addEventListener("keydown",t=>{if([37,38,39,40].indexOf(t.keyCode)<0)return;const e=fe.getActiveInput();if(e&&e.hasParent(this)){t.preventDefault();for(const s of this.points){if(s.$el!==e||!s.value)continue;const i=15/this.plotScale,n=this.plotBounds.yMin>this.plotBounds.yMax?-1:1,r=37===t.keyCode?-i:39===t.keyCode?i:0,o=38===t.keyCode?-n*i:40===t.keyCode?n*i:0;return void s.setValue(s.value.shift(r,o))}}})}switchTool(t){this.$tools.makeActive(this.$(`.tool[data-tool="${t}"]`))}setCursor(t="default"){t!==this.cursor&&(this.cursor=t,this.$svg.css("cursor",t))}select(t){this.canSelect&&(this.deselect(),t&&(this.selection=t,t.select()),this.trigger("select",{shape:t}))}deselect(){this.selection&&(this.selection.deselect(),this.selection=void 0,this.trigger("select",{shape:void 0}))}delete(){this.hovering&&this.hovering.unhover(),this.selection&&this.selection.delete(),this.trigger("select",{shape:void 0})}redraw(){this.resize(),this.boundsRect=this.viewportBounds.rect,this.model.forceUpdate()}getPointAt(t,e=20){if(this.hidePoints)return;return wr(this.points,e=>e.isHidden?void 0:e.distance(t),e/this.plotScale)}getPathAt(t,e=10){if(this.hidePoints||!this.canProject)return;return wr(this.paths,e=>e.isHidden?void 0:e.distance(t),e/this.plotScale)}getIntersectionAt(t,e=20){if(!this.canIntersect)return;return wr(this.intersections,e=>ii.distance(t,e.posn),e/this.plotScale)}getPolygonAt(t){if(this.inferPolygons)for(const e of this.polygons)if(e.value&&e.value.contains(t))return e}updateIntersections(){this.canIntersect&&!this.hidePoints&&function(t,e){e.clear();for(const s of t)if(!s.isHidden&&s.value)for(const i of t){if(s.isHidden||!i.value||s===i)continue;const t=Ci(s.value,i.value);for(const[n,r]of t.entries())e.add({path1:s,path2:i,posn:r,index:n})}}(this.paths,this.intersections)}updateInferredPolygons(t){if(!this.inferPolygons)return;const e=function(t,e,s){const i=Array.from(e),n=s.components[0],r=[{points:[n,s.components[1]],paths:[s]}],o=[];for(;r.length;){const t=r.shift(),e=d(t.points),s=d(t.paths),h=i.filter(t=>t!==s&&t.components.includes(e));for(const s of h){const i=s.components.find(t=>t!==e),h=[...t.paths,s];if(i===n)o.push({points:t.points.slice(0),paths:h});else if(i&&!t.points.includes(i)){const e=[...t.points,i];r.push({points:e,paths:h})}}}return o}(this.shapes,this.paths,t);for(const{points:t,paths:s}of e)new Er(this,()=>{const e=t.map(t=>t.value);if(!e.some(t=>void 0===t))return 3===e.length?new vi(...e):new gi(...e)},t,s)}drawPath(t,e={}){"string"==typeof t&&(t=Mt(t));const s=new Ir(this,t,e.name);e.classes&&s.$el.addClass(e.classes),e.target&&s.$el.setAttr("target",e.target);const i=s.$el.hasClass("fill")?"fade":"draw";return e.animated&&s.$el.enter(i,e.animated),s}drawPoint(t,e={}){"string"==typeof t&&(t=Mt(t));const s=new _r(this,t,e.name,void 0,!1===e.interactive);return e.classes&&s.$el.addClass(e.classes),e.target&&s.$el.setAttr("target",e.target),0!==e.animated&&s.$el.enter("pop",e.animated||500),s}animatePoint(t,e,s=400){const i=this.shapes.get(t),n=new di(this.model[t],e);xe(t=>i.setValue(n.at(be("quad",t))),s)}animateConstruction(t,e=2e3){return s(this,void 0,void 0,(function*(){const s=this.shapes.get(t);let i=s.value;if($i(i)&&(i=i.arc),xi(i)){this.$ruler||(this.$ruler=le("path",{d:"M0,0V8H100V0ZM7,6A2,2,0,1,1,9,4,2,2,0,0,1,7,6Z",class:"sketch"},this.$svg));const t=xr(i.at(-.1),12,i.angle-.3,1.2*i.length),n=xr(i.at(-.1),12,i.angle,1.2*i.length);this.$ruler.show(),s.$el.hide(),yield this.$ruler.animate({opacity:[0,1],transform:[t,n]},500).promise,yield s.$el.enter("draw",e).promise,yield this.$ruler.animate({opacity:[1,0],transform:[n,t]},500).promise}else if(bi(i)){this.$compass||(this.$compass=le("path",{d:"M100,50h0l-5.2-4.9L52.6,10.2v-9C52.6.6,51.4,0,50,0s-2.6.6-2.6,1.2v9L5.2,45.1,0,50H0l6.6-3L35,25.9H65L93.4,47ZM38.4,23.5,50,14.8l11.6,8.7Z",class:"sketch"},this.$svg));const t=xr(i.c,50,i.startAngle,1.5*i.radius),n=xr(i.c,50,i.startAngle,i.radius),r=xr(i.c,50,i.startAngle+i.angle,i.radius),o=xr(i.c,50,i.startAngle+i.angle,1.5*i.radius);this.$compass.show(),s.$el.hide(),yield this.$compass.animate({opacity:[0,1],transform:[t,n]},500).promise,s.$el.enter("draw",e),yield this.$compass.animate({transform:[n,r]},e,0,"linear").promise,yield this.$compass.animate({opacity:[1,0],transform:[r,o]},500).promise}}))}showGesture(t,e){this.$gesture||(this.$gesture=le("x-gesture",{},this)),this.$gesture.stop();const s=this.toViewportCoords(Mt(t)(this.model));if(this.$gesture.from=s,e){const t=this.toViewportCoords(Mt(e)(this.model));this.$gesture.start(t.subtract(s))}else this.$gesture.start();this.one("click mouseover pointerdown",()=>this.$gesture.stop())}waitForPoint(){return s(this,void 0,void 0,(function*(){return new Promise(t=>{this.one("add:point",({point:e})=>t(e))})}))}waitForPath(t,e={}){return s(this,void 0,void 0,(function*(){return(yield kr(this,[t],e))[0]}))}waitForPaths(t,e={}){return kr(this,t,e)}};Hr=e([Oe("x-geopad",{templateId:"#geopad"})],Hr);let Wr=class extends qe{ready(){const t=this.$("use"),e=t.attr("xlink:href").replace("#xxx","#");t.setAttr("xlink:href",e+this.attr("icon")),this.on("attr:icon",({newVal:s})=>t.setAttr("xlink:href",e+s));const s=this.attr("title");s&&this.$("button").setAttr("title",s)}};Wr=e([Oe("x-icon-btn",{templateId:"#icon-btn",attributes:["icon"]})],Wr);let Fr=class extends qe{ready(){const t=this.$(".image"),e=this.positionTop<50;let s,i;t.css({"background-image":`url("${this.attr("background")}")`,height:e?"100%":"150%"});fe.onResize(({height:t})=>{const e=this.positionTop;s=Math.max(0,e-t),i=e+this.height}),de.on("scroll",(function(n){if(n.top<s||n.top>i)return;const r=(n.top-s)/(i-s)*(e?50:33);t.css("transform",`translateY(${r}%)`)}))}};Fr=e([Oe("x-parallax",{templateId:"#parallax"})],Fr);let Ur=class extends qe{constructor(){super(...arguments),this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide();this.$(".popup-target").on("click",()=>this.toggle()),this.on("clickOutside",()=>this.close());for(const t of this.$bubble.$$("a"))t.on("click",()=>this.close())}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,200))}close(){this.isOpen&&(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,200))}};Ur=e([Oe("x-popup")],Ur);let Kr=class extends qe{constructor(){super(...arguments),this.$titles=[],this.active=0}ready(){const t=this.$(".titles");this.$body=this.$(".body"),this.$tabs=this.$$(".tab");for(let e=0;e<this.$tabs.length;++e){const s=this.$tabs[e].$("h3")||le("h3");s.setAttr("tabindex","0"),t.append(s),this.$titles.push(s),s.on("click",()=>this.makeActive(e))}this.$titles[0].addClass("active"),this.$tabs[0].show()}makeActive(t){if(this.active===t)return;this.$titles[this.active].removeClass("active"),this.$titles[t].addClass("active"),this.$tabs[t].show();const e=this.$tabs[t].outerHeight+"px";this.$tabs[t].hide(),this.$tabs[this.active].exit("fade",300).promise.then(()=>this.$tabs[t].enter("fade",300)),this.$body.animate({height:e},600).promise.then(()=>this.$body.css("height","auto")),this.active=t,this.trigger("change",t)}};Kr=e([Oe("x-tabbox",{template:'<div class="titles"></div><div class="body"><slot></slot></div>'})],Kr);let Gr=class extends qe{constructor(){super(...arguments),this.completed=!1}ready(){var t;this.r=+this.attr("r")||10,this.r1=this.r+12,this.$svg=le("svg",{width:2*this.r1,height:2*this.r1},this),this.$progress=le("path",{class:"pie",d:(t=this.r,`M${t},${t/2}a${t/2},${t/2},0,0,1,0,${t}A${t/2},${t/2},0,0,1,${t},${t/2}`),"stroke-width":this.r},this.$svg),this.setProgress(+this.attr("p"),!1),this.on("attr:p",t=>this.setProgress(+t,!1))}setProgress(t,e=!0){if(t>.99)return this.complete(e);const s=Math.PI*this.r;this.$progress.css("stroke",t?"currentColor":"none"),this.$progress.css("stroke-dasharray",`${t*s} ${s}`)}complete(t=!0){if(this.completed)return;var e;if(this.completed=!0,this.$progress.css("stroke","none"),this.$progress.css("fill","currentColor"),this.$progress.setAttr("d",`M ${e=this.r},0 C ${e/2},0,0,${e/2},0,${e}  s ${e/2},${e},${e},${e} s ${e}-${e/2},${e}-${e}     S ${1.5*e},0,${e},0 z M ${44.6*e/50},${76.1*e/50} L ${19.2*e/50},${48.8*e/50} l ${4*e/50}-${4.2*e/50}     l ${19.8*e/50},${11.9*e/50} l ${34.2*e/50}-${32.6*e/50} l ${3.5*e/50},${3.5*e/50} L ${44.6*e/50},${76.1*e/50} z`),!t)return;const s=le("g",{transform:`translate(${this.r1} ${this.r1})`},this.$svg),i=c(()=>le("line",{},s),18);xe(t=>{const e=this.r+12*be("quint-out",t),s=this.r+12*t;for(let t=0;t<18;++t){const n=Math.cos(2*Math.PI*t/18),r=Math.sin(2*Math.PI*t/18);i[t].setLine({x:n*e,y:r*e},{x:n*s,y:r*s})}},800).promise.then(()=>s.remove())}};Gr=e([Oe("x-progress",{attributes:["p"]})],Gr);const Xr=Math.PI/180,Yr="no"!==function(t){t=t.replace(/^[?,&]/,"");const e=decodeURIComponent(t).split("&"),s={};return e.forEach(t=>{const e=t.split("=");s[e[0]]=e[1]}),s}(location.search).labels,Zr="#cccccc",Jr="#cd0e66",Qr="#eb4726",to="#fd8c00",eo="#bfc212",so="#22ab24",io="#009ea6",no="#0f82f2",ro="#6d3bbf";class oo{constructor(t){this.$parent=t,this.type="tile",this.usePosnAsRotationCenter=!1,this.isActive=!1,this.colour="#000",this.posn=new ii(0,0),this.rot=0,this.flipped=!1,this.anchor=new ii(0,0),this.vertices=[],this.radius=0,this.$el=le("g",{class:"tile"},t.$tiles),this.$body=le("g",{},this.$el),t.tiles.add(this),t.events.listen(this.$body,{down:()=>{this.isActive&&t.events.shiftKey?t.selection.remove(this):!t.events.shiftKey&&this.isActive||t.selection.add(this,!t.events.shiftKey)},start:()=>t.selection.moveStart(this),move:e=>t.selection.move(e),click:()=>{t.events.shiftKey||t.selection.add(this,!0)}})}setPosition(t,e=!1){this.posn=t;const s=e?this.$parent.snap(...this.points):void 0;return this.posn=s?t.add(s):t,this.transform(),s||new ii(0,0)}setRotation(t){this.rot=t,this.transform()}setColour(t){this.colour=t}flip(t){this.flipped=!this.flipped}transform(){this.$el.setTransform(this.posn,this.rot*Xr)}static makeThumbnail(t,e){}get outline(){return this.path.rotate(this.rot*Xr).translate(this.posn)}get points(){return this.outline.points}get angles(){return[0,90]}delete(){this.$parent.selection.remove(this),this.$parent.tiles.delete(this),this.$el.remove()}copy(t=40,e=t){const s=new this.constructor(this.options,this.$parent);return s.setColour(this.colour),s.setPosition(this.posn.shift(t,e)),this.flipped&&s.flip(),s.setRotation(this.rot),s}static action(t,e,s){}toJSON(){return{name:this.type,options:this.options,x:this.posn.x,y:this.posn.y,rot:this.rot,flipped:this.flipped,colour:this.colour}}}const ho=Math.PI/180,ao={100:to,10:no};function co(t,e,s){return le("rect",{class:"number-tile",width:t,height:t,fill:s},e)}function lo(t,e,s,i,n,r){t.setAttr("x",n+e%s*i),t.setAttr("y",r+Math.floor(e/s)*i)}function uo(t){return`M${-t/2},${-t/2}h${t/2}a${t/2},${t/2} 0 0 1${t/2},${t/2}\n      a${t/2},${t/2} 0 0 1 ${-t/2},${t/2}h${-t/2}z`}class po extends oo{constructor(t,e){super(e),this.type="number-tile",this.options=t;const[s,i]=t.split(":").map(t=>+t);if(this.count=i,this.colour=ao[i]||Jr,this.$tiles=c(()=>co(25,this.$body,this.colour),i),this.$outline=le("path",{class:"outline"},this.$body),i>1){let t;this.$handle=le("path",{class:"number-handle",d:uo(25)},this.$el),e.events.listen(this.$handle,{start:()=>t=this.width,move:({startPosn:e,posn:s})=>{this.setWidth(Math.round(t+(s.x-e.x)/25))}})}this.setWidth(s)}setWidth(t){if((t=Ys(t,1,this.count))!==this.width){this.width=t,this.options=`${t}:${this.count}`;for(let e=0;e<this.count;++e)lo(this.$tiles[e],e,t,25,-12.5,-12.5);this.path=function(t,e,s,i){const n=i.shift(t*s,0),r=n.shift(0,Math.floor(e/t)*s),o=i.shift(0,Math.ceil(e/t)*s),h=o.shift(e%t*s,0),a=h.shift(0,e%t?-s:0);return new gi(i,n,r,a,h,o)}(t,this.count,25,new ii(-12.5,-12.5)),this.$outline.draw(this.path),this.$handle&&this.$handle.setTransform(new ii(25*t,0)),this.$parent.selection.update(),this.$parent.hasChanged=!0}}setColour(t){this.colour=t;for(const e of this.$tiles)e.setAttr("fill",t)}static makeThumbnail(t,e){let[s,i]=t.split(":").map(t=>+t);s=Math.min(s,i);const n=le("svg",{width:80,height:80},e),r=40-s/2*7,o=40-Math.ceil(i/s)/2*7,h=ao[i]||Jr;for(let t=0;t<i;++t)lo(co(7,n,h),t,s,7,r,o)}get points(){const t=new ii(-12.5,-12.5),e=[t];for(let s=1;s<=this.width;++s)e.push(t.shift(25*s,0));const s=Math.ceil(this.count/this.width);for(let i=1;i<=s;++i)e.push(t.shift(0,25*i));for(let s=0;s<this.count;++s)e.push(t.shift(25*(s%this.width+1),25*Math.floor(s/this.width+1)));return e.map(t=>t.rotate(this.rot*ho).add(this.posn))}split(){if(1!==this.count){for(let t=0;t<this.count;++t){const e=t%this.width*25,s=25*Math.floor(t/this.width),i=this.posn.shift(e,s).rotate(this.rot*ho,this.posn),n=fo(1,1,this.$parent,i,this.rot,this.colour);this.$parent.selection.add(n)}this.delete()}}static action(t,e){if("split"===t)for(const t of e)t.split();else if("merge"===t){const t=Array.from(e),s=u(t.map(t=>t.count)),i=d(p(t,t=>t.count)),n=i.$parent,r=Math.min(...t.map(t=>t.posn.x)),o=Math.min(...t.map(t=>t.posn.y)),h=fo(s,Math.max(...t.map(t=>Math.ceil((t.posn.x-r)/25)+t.width)),n,new ii(r,o),i.rot,i.colour);for(const t of e)t.delete();n.selection.add(h)}}}function fo(t,e,s,i,n,r){const o=new po(`${e}:${t}`,s);return o.setPosition(i),o.setColour(r),o.setRotation(n),o}const go=Math.PI/180,mo=[to,Qr,Jr,ro,no,io,so,eo];function vo(t,e,s,i){le("text",{text:1,x:e,y:.42*s},i),le("text",{text:t,x:e,y:.84*s},i),le("line",{x1:e-.16*s,y1:s/2,x2:e+.16*s,y2:s/2},i)}function wo(t,e,s,i,n,r,o=-e/2,h=-e/2){const a=le("g",{transform:`translate(${t*i+o} ${h})`,class:"fraction-bar"});return le("rect",{width:t,height:e,fill:r},a),Yr&&vo(s,t/2,e,a),n.prepend(a),a}class yo extends oo{constructor(t,e){super(e),this.type="fraction-bar",this.count=0,this.$tiles=[],this.options=t;const[s,i]=t.split(":").map(t=>+t);let n;this.denominator=s,this.tileWidth=500/s,this.colour=mo[s-1],this.$outline=le("path",{class:"outline"},this.$body),this.$handle=le("path",{class:"number-handle",d:uo(25)},this.$el),e.events.listen(this.$handle,{start:()=>n=this.count,move:({startPosn:t,posn:e})=>{this.setCount(Math.round(n+(e.x-t.x)/this.tileWidth))}}),this.setCount(i)}setCount(t){if((t=Ys(t,1,20))!==this.count){if(t<this.count){for(let e=t;e<this.count;e+=1)this.$tiles[e].remove();this.$tiles=this.$tiles.slice(0,t)}else for(let e=this.count;e<t;e+=1)this.$tiles.push(wo(this.tileWidth,50,this.denominator,e,this.$body,this.colour));this.count=t,this.options=`${this.denominator}:${t}`,this.path=new wi(new ii(-25,-25),t*this.tileWidth,50).polygon,this.$outline.draw(this.path),this.$handle.setTransform(new ii(t*this.tileWidth-12.5,-12.5)),this.$parent.selection.update(),this.$parent.hasChanged=!0}}setColour(t){this.colour=t;for(const e of this.$tiles)e.$("rect").setAttr("fill",t)}static makeThumbnail(t,e){const[s,i]=t.split(":").map(t=>+t),n=le("svg",{width:222,height:22},e),r=mo[s-1],o=220/s;for(let t=0;t<i;++t)wo(o,20,s,t,n,r,1,1)}get points(){const t=[];for(let e=0;e<=this.count;e+=1)t.push(new ii(e*this.tileWidth-25,-25)),t.push(new ii(e*this.tileWidth-25,25));return t.map(t=>t.rotate(this.rot*go).add(this.posn))}split(){if(1!==this.count){for(let t=0;t<this.count;++t){const e=this.posn.shift(t*this.tileWidth,0).rotate(this.rot*go,this.posn),s=new yo(this.denominator+":1",this.$parent);s.setPosition(e),s.setRotation(this.rot),s.setColour(this.colour),this.$parent.selection.add(s)}this.$parent.selection.remove(this),this.delete()}}static action(t,e){if("split"===t)for(const t of e)t.split()}}function xo(t){const e=Math.cos(2*Math.PI/t);return 1/Math.sqrt(2-2*e)}const $o=Math.sqrt(3)/4*50,bo=new ci(new ii(0,0),new ii(0,1)),Mo={"equ-triangle":new gi(new ii(-25,$o),new ii(25,$o),new ii(0,-$o)),square:gi.regular(4,50*xo(4)),"reg-pentagon":gi.regular(5,50*xo(5)),"reg-hexagon":gi.regular(6,50*xo(6)),"reg-heptagon":gi.regular(7,50*xo(7)),"reg-octagon":gi.regular(8,50*xo(8)),"reg-decagon":gi.regular(10,50*xo(10)),"reg-dodecagon":gi.regular(12,50*xo(12)),rectangle:new wi(new ii(-50,-25),100,50).polygon,trapezium:new gi(new ii(-50,$o),new ii(50,$o),new ii(25,-$o),new ii(-25,-$o)),rhombus:new gi(new ii(-37.5,$o),new ii(12.5,$o),new ii(37.5,-$o),new ii(-12.5,-$o)),"right-triangle":new gi(new ii(-25,-25),new ii(25,-25),new ii(-25,25))},Co={"equ-triangle":[0,60,120],square:[0,90],"reg-pentagon":[0,36,72,108,144],"reg-hexagon":[0,60,120,180],"reg-heptagon":[0,90],"reg-octagon":[0,45,90,135],"reg-decagon":[0,90],"reg-dodecagon":[0,30,60,90,120,150],rectangle:[0,90],trapezium:[0,60,120],rhombus:[0,60],"right-triangle":[0,90,45]},ko=["","","",to,no,so,Jr,io,ro,"",eo,"",Qr];class Po extends oo{constructor(t,e){super(e),this.type="polygon",this.usePosnAsRotationCenter=!0,this.symmetric=!0,this.options=t,this.path=Mo[t],this.colour=ko[this.path.points.length],["rhombus","right-triangle"].includes(t)&&(this.symmetric=!1),this.$path=le("path",{class:"polygon-tile",path:this.path,fill:this.colour},this.$body),this.$outline=le("path",{class:"outline",path:this.path},this.$body)}static makeThumbnail(t,e){const s=Mo[t].scale(36/Mo[t].radius).shift(40),i=ko[s.points.length],n=le("svg",{width:80,height:80},e);le("path",{class:"polygon-tile",path:s,fill:i},n)}setColour(t){this.colour=t,this.$path.setAttr("fill",this.colour)}flip(t){t&&this.setPosition(new ii(2*t.x-this.posn.x,this.posn.y)),this.setRotation(-this.rot),this.symmetric||(this.path=this.path.reflect(bo),this.$path.draw(this.path),this.$outline.draw(this.path)),this.$parent.selection.update(),this.flipped=!this.flipped}get angles(){return Co[this.options]||[0,90]}static action(t,e,s){if("flip"===t)for(const t of e)t.flip(s)}}const Ao=[Zr,to,Qr,Jr,ro,no,io,so,eo],To=new ii(0,0);class So extends Po{constructor(t,e){super("rectangle",e),this.type="fraction-circle",this.options=t;const s=+t;if(s>1){const t=new ii(0,-100).rotate(-Math.PI/s);this.sector=new fi(To,t,2*Math.PI/s),this.path=new gi(To,this.sector.start,this.sector.at(.25),this.sector.at(.5),this.sector.at(.75),this.sector.end)}else this.sector=new ui(To,100),this.path=gi.regular(8,100);this.$path.draw(this.sector),this.$outline.draw(this.sector),Yr&&vo(s,0,-100,this.$body),this.colour=Ao[s-1],this.$path.setAttr("fill",this.colour)}static makeThumbnail(t,e){const s=+t,i=le("svg",{width:80,height:44},e),n=le("path",{class:"polygon-tile"},i),r=new ii(40,2).rotate(-Math.PI/s,new ii(40,42)),o=s>1?new fi(new ii(40,42),r,2*Math.PI/s):new ui(new ii(40,22),20);n.draw(o),n.setAttr("fill",Ao[s-1])}get points(){return[this.posn]}}const _o=[to,"#f15e19","#e1343b",Jr,"#8d2ca1","#4e53d0",no,io,so,eo];class Io extends Po{constructor(t,e){super("rectangle",e),this.type="number-bar",this.options=t;const s=+t;this.path=new wi(new ii(25*-t/2,-12.5),25*s,25),this.$path.draw(this.path),this.$outline.draw(this.path),this.colour=_o[s-1],this.$path.setAttr("fill",this.colour),Yr&&(this.$text=le("text",{html:t,class:"polygon-label",y:6},this.$body))}setRotation(t){this.rot=t,this.transform(),this.$text&&this.$text.css("transform",`rotate(${-this.rot}deg)`)}static makeThumbnail(t,e){const s=+t,i=new wi(new ii(1,1),20*s,20),n=_o[s-1],r=le("svg",{width:20*s+2,height:22},e);le("path",{class:"polygon-tile",path:i,fill:n},r),Yr&&le("text",{html:t,class:"polygon-label",x:10*s+1,y:17},r)}}const Eo=[[[0,2],[0,-4],[-2,-4],[-2,4],[2,4],[2,2],[0,2]],[[0,0],[0,-4],[-2,-4],[-2,2],[0,2],[0,4],[2,4],[2,0],[0,0]],[[-5,-1],[5,-1],[5,1],[-5,1]],[[-3,-2],[-3,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2]],[[3,-2],[3,0],[1,0],[1,-2],[-1,-2],[-1,2],[5,2],[5,-2],[3,-2]],[[-1,-3],[-1,-1],[-3,-1],[-3,3],[-1,3],[-1,1],[1,1],[1,-1],[3,-1],[3,-3],[-1,-3]],[[1,1],[1,-3],[-1,-3],[-1,1],[-3,1],[-3,3],[3,3],[3,1],[1,1]],[[1,-1],[1,-3],[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1],[1,-1]],[[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-4,-2],[-4,0],[-2,0],[-2,2],[0,2],[0,0],[4,0],[4,-2],[-4,-2]],[[-1,-3],[-1,1],[-3,1],[-3,3],[1,3],[1,-1],[3,-1],[3,-3],[-1,-3]],[[-1,-3],[-1,1],[-5,1],[-5,3],[1,3],[1,-3],[-1,-3]]],Lo=[[2,4],[4,4],[5,9],[7,2],[7,6],[11,3],[13,7],[15,3],[17,7],[20,2],[21,5],[23,7]],qo=M.rainbow(12).map(t=>""+t);class Oo extends Po{constructor(t,e){super("rectangle",e),this.type="pentomino",this.symmetric=!1,this.options=t;const s=Eo[+t].map(t=>new ii(...t).scale(12.5));this.path=new gi(...s),this.$path.draw(this.path),this.$outline.draw(this.path),this.colour=qo[+t],this.$path.setAttr("fill",this.colour)}static makeThumbnail(t,e){const s=Lo[+t],i=Eo[+t].map(t=>new ii(...t).shift(...s).scale(10).shift(1,1)),n=new gi(...i);e.draw(n),e.setAttr("fill",qo[+t])}}const Ro=[[[-4,-2],[0,2],[4,-2]],[[-4,-2],[0,2],[4,-2]],[[-2,0],[0,-2],[2,0],[0,2]],[[-3,1],[1,1],[3,-1],[-1,-1]],[[0,-1],[2,1],[-2,1]],[[0,-1],[2,1],[-2,1]],[[-2,-2],[2,-2],[2,2]]],No=[Jr,no,so,to,Qr,io,ro],jo=[[2,4],[4,2],[6,4],[3,7],[7,2],[4,5],[6,6]],Vo=[-90,0,0,0,-90,0,90],Bo=Math.PI/180;class Do extends Po{constructor(t,e){super("rectangle",e),this.type="tangram",this.symmetric=!1,this.options=t;const s=Ro[+t].map(t=>new ii(...t).scale(25));this.path=new gi(...s),this.$path.draw(this.path),this.$outline.draw(this.path),this.colour=No[+t],this.$path.setAttr("fill",this.colour),this.setRotation(Vo[+t])}static makeThumbnail(t,e){const s=jo[+t],i=Ro[+t].map(e=>new ii(...e).rotate(Vo[+t]*Bo).shift(...s).scale(15).shift(1,1)),n=new gi(...i);e.draw(n),e.setAttr("fill",No[+t])}get angles(){return[0,45,90,135]}}const zo={1:to,x:so,x2:no};function Ho(t,e){return t.options==="-"+e.options||e.options==="-"+t.options}class Wo extends Io{constructor(t,e){super("1",e),this.type="algebra-tile",this.isNull=!1,this.options=t;const s=i(t,"1","-1")?25:135,n=i(t,"x2","-x2")?135:25;this.path=new wi(new ii(-s/2,-n/2),s,n),this.$path.draw(this.path),this.$outline.draw(this.path),this.colour="-"===t[0]?Jr:zo[t],this.$path.setAttr("fill",this.colour),this.$text&&(this.$text.text=t.replace("-","–").replace("2","²"))}setColour(t=this.colour){this.colour=t,this.$path.setAttr("fill",this.isNull?"#ddd":this.colour)}static makeThumbnail(t,e){const s=i(t,"1","-1")?20:78,n=i(t,"x2","-x2")?78:20,r=new wi(new ii(40-s/2,40-n/2),s,n),o="-"===t[0]?Jr:zo[t],h=t.replace("-","–").replace("2","²"),a=le("svg",{width:80,height:80},e);le("path",{class:"polygon-tile",path:r,fill:o},a),le("text",{text:h,class:"polygon-label",x:40,y:46},a)}static checkOverlaps(t){const e=Array.from(t).filter(t=>"algebra-tile"===t.type),s=e.length;for(const t of e)t.isNull=!1;for(let t=0;t<s;++t)for(let i=t+1;i<s;++i){const s=e[t],n=e[i];s.isNull||n.isNull||Ho(s,n)&&s.outline.contains(n.posn)&&(s.isNull=!0,n.isNull=!0)}for(const t of e)t.setColour()}}const Fo=Math.PI/180,Uo=new WeakMap;let Ko,Go,Xo;const Yo=new Set,Zo=new Set;function Jo(t,e,s){const i=Qs(t-e,s);return i>s/2?i-s:i}function Qo(t,e){for(const s of t)if(e(s))return!0;return!1}class th{constructor(t){this.$parent=t,this.angle=0,this.startAngle=0,this.tiles=new Set,this.$tools=t.$(".transform-tools"),this.$rect=this.$tools.$(".group-outline"),this.$rotateBar=this.$tools.$(".rotate-bar"),this.$rotateCircle=this.$tools.$(".rotate-circle"),t.events.listen(this.$rotateCircle,{start:()=>{this.startAngle=this.angle,this.rotateStart()},move:({startPosn:t,posn:e})=>{this.rotate(this.startAngle-new hi(e,this.center,t).deg)}})}get size(){return this.tiles.size}add(t,e=!1){e&&this.clear(),t.isActive||(t.isActive=!0,this.tiles.add(t),this.$parent.$activeTiles.append(t.$el),this.update())}remove(t){t.isActive&&(t.isActive=!1,this.$parent.$tiles.append(t.$el),this.tiles.delete(t),this.update())}copy(){const t=Array.from(this.tiles).map(t=>t.copy());this.clear();for(const e of t)this.add(e);this.$parent.hasChanged=!0}clear(){for(const t of this.tiles)t.isActive=!1,this.$parent.$tiles.append(t.$el);this.tiles.clear(),this.update()}getTileProperty(t){if(!this.size)return;const e=Array.from(this.tiles),s=t(e[0]);return e.slice(1).some(e=>t(e)!==s)?void 0:s}update(){if(!this.size)return this.$tools.hide(),void this.$parent.trigger("change-selection",{tiles:[],color:void 0});const t=Array.from(this.tiles);this.angle=this.getTileProperty(t=>t.rot)||0;const e=function(...t){return t.reduce((t,e)=>t.concat(e),[])}(...t.map(t=>t.points)).map(t=>t.rotate(-this.angle*Fo)),s=wi.aroundPoints(...e),i=s.p.shift(s.w/2,s.h/2).rotate(this.angle*Fo).shift(-s.w/2,-s.h/2);this.rect=new wi(i,s.w,s.h),this.center=this.rect.center,1===this.size&&t[0].usePosnAsRotationCenter&&(this.center=t[0].posn),this.positionTools(),this.$rect.toggle(this.size>1),this.$tools.show();const n=this.getTileProperty(t=>t.colour);this.$parent.trigger("change-selection",{tiles:t,color:n})}positionTools(){this.$rect.draw(this.rect.rotate(this.angle*Fo,this.center));const t=new ii(this.center.x,this.rect.p.y),e=new di(t,t.shift(0,-28)).rotate(this.angle*Fo,this.center);this.$rotateBar.setLine(e.p1,e.p2),this.$rotateCircle.setCenter(e.p2)}moveStart(t){for(const t of this.tiles)Uo.set(t,t.posn);Xo=t,Go=this.rect,Ko=this.center}move({posn:t,startPosn:e}){const s=t.subtract(e),i=Xo.setPosition(Uo.get(Xo).add(s),!0);for(const t of this.tiles){if(t===Xo)continue;const e=Uo.get(t).add(i);t.setPosition(e.add(s),!1)}this.rect=Go.translate(i).translate(s),this.center=Ko.add(i).add(s),this.positionTools(),Wo.checkOverlaps(this.$parent.tiles),this.$parent.trigger("move-selection"),this.$parent.hasChanged=!0}rotateStart(){Zo.clear();for(const t of this.tiles)for(const e of t.angles)Zo.add(Qs(e+t.rot,180));Yo.clear(),Yo.add(0);for(const t of this.$parent.tiles)if(!this.tiles.has(t)&&Qo(this.tiles,e=>ii.distance(e.posn,t.posn)<140))for(const e of t.angles)Yo.add(Qs(e+t.rot,180))}rotate(t){if((t=Xs(t,3))===this.angle)return;let e=1/0;for(const s of Zo)for(const i of Yo){const n=Jo(i,s+t-this.startAngle,180);Math.abs(n)<Math.abs(e)&&(e=n)}if(Math.abs(e)<8&&(t+=e),t===this.angle)return;const s=t-this.angle;this.angle=t;for(const t of this.tiles)t.setRotation(t.rot+s),t.setPosition(t.posn.rotate(s*Math.PI/180,this.center));this.positionTools(),this.$parent.trigger("rotate-selection"),this.$parent.hasChanged=!0}matchesType(t){if(!this.tiles.size)return!1;const e=t.split(" ");for(const t of this.tiles)if(!e.includes(t.type))return!1;return!0}action(t,e){dh(t.split(" ")[0]).action(e,this.tiles,this.center)}}const eh=new ii(0,0),sh=180/Math.PI,ih=2*Math.PI;class nh{constructor(t,e){this.$el=t,this.$parent=e,this.center=eh,this.startAngle=0,this.angle=Math.PI/4*3,this.radius=200,this.show=!1,this.$bars=le("path",{class:"protractor-bars"},this.$el),this.$startLine=le("line",{},this.$el),this.$endLine=le("line",{},this.$el),this.$arc=le("path",{class:"protractor-arc"},this.$el),this.$center=le("circle",{r:10},this.$el),this.$start=le("circle",{r:10},this.$el),this.$end=le("circle",{r:10},this.$el),this.$label=le("text",{},this.$el),e.events.listen(this.$center,{down:()=>e.selection.clear(),move:({posn:t})=>{const s=e.snap(t);this.center=s?t.add(s):t,this.draw()}}),e.events.listen(this.$start,{down:()=>e.selection.clear(),move:({posn:t})=>{const e=this.$parent.snap(t);e&&(t=t.add(e)),this.radius=Ys(ii.distance(t,this.center),60,360),this.startAngle=t.angle(this.center),this.draw()}}),e.events.listen(this.$end,{down:()=>e.selection.clear(),move:({posn:t})=>{const e=(this.startAngle-t.angle(this.center)+ih)%ih;this.angle=Math.round(e*sh)/sh,this.draw()}})}draw(){const t=new ii(this.radius,0).rotate(this.startAngle),e=new ii(this.radius,0).rotate(this.startAngle+ih-this.angle),s=new fi(eh,e.unitVector.scale(30),this.angle),i=Math.round(this.angle*sh);this.$startLine.setLine(eh,t),this.$endLine.setLine(eh,e),this.$arc.draw(s),this.$start.setCenter(t),this.$end.setCenter(e),this.$label.text=i+"°",this.$label.setCenter(s.center.scale(1.5).shift(0,5));const n=l(5,i-1,5).map(t=>{const e=this.startAngle+ih-t/sh,s=t%90?ii.fromPolar(e,this.radius-(t%30?15:30)):eh,i=ii.fromPolar(e,this.radius);return`${s.x} ${s.y}L${i.x} ${i.y}`});this.$bars.setAttr("d","M"+n.join("M")),this.$el.translate(this.center.x,this.center.y)}toggle(){this.show=!this.show,this.show&&(this.center=new ii((this.$parent.width-280)/2,this.$parent.height/2),this.draw()),this.$el.toggle(this.show)}}class rh{constructor(t,e){this.path="",this.points=[],this.path=`M${e.x} ${e.y} L ${e.x+.01} ${e.y+.01}`,this.points=[e],this.$el=le("path",{class:"stroke",d:this.path,stroke:t.penColour},t.$strokes)}addPoint(t){this.points.push(t),this.path+=`L${t.x} ${t.y}`,this.$el.setAttr("d",this.path)}}class oh{constructor(t){this.$parent=t}down(t){}start(t){}move(t){}end(t){}click(t){}}class hh extends oh{down(){this.$parent.events.shiftKey||this.$parent.selection.clear()}start(){this.$parent.$selection.show()}move({startPosn:t,posn:e}){this.$parent.selectRect(t,e)}end(){this.$parent.$selection.hide()}click(){this.$parent.selection.clear()}}class ah extends oh{down({posn:t}){this.$stroke=new rh(this.$parent,t)}move({posn:t}){this.$stroke.addPoint(t)}end(){this.$stroke=void 0,this.$parent.hasChanged=!0}}class ch extends oh{down({event:t,posn:e}){this.erase(t,e)}move({event:t,posn:e}){this.erase(t,e)}erase(t,e){const s=It(t);s&&s.parent===this.$parent.$strokes&&(s.remove(),this.$parent.hasChanged=!0);for(const t of this.$parent.tiles)t.outline.contains(e)&&(t.delete(),this.$parent.hasChanged=!0)}}const lh=25*Math.sqrt(3)/2;function dh(t){switch(t){case"number-bar":return Io;case"number-tile":return po;case"polygon":return Po;case"pentomino":return Oo;case"tangram":return Do;case"fraction-bar":return yo;case"fraction-circle":return So;case"algebra-tile":return Wo}throw new Error("Unknown tile type: "+t)}let uh=class extends qe{constructor(){super(...arguments),this.tiles=new Set,this.penColour="#000000",this.hasChanged=!1,this.canDelete=!0,this.canCopy=!0}ready(){this.$svg=this.$("svg"),this.$tiles=this.$svg.$(".tiles:not(.active)"),this.$activeTiles=this.$svg.$(".tiles.active"),this.$selection=this.$svg.$(".selection"),this.$strokes=this.$svg.$(".strokes"),this.$grid=this.$svg.$(".grid"),this.tools={move:new hh(this),pen:new ah(this),eraser:new ch(this)},this.activeTool=this.tools.move,this.events=new Cr(this.$svg,{down:t=>this.activeTool.down(t),start:t=>this.activeTool.start(t),move:t=>this.activeTool.move(t),end:t=>this.activeTool.end(t),click:t=>this.activeTool.click(t)}),this.selection=new th(this),this.protractor=new nh(this.$(".protractor"),this),document.addEventListener("keydown",t=>{if(t.keyCode===pe.backspace&&this.canDelete){for(const t of this.selection.tiles)t.delete();this.hasChanged=!0}else"c"===t.key&&this.canCopy&&(this.selection.copy(),this.hasChanged=!0)})}selectRect(t,e){const s=wi.aroundPoints(t,e);this.$selection.setRect(s);for(const t of this.tiles)gi.collision(s.polygon,t.outline)?this.selection.add(t):this.selection.remove(t)}get tileVertices(){const t=[];for(const e of this.tiles)e.isActive||t.push(...e.points);return t}snap(...t){let e=8*(this.gridPoints?2:1),s=void 0;const i=this.gridPoints||this.tileVertices;for(const n of i)for(const i of t){const t=n.subtract(i),r=t.length;r<e&&(e=r,s=t)}return s}bindSource(t,e,s,i){let n;dh(e).makeThumbnail(s,t),this.events.listen(t,{down:()=>this.trigger("add-tile-start"),start:({posn:t})=>{n=new(dh(e))(s,this),n.setPosition(t),this.selection.add(n,!0),this.selection.moveStart(n),(i||this.$tiles).append(n.$el),this.trigger("add-tile",{tile:n}),this.hasChanged=!0},move:t=>this.selection.move(t),end:()=>this.$activeTiles.append(n.$el),click:()=>{this.selection.clear();const t=new(dh(e))(s,this);t.setPosition(new ii(this.$svg.svgWidth/2,this.$svg.svgHeight/2)),this.trigger("add-tile",{tile:t}),this.hasChanged=!0}})}setColour(t){if(this.activeTool===this.tools.pen)this.penColour=t||"#000000";else for(const e of this.selection.tiles)e.setColour(t||"")}setGrid(t){if(this.$grid.removeChildren(),"none"===t)return this.gridPoints=void 0;const[e,s]=t.split("-");if(this.gridPoints=function(t,e,s){const i=[];if("square"===t)for(let t=25;t<e;t+=25)for(let e=25;e<s;e+=25)i.push(new ii(t,e));else if("tri"===t)for(let t=1;t*lh<s;++t)for(let s=t%2?25:12.5;s<e;s+=25)i.push(new ii(s,t*lh));return i}(e,this.width,this.height),"dots"===s)for(const t of this.gridPoints){le("circle",{r:2},this.$grid).setCenter(t)}else if("grid"===s){const t=function(t,e,s){const i=[];if("square"===t){for(let t=1;25*t<e;++t)i.push([{x:25*t,y:0},{x:25*t,y:s},!(t%5)]);for(let t=1;25*t<s;++t)i.push([{x:0,y:25*t},{x:e,y:25*t},!(t%5)])}else if("tri"===t){const t=25*s/lh/2;for(let n=12.5;n<e+t;n+=25)i.push([{x:n,y:0},{x:n-t,y:s},!1]);for(let n=12.5-Xs(t,25);n<e+t;n+=25)i.push([{x:n,y:0},{x:n+t,y:s},!1]);for(let t=1;t*lh<s;++t)i.push([{x:0,y:t*lh},{x:e,y:t*lh},!1])}return i}(e,this.width,this.height);for(const[e,s,i]of t){le("line",{class:i?"major":""},this.$grid).setLine(e,s)}}}setActiveTool(t){this.activeTool=this.tools[t],this.setAttr("data-tool",t),this.selection.clear()}toggleProtractor(){this.protractor.toggle(),this.protractor.show&&this.selection.clear()}clear(){this.selection.clear();for(const t of this.tiles)t.delete()}};uh=e([Oe("x-polypad",{templateId:"#polypad"})],uh);const ph=le("div",{class:"modal-background"},de);let fh,gh=void 0,mh=void 0;function vh(){gh&&gh.canClose&&gh.close()}ph.on("click",vh),fe.onKey("escape",vh),Ie.on("change",vh),ph.on("scrollwheel touchmove",t=>{t.preventDefault(),t.stopPropagation()}),fe.onKey("space up down pagedown pageup",t=>{gh&&(t.preventDefault(),t.stopPropagation())});let wh=class extends qe{constructor(){super(...arguments),this.isOpen=!1,this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]");const t=ce(`[data-modal=${this.id}]`);for(const e of t)e.on("click",()=>this.open());Ie.on("afterChange",({$viewport:t})=>{const e=t.$$(`[data-modal=${this.id}]`);for(const t of e)t.on("click",()=>this.open())}),this.hasClass("open")&&!gh&&this.open(!0),this.$("input")&&this.addClass("interactive");const e=this.$(".close");e&&e.on("click",()=>this.close())}open(t=!1){if(this.isOpen)return;ph.setClass("light",this.hasClass("light")),gh?gh.close(!0):t?ph.show():"block"===ph.css("display")?null==fh||fh.cancel():ph.enter("fade",250),this.isOpen=!0,gh=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),t?this.show():this.enter("pop",250).promise.then(()=>this.css("transform","")),this.trigger("open"),mh=document.activeElement;const e=this.$('input, a, button, textarea, [tabindex="0"]');e&&e.focus()}close(t=!1,e=!1){this.isOpen&&(this.isOpen=!1,gh=void 0,this.$iframe&&this.$iframe.setAttr("src",""),t||(fh=ph.exit("fade",250)),this.exit("pop",250).promise.then(()=>this.css("transform","")),e||this.trigger("close"),mh&&mh.focus())}};wh=e([Oe("x-modal")],wh);let yh=class extends qe{constructor(){super(...arguments),this.$options={}}ready(){const t=this.children;this.$active=this.$(".active")||t[0],this.$active.addClass("active");for(const[e,s]of t.entries())i(s.tagName,"A","BUTTON")||s.hasAttr("tabindex")||s.setAttr("tabindex",0),s.on("click",()=>this.makeActive(s)),this.$options[s.attr("value")||e]=s;this.trigger("change",this.$active)}makeActive(t){t!==this.$active&&(this.$active.removeClass("active"),this.$active=t,t.addClass("active"),this.trigger("change",t))}bindVariable(t,e){t[e]=this.$active.attr("value"),this.on("change",s=>t[e]=s.attr("value")),t.watch(()=>{const s=this.$options[t[e]];s&&this.makeActive(s)})}};yh=e([Oe("x-select")],yh);let xh=class extends qe{ready(){const t=Array.from(this._el.children);this.removeChildren();const e=le("svg",{class:"equation"},this),s=le("g",{transform:"translate(2 0)"},e),i=parseFloat(this.css("font-size")),n=this.parents(".text-center").length||this.hasClass("display"),r=new Qi(s,void 0,0,"",i,!!n);r.setValue(this.attr("expr")||t),this.css({width:r.root.width+4+"px",height:r.root.height+"px","vertical-align":`-${r.root.height-r.root.baseline}px`})}};xh=e([Oe("x-math")],xh);const $h={},bh=ae("#search"),Mh=null==bh?void 0:bh.$(".form-field input"),Ch=null==bh?void 0:bh.$(".search-body");$h[""]=null==Ch?void 0:Ch.html;let kh=0,Ph=0;function Ah(t){return s(this,void 0,void 0,(function*(){const e=kh+=1,i=yield function(t){return s(this,void 0,void 0,(function*(){if((t=encodeURIComponent(function(t){return"pi"===(t=t.trim().replace(/\s+/," ").toLowerCase().slice(0,50))||t.length>=3?t:""}(t)))in $h)return $h[t];const e=yield fetch("/api/search?s="+t);return e.ok?$h[t]=yield e.text():$h[t]=""}))}(t);e<=Ph||(Ph=e,Ch.html=i)}))}null==Mh||Mh.change(t=>{fe.setCookie("search",t,86400),setTimeout(()=>{Mh.value==t&&Ah(t)},300),t&&window.ga&&setTimeout(()=>{Mh.value==t&&window.ga("send","event","search",t)},2e3)}),(null==Mh?void 0:Mh.value)&&bh.one("open",()=>Ah(Mh.value));const Th=[];class Sh{static add(t,e,s){_h(t,e).add(s)}static remove(t,e,s){_h(t,e).remove(s)}constructor(t,e){this.context=t,this.methodName=e,this.isTask=/Task$/.test(e),this.originalMethodReference=this.isTask?t.get(e):t[e],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=(...t)=>(0,this.boundMethodChain[this.boundMethodChain.length-1])(...t),this.isTask?t.set(e,this.wrappedMethod):t[e]=this.wrappedMethod}add(t){this.methodChain.push(t),this.rebindMethodChain()}remove(t){const e=this.methodChain.indexOf(t);e>-1&&(this.methodChain.splice(e,1),this.methodChain.length>0?this.rebindMethodChain():this.destroy())}rebindMethodChain(){this.boundMethodChain=[];for(let t,e=0;t=this.methodChain[e];e++){const s=this.boundMethodChain[e-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(t(s))}}destroy(){const t=Th.indexOf(this);t>-1&&(Th.splice(t,1),this.isTask?this.context.set(this.methodName,this.originalMethodReference):this.context[this.methodName]=this.originalMethodReference)}}function _h(t,e){let s=Th.filter(s=>s.context==t&&s.methodName==e)[0];return s||(s=new Sh(t,e),Th.push(s)),s}document.createElement("a");function Ih(t,e,s,i,n,r){if("function"==typeof i){const o=s.get("buildHitTask");return{buildHitTask:s=>{s.set(t,null,!0),s.set(e,null,!0),i(s,n,r),o(s)}}}return Lh({},t,e)}const Eh={};const Lh=Object.assign||function(t,...e){for(let s=0,i=e.length;s<i;s++){const i=Object(e[s]);for(let e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])}return t};function qh(){return+new Date}const Oh=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)};const Rh="autotrack",Nh={};let jh,Vh=!1;class Bh extends class{constructor(){this.registry_={}}on(t,e){this.getRegistry_(t).push(e)}off(t,e){if(t&&e){const s=this.getRegistry_(t),i=s.indexOf(e);i>-1&&s.splice(i,1)}else this.registry_={}}emit(t,...e){this.getRegistry_(t).forEach(t=>t(...e))}getEventCount(){let t=0;return Object.keys(this.registry_).forEach(e=>{t+=this.getRegistry_(e).length}),t}getRegistry_(t){return this.registry_[t]=this.registry_[t]||[]}}{static getOrCreate(t,e,s){const i=[Rh,t,e].join(":");return Nh[i]||(Nh[i]=new Bh(i,s),Vh||(window.addEventListener("storage",Dh),Vh=!0)),Nh[i]}static isSupported_(){if(null!=jh)return jh;try{window.localStorage.setItem(Rh,Rh),window.localStorage.removeItem(Rh),jh=!0}catch(t){jh=!1}return jh}static get_(t){return window.localStorage.getItem(t)}static set_(t,e){window.localStorage.setItem(t,e)}static clear_(t){window.localStorage.removeItem(t)}constructor(t,e={}){super(),this.key_=t,this.defaults_=e,this.cache_=null}get(){if(this.cache_)return this.cache_;if(Bh.isSupported_())try{this.cache_=zh(Bh.get_(this.key_))}catch(t){}return this.cache_=Lh({},this.defaults_,this.cache_)}set(t){if(this.cache_=Lh({},this.defaults_,this.cache_,t),Bh.isSupported_())try{Bh.set_(this.key_,JSON.stringify(this.cache_))}catch(t){}}clear(){if(this.cache_={},Bh.isSupported_())try{Bh.clear_(this.key_)}catch(t){}}destroy(){delete Nh[this.key_],Object.keys(Nh).length||(window.removeEventListener("storage",Dh),Vh=!1)}}function Dh(t){const e=Nh[t.key];if(e){const s=Lh({},e.defaults_,zh(t.oldValue)),i=Lh({},e.defaults_,zh(t.newValue));e.cache_=i,e.emit("externalSet",i,s)}}function zh(t){let e={};if(t)try{e=JSON.parse(t)}catch(t){}return e}const Hh={};class Wh{static getOrCreate(t,e,s){const i=t.get("trackingId");return Hh[i]?Hh[i]:Hh[i]=new Wh(t,e,s)}constructor(t,e,s){this.tracker=t,this.timeout=e||Wh.DEFAULT_TIMEOUT,this.timeZone=s,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),Sh.add(t,"sendHitTask",this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat("en-US",{timeZone:this.timeZone})}catch(t){}this.store=Bh.getOrCreate(t.get("trackingId"),"session",{hitTime:0,isExpired:!1}),this.store.get().id||this.store.set({id:Oh()})}getId(){return this.store.get().id}isExpired(t=this.getId()){if(t!=this.getId())return!0;const e=this.store.get();if(e.isExpired)return!0;const s=e.hitTime;if(s){const t=new Date,e=new Date(s);if(t-e>6e4*this.timeout||this.datesAreDifferentInTimezone(t,e))return!0}return!1}datesAreDifferentInTimezone(t,e){return!!this.dateTimeFormatter&&this.dateTimeFormatter.format(t)!=this.dateTimeFormatter.format(e)}sendHitTaskOverride(t){return e=>{t(e);const s=e.get("sessionControl"),i="start"==s||this.isExpired(),n="end"==s,r=this.store.get();r.hitTime=qh(),i&&(r.isExpired=!1,r.id=Oh()),n&&(r.isExpired=!0),this.store.set(r)}}destroy(){Sh.remove(this.tracker,"sendHitTask",this.sendHitTaskOverride),this.store.destroy(),delete Hh[this.tracker.get("trackingId")]}}Wh.DEFAULT_TIMEOUT=30;const Fh={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9,MAX_SCROLL_TRACKER:10},Uh=Object.keys(Fh).length;function Kh(t,e){!function(t){t.set("&_av","2.4.1")}(t),function(t,e){let s=function(t,e){if(t.length<e){let s=e-t.length;for(;s;)t="0"+t,s--}return t}((i=t.get("&_au"),parseInt(i||"0",16).toString(2)),Uh);var i;r=s,o=Uh-e,s=r.substr(0,o)+1+r.substr(o+1),t.set("&_au",(n=s,parseInt(n||"0",2).toString(16)));var n;var r,o}(t,e)}const Gh="visible",Xh=Oh();!function(t,e){const s=window.GoogleAnalyticsObject||"ga";var i;window[s]=window[s]||function(...t){(window[s].q=window[s].q||[]).push(t)},window.gaDevIds=window.gaDevIds||[],window.gaDevIds.indexOf("i5iSjo")<0&&window.gaDevIds.push("i5iSjo"),window[s]("provide",t,e),window.gaplugins=window.gaplugins||{},window.gaplugins[(i=t,i.charAt(0).toUpperCase()+i.slice(1))]=e}("pageVisibilityTracker",class{constructor(t,e){if(Kh(t,Fh.PAGE_VISIBILITY_TRACKER),!document.visibilityState)return;const s={sessionTimeout:Wh.DEFAULT_TIMEOUT,visibleThreshold:5e3,sendInitialPageview:!1,fieldsObj:{}};this.opts=Lh(s,e),this.tracker=t,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=Bh.getOrCreate(t.get("trackingId"),"plugins/page-visibility-tracker"),this.store.on("externalSet",this.handleExternalStoreSet),this.session=Wh.getOrCreate(t,this.opts.sessionTimeout,this.opts.timeZone),Sh.add(t,"set",this.trackerSetOverride),window.addEventListener("unload",this.handleWindowUnload),document.addEventListener("visibilitychange",this.handleChange),function(t,e){const s=t.get("trackingId"),i=Eh[s]=Eh[s]||{},n=()=>{clearTimeout(i.timeout),i.send&&Sh.remove(t,"send",i.send),delete Eh[s],i.queue.forEach(t=>t())};clearTimeout(i.timeout),i.timeout=setTimeout(n,0),i.queue=i.queue||[],i.queue.push(e),i.send||(i.send=t=>(...e)=>{n(),t(...e)},Sh.add(t,"send",i.send))}(this.tracker,()=>{document.visibilityState==Gh?(this.opts.sendInitialPageview&&(this.sendPageview({isPageLoad:!0}),this.isInitialPageviewSent_=!0),this.store.set({time:qh(),state:Gh,pageId:Xh,sessionId:this.session.getId()})):this.opts.sendInitialPageview&&this.opts.pageLoadsMetricIndex&&this.sendPageLoad()})}handleChange(){if(document.visibilityState!=Gh&&"hidden"!=document.visibilityState)return;const t=this.getAndValidateChangeData(),e={time:qh(),state:document.visibilityState,pageId:Xh,sessionId:this.session.getId()};document.visibilityState==Gh&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),"hidden"==document.visibilityState&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(t.sessionId)?(this.store.clear(),"hidden"==this.lastPageState&&document.visibilityState==Gh&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout(()=>{this.store.set(e),this.sendPageview({hitTime:e.time})},this.opts.visibleThreshold))):(t.pageId==Xh&&t.state==Gh&&this.sendPageVisibilityEvent(t),this.store.set(e)),this.lastPageState=document.visibilityState}getAndValidateChangeData(){const t=this.store.get();return this.lastPageState==Gh&&"hidden"==t.state&&t.pageId!=Xh&&(t.state=Gh,t.pageId=Xh,this.store.set(t)),t}sendPageVisibilityEvent(t,{hitTime:e}={}){const s=this.getTimeSinceLastStoredChange(t,{hitTime:e});if(s&&s>=this.opts.visibleThreshold){const t=Math.round(s/1e3),i={transport:"beacon",nonInteraction:!0,eventCategory:"Page Visibility",eventAction:"track",eventValue:t,eventLabel:"(not set)"};e&&(i.queueTime=qh()-e),this.opts.visibleMetricIndex&&(i["metric"+this.opts.visibleMetricIndex]=t),this.tracker.send("event",Ih(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}sendPageLoad(){const t={transport:"beacon",eventCategory:"Page Visibility",eventAction:"page load",eventLabel:"(not set)",["metric"+this.opts.pageLoadsMetricIndex]:1,nonInteraction:!0};this.tracker.send("event",Ih(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}sendPageview({hitTime:t,isPageLoad:e}={}){const s={transport:"beacon"};t&&(s.queueTime=qh()-t),e&&this.opts.pageLoadsMetricIndex&&(s["metric"+this.opts.pageLoadsMetricIndex]=1),this.tracker.send("pageview",Ih(s,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}trackerSetOverride(t){return(e,s)=>{const i=function(t){return"object"==typeof t&&null!==t}(e)?e:{[e]:s};i.page&&i.page!==this.tracker.get("page")&&this.lastPageState==Gh&&this.handleChange(),t(e,s)}}getTimeSinceLastStoredChange(t,{hitTime:e}={}){return t.time?(e||qh())-t.time:0}handleExternalStoreSet(t,e){t.time!=e.time&&(e.pageId!=Xh||e.state!=Gh||this.session.isExpired(e.sessionId)||this.sendPageVisibilityEvent(e,{hitTime:t.time}))}handleWindowUnload(){"hidden"!=this.lastPageState&&this.handleChange()}remove(){this.store.destroy(),this.session.destroy(),Sh.remove(this.tracker,"set",this.trackerSetOverride),window.removeEventListener("unload",this.handleWindowUnload),document.removeEventListener("visibilitychange",this.handleChange)}}),window.$=ae,window.$$=ce,window.Browser=fe,ve(),document.addEventListener("keydown",t=>{if(t.keyCode===pe.enter||t.keyCode===pe.space){const e=fe.getActiveInput();e&&e.hasAttr("tabindex")&&"TEXTAREA"!==e.tagName&&(t.preventDefault(),e.trigger("pointerdown",t),e.trigger("pointerstop",t),de.trigger("pointerstop",t),e.trigger("click",t))}}),ue.addClass((fe.isMobile?"is":"not")+"-mobile"),fe.isSafari&&ue.addClass("is-safari"),setTimeout(()=>ue.addClass("ready")),window.addEventListener("keydown",t=>{9===t.keyCode&&ue.addClass("is-tabbing")}),window.addEventListener("mousedown",()=>{ue.removeClass("is-tabbing")}),t.Course=class extends qe{constructor(){super(...arguments),this.user=window.user,this.model=Te({$course:this}),this.isCompleted=!1,this.isReady=!1}created(){this.glossary=JSON.parse(this.$("#glossary").text)||{},this.userData=window.progressData||JSON.parse(this.$("#userdata").text)||{},this.$steps=this.$$("x-step");for(const t of this.$steps)t.on("score",()=>this.trigger("score")),t.initialData=(this.userData.steps||{})[t.id]||void 0;this.data.audio&&(this.audio=new Re(this.data.audio))}ready(){this.$footer=this.$("footer"),this.$skipStep=this.$footer.$(".skip-step"),this.$progress=this.$(".sidebar-row.on x-progress"),this.$tutor=this.$("x-tutor"),this.$stepsWrap=this.$(".steps");const t=this.findStep(fe.getHash()),e=this.findStep(this.userData.activeStep);this.$activeStep=e||this.$steps[0];for(const t of this.$steps){if(t.show(),t===this.$activeStep)break;t.complete()}if(this.userData.completed||"full"===fe.getHash())this.complete();else for(;this.$activeStep&&this.$activeStep.isReady&&!this.isCompleted;)this.nextStep();(t||e&&!this.userData.completed)&&this.goToStep(t||e,!1),this.$(".section-dev")&&this.complete();const s=this.$(".reveal-banner");setTimeout(()=>{this.isCompleted||(s.removeClass("off"),this.on("score complete",()=>s.addClass("off")))},1500),s.$(".complete").one("click",()=>this.complete()),fe.onKey("space",t=>{t.preventDefault(),this.nextStep(),s.addClass("off")}),this.$footer.$(".skip").on("click",()=>this.nextStep()),this.$footer.$(".show-all").on("click",()=>this.complete()),this.isReady=!0,setTimeout(()=>this.addClass("ready"))}nextStep(){if(this.isCompleted)return;let t=this.$activeStep;const e=this.$stepsWrap.height;do{if(t.complete(),t=this.$steps[this.$steps.indexOf(t)+1],!t)return this.complete(!0);t.show()}while(t.isReady);this.$stepsWrap.animate({height:[e+"px","auto"]},800),this.$activeStep=t,this.saveProgress({activeStep:t.id})}goToStep(t,e=!0){const s=this.$stepsWrap.height;for(const e of this.$steps){if(e.isShown||(this.$activeStep=e),e.show(),t.isShown&&!e.isReady)break;e.complete()}const i=t.positionTop-Math.max(50,(fe.height-t.height)/2);e?(this.$stepsWrap.animate({height:[s+"px","auto"]},800),de.scrollTo(i)):de.scrollTop=i;const n=d(this.$steps);if(n.isShown&&n.isReady)return this.complete();this.$activeStep&&this.saveProgress({activeStep:this.$activeStep.id})}complete(t=!1){if(this.isCompleted)return;this.isCompleted=!0,this.$steps.forEach(t=>t.complete()),this.$activeStep=void 0;const e=this.$footer.$(".next-section");t?(this.$skipStep.exit("fade",200),e&&e.enter("pop")):(this.$skipStep.hide(),e&&e.show()),this.trigger("complete"),this.saveProgress({completed:!0}),this.log("Course","complete")}findStep(t){for(const e of this.$steps)if(e.id===t)return e}saveProgress(t){window.ReactNativeWebView&&window.ReactNativeWebView.postMessage(JSON.stringify(t))}log(t,e,s){}},t.Course=e([Oe("x-course")],t.Course);const Yh=ae(".sidebar");return Yh&&(ae(".sidebar-toggle").on("click",()=>Yh.addClass("open")),ae(".sidebar-shadow").on("pointerdown",()=>Yh.removeClass("open"))),t}({});